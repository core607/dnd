const CLASS_FEATURES_DATA = {
  战士: {
    featuresByLevel: {
      1: [
        {
          名称: '风采重振',
          来源: '战士 1级',
          类型: '动作',
          描述: '以一个附赠动作，你可以调动体力极限，恢复 1d10 + 你的战士等级点生命值。使用此特性后，必须完成一次短休或长休才能再次使用。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '短休或长休' },
        },
      ],
      2: [
        {
          名称: '动作如潮',
          来源: '战士 2级',
          类型: '动作',
          描述: '在你的回合中，你可以在正常动作之外再执行一个额外的动作。使用此特性后，必须完成一次短休或长休才能再次使用。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '短休或长休' },
        },
      ],
      5: [
        {
          名称: '额外攻击',
          来源: '战士 5级',
          类型: '被动',
          描述: '当你在你的回合中执行攻击动作时，你可以攻击两次而非一次。',
        },
      ],
      9: [
        {
          名称: '不屈',
          来源: '战士 9级',
          类型: '被动',
          描述: '当你进行一次豁免检定失败时，你可以选择重掷。使用此特性后，必须完成一次长休才能再次使用。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
        },
      ],
      11: [
        {
          类型: 'Upgrade',
          来源: '战士 11级',
          targetFeature: '额外攻击',
          updates: [{ path: '描述', value: '当你在你的回合中执行攻击动作时，你可以攻击三次而非两次。' }],
        },
      ],
      13: [
        {
          类型: 'Upgrade',
          来源: '战士 13级',
          targetFeature: '不屈',
          updates: [
            { path: '资源.最大次数', value: 2 },
            { path: '描述', value: '你可以重掷失败的豁免检定。长休之间可使用两次。' },
          ],
        },
      ],
      17: [
        {
          类型: 'Upgrade',
          来源: '战士 17级',
          targetFeature: '动作如潮',
          updates: [{ path: '资源.最大次数', value: 2 }],
        },
        {
          类型: 'Upgrade',
          来源: '战士 17级',
          targetFeature: '不屈',
          updates: [
            { path: '资源.最大次数', value: 3 },
            { path: '描述', value: '你可以重掷失败的豁免检定。长休之间可使用三次。' },
          ],
        },
      ],
      20: [
        {
          类型: 'Upgrade',
          来源: '战士 20级',
          targetFeature: '额外攻击',
          updates: [{ path: '描述', value: '当你在你的回合中执行攻击动作时，你可以攻击四次而非三次。' }],
        },
      ],
    },
  },
  法师: {
    featuresByLevel: {
      1: [
        {
          名称: '奥术回想',
          来源: '法师 1级',
          类型: '动作',
          描述: '每日一次，当你完成一次短休后，你可以选择一些已消耗的法术位以恢复。这些法术位的总环阶等级不能超过你法师等级的一半（向上取整）。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
        },
      ],
      18: [
        {
          名称: '法术精通',
          来源: '法师 18级',
          类型: '被动',
          描述: '你选择一个1环法师法术和一个2环法师法术。只要你已准备这两个法术，你就可以随意施展它们的最低环阶版本而无需消耗法术位。',
        },
      ],
      20: [
        {
          名称: '独门法术',
          来源: '法师 20级',
          类型: '被动',
          描述: '你从你的法术书中选择两个3环法师法术作为你的独门法术。只要你准备了它们，你就可以在每次短休或长休之间，各施展一次这两个法术的3环版本而无需消耗法术位。',
        },
      ],
    },
  },
  盗贼: {
    featuresByLevel: {
      1: [
        {
          名称: '专精',
          来源: '盗贼 1级',
          类型: '被动',
          描述: '选择你的两项技能熟练，或一项技能熟练和一个盗贼工具的熟练项。你的熟练加值在这些检定中加倍。',
        },
        {
          名称: '偷袭',
          来源: '盗贼 1级',
          类型: '被动',
          描述: '每回合一次，在特定条件下，你的攻击可以造成额外的 1d6 偷袭伤害。',
        },
        { 名称: '盗贼黑话', 来源: '盗贼 1级', 类型: '被动', 描述: '你懂得一套秘密语汇，可以进行隐秘交流。' },
      ],
      2: [
        {
          名称: '灵巧动作',
          来源: '盗贼 2级',
          类型: '动作',
          描述: '在你的每个回合里，你都可以用一个附赠动作来执行“冲刺”、“撤离”或“躲藏”动作。',
        },
      ],
      3: [
        {
          类型: 'Upgrade',
          来源: '盗贼 3级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 2d6 偷袭伤害。' }],
        },
      ],
      5: [
        {
          名称: 'Uncanny Dodge (超凡闪避)',
          来源: '盗贼 5级',
          类型: '反应',
          描述: '当一个你能看见的攻击者对你造成伤害时，你可以用你的反应使这次攻击对你造成的伤害减半。',
        },
        {
          类型: 'Upgrade',
          来源: '盗贼 5级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 3d6 偷袭伤害。' }],
        },
      ],
      6: [
        {
          名称: '专精(2)',
          来源: '盗贼 6级',
          类型: '被动',
          描述: '你的“专精”特性得到强化。你可以再选择两项你熟练的技能或工具，让它们获得双倍熟练加值的好处。',
        },
      ],
      7: [
        {
          名称: '反射闪避',
          来源: '盗贼 7级',
          类型: '被动',
          描述: '当你进行敏捷豁免来使伤害减半时，豁免成功将不受任何伤害，失败也只受一半伤害。',
        },
        {
          类型: 'Upgrade',
          来源: '盗贼 7级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 4d6 偷袭伤害。' }],
        },
      ],
      9: [
        {
          类型: 'Upgrade',
          来源: '盗贼 9级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 5d6 偷袭伤害。' }],
        },
      ],
      11: [
        {
          名称: '可靠才能',
          来源: '盗贼 11级',
          类型: '被动',
          描述: '每当你进行一次你拥有熟练项的属性检定时，如果你的d20掷骰结果为9或更低，则你将该结果视为10。',
        },
        {
          类型: 'Upgrade',
          来源: '盗贼 11级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 6d6 偷袭伤害。' }],
        },
      ],
      13: [
        {
          类型: 'Upgrade',
          来源: '盗贼 13级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 7d6 偷袭伤害。' }],
        },
      ],
      14: [
        {
          名称: '直觉闪避',
          来源: '盗贼 14级',
          类型: '被动',
          描述: '只要你并未失能，任何你看不到的攻击者对你发动攻击时都不能获得优势。',
        },
      ],
      15: [
        { 名称: '心地灵敏', 来源: '盗贼 15级', 类型: '被动', 描述: '你获得感知豁免的熟练项。' },
        {
          类型: 'Upgrade',
          来源: '盗贼 15级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 8d6 偷袭伤害。' }],
        },
      ],
      17: [
        {
          类型: 'Upgrade',
          来源: '盗贼 17级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 9d6 偷袭伤害。' }],
        },
      ],
      18: [
        {
          名称: '神出鬼没',
          来源: '盗贼 18级',
          类型: '被动',
          描述: '只要你在自己回合的移动尚未结束，攻击者对你发动的攻击检定便具有劣势。',
        },
      ],
      19: [
        {
          类型: 'Upgrade',
          来源: '盗贼 19级',
          targetFeature: '偷袭',
          updates: [{ path: '描述', value: '每回合一次，在特定条件下，你的攻击可以造成额外的 10d6 偷袭伤害。' }],
        },
      ],
      20: [
        {
          名称: '好运上门',
          来源: '盗贼 20级',
          类型: '被动',
          描述: '如果你的一次攻击失手，你可以将其变成命中。或者，如果你的一次属性检定失败，你可以将其掷骰结果视为20。使用此特性后，必须完成一次短休或长休才能再次使用。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '短休或长休' },
        },
      ],
    },
  },
  牧师: {
    featuresByLevel: {
      1: [
        {
          名称: '引导神力',
          来源: '牧师 1级',
          类型: '动作',
          描述: '你获得引导神力的能力，其效果由你选择的领域决定。初始使用次数为1次。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '短休或长休' },
        },
      ],
      2: [
        {
          名称: '引导神力：驱散亡灵',
          来源: '牧师 2级',
          类型: '动作',
          描述: '以一个动作，你可以展现你的神圣徽记，任何能看到或听到你的亡灵必须进行一次感知豁免，失败则被驱散。',
        },
      ],
      5: [
        {
          名称: '摧毁亡灵',
          来源: '牧师 5级',
          类型: '被动',
          描述: '当一个亡灵因你的“驱散亡灵”而豁免失败时，如果它的挑战等级低于1/2，则该亡灵将被直接摧毁。',
        },
      ],
      6: [
        {
          类型: 'Upgrade',
          来源: '牧师 6级',
          targetFeature: '引导神力',
          updates: [{ path: '资源.最大次数', value: 2 }],
        },
      ],
      8: [
        {
          类型: 'Upgrade',
          来源: '牧师 8级',
          targetFeature: '摧毁亡灵',
          updates: [{ path: '描述', value: '摧毁亡灵的挑战等级阈值提升至1。' }],
        },
      ],
      10: [
        {
          名称: '神力干预',
          来源: '牧师 10级',
          类型: '动作',
          描述: '你可以祈求你的神祇来直接干预事态。投掷百分骰，如果结果小于或等于你的牧师等级，你的神祇就会进行干预。使用后7天才能再次使用。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '7天' },
        },
      ],
      11: [
        {
          类型: 'Upgrade',
          来源: '牧师 11级',
          targetFeature: '摧毁亡灵',
          updates: [{ path: '描述', value: '摧毁亡灵的挑战等级阈值提升至2。' }],
        },
      ],
      14: [
        {
          类型: 'Upgrade',
          来源: '牧师 14级',
          targetFeature: '摧毁亡灵',
          updates: [{ path: '描述', value: '摧毁亡灵的挑战等级阈值提升至3。' }],
        },
      ],
      17: [
        {
          类型: 'Upgrade',
          来源: '牧师 17级',
          targetFeature: '摧毁亡灵',
          updates: [{ path: '描述', value: '摧毁亡灵的挑战等级阈值提升至4。' }],
        },
      ],
      18: [
        {
          类型: 'Upgrade',
          来源: '牧师 18级',
          targetFeature: '引导神力',
          updates: [{ path: '资源.最大次数', value: 3 }],
        },
      ],
      20: [
        {
          类型: 'Upgrade',
          来源: '牧师 20级',
          targetFeature: '神力干预',
          updates: [{ path: '描述', value: '你的“神力干预”将自动成功，无需掷骰。' }],
        },
      ],
    },
  },
  吟游诗人: {
    featuresByLevel: {
      1: [
        {
          名称: '吟游诗人激励',
          来源: '吟游诗人 1级',
          类型: '动作',
          描述: '以一个附赠动作，你可以给予盟友一个d6激励骰。每日使用次数等于你的魅力调整值。',
          资源: { 最大次数: '等于魅力调整值', 剩余次数: '等于魅力调整值', 恢复方式: '长休' },
        },
      ],
      2: [
        {
          名称: '万事通',
          来源: '吟游诗人 2级',
          类型: '被动',
          描述: '你可以将你熟练加值的一半加到任何你未获得熟练项的属性检定上。',
        },
        {
          名称: '安抚之歌',
          来源: '吟游诗人 2级',
          类型: '动作',
          描述: '在短休期间，花费生命骰恢复的盟友可以额外恢复 1d6 生命值。',
        },
      ],
      3: [
        {
          名称: '专精',
          来源: '吟游诗人 3级',
          类型: '被动',
          描述: '选择你的两项技能熟练，你的熟练加值在这些检定中加倍。',
        },
      ],
      5: [
        {
          类型: 'Upgrade',
          来源: '吟游诗人 5级',
          targetFeature: '吟游诗人激励',
          updates: [
            { path: '描述', value: '你的激励骰变为d8。' },
            { path: '资源.恢复方式', value: '短休或长休' },
          ],
        },
      ],
      6: [
        {
          名称: '反制饰音',
          来源: '吟游诗人 6级',
          类型: '反应',
          描述: '当你或30尺内一个你能看见的生物进行对抗魅惑或恐慌状态的豁免检定时，你可以用你的反应来进行一次表演检定，并将你的检定结果作为该生物的豁免结果。',
        },
      ],
      9: [
        {
          类型: 'Upgrade',
          来源: '吟游诗人 9级',
          targetFeature: '安抚之歌',
          updates: [{ path: '描述', value: '短休期间，花费生命骰恢复的盟友可以额外恢复 1d8 生命值。' }],
        },
      ],
      10: [
        {
          名称: '专精(2)',
          来源: '吟游诗人 10级',
          类型: '被动',
          描述: '你可以再选择两项你熟练的技能，让它们获得双倍熟练加值的好处。',
        },
        {
          类型: 'Upgrade',
          来源: '吟游诗人 10级',
          targetFeature: '吟游诗人激励',
          updates: [{ path: '描述', value: '你的激励骰变为d10。' }],
        },
      ],
      13: [
        {
          类型: 'Upgrade',
          来源: '吟游诗人 13级',
          targetFeature: '安抚之歌',
          updates: [{ path: '描述', value: '短休期间，花费生命骰恢复的盟友可以额外恢复 1d10 生命值。' }],
        },
      ],
      15: [
        {
          类型: 'Upgrade',
          来源: '吟游诗人 15级',
          targetFeature: '吟游诗人激励',
          updates: [{ path: '描述', value: '你的激励骰变为d12。' }],
        },
      ],
      17: [
        {
          类型: 'Upgrade',
          来源: '吟游诗人 17级',
          targetFeature: '安抚之歌',
          updates: [{ path: '描述', value: '短休期间，花费生命骰恢复的盟友可以额外恢复 1d12 生命值。' }],
        },
      ],
      20: [
        {
          名称: '超凡脱俗',
          来源: '吟游诗人 20级',
          类型: '被动',
          描述: '当你进行一次先攻检定且你的吟游诗人激励资源已经耗尽时，你可以恢复一次使用次数。',
        },
      ],
    },
  },
  圣武士: {
    featuresByLevel: {
      1: [
        {
          名称: '神圣感知',
          来源: '圣武士 1级',
          类型: '动作',
          描述: '以一个动作，你可以感知60尺内的天界生物、邪魔或亡灵。每日使用次数等于 1 + 你的魅力调整值。',
          资源: { 最大次数: '1+魅力调整值', 剩余次数: '1+魅力调整值', 恢复方式: '长休' },
        },
        {
          名称: '圣疗',
          来源: '圣武士 1级',
          类型: '动作',
          描述: '你拥有一个治疗池，其中的生命值等于你的圣武士等级 × 5。你可以用动作触摸并疗伤，或花费5点治疗能量治愈一种疾病或中和一种毒素。',
          资源: { 最大次数: '等级x5', 剩余次数: '等级x5', 恢复方式: '长休' },
        },
      ],
      2: [
        {
          名称: '神圣斩',
          来源: '圣武士 2级',
          类型: '被动',
          描述: '当你用近战武器攻击命中时，你可以消耗一个法术位，对目标造成额外的2d8光耀伤害（对亡灵或邪魔为3d8）。更高环阶法术位可增加伤害。',
        },
      ],
      3: [{ 名称: '神圣健康', 来源: '圣武士 3级', 类型: '被动', 描述: '你百病不侵，免疫所有疾病。' }],
      5: [
        {
          名称: '额外攻击',
          来源: '圣武士 5级',
          类型: '被动',
          描述: '当你在你的回合中执行攻击动作时，你可以攻击两次而非一次。',
        },
      ],
      6: [
        {
          名称: '守护灵光',
          来源: '圣武士 6级',
          类型: '被动',
          描述: '你和你10尺内的任何友方生物在进行豁免检定时，可以获得等同于你魅力调整值的加值。',
        },
      ],
      10: [
        { 名称: '勇气灵光', 来源: '圣武士 10级', 类型: '被动', 描述: '你和你10尺内的任何友方生物不会陷入恐慌状态。' },
      ],
      11: [
        {
          名称: '精通神圣斩',
          来源: '圣武士 11级',
          类型: '被动',
          描述: '当你用近战武器命中时，所有攻击都会额外造成 1d8 光耀伤害。此伤害可以与神圣斩叠加。',
        },
      ],
      14: [
        {
          名称: '净化之触',
          来源: '圣武士 14级',
          类型: '动作',
          描述: '以一个动作，你可以触摸一个生物，并终止一个正在影响它的法术。',
        },
      ],
      18: [
        {
          类型: 'Upgrade',
          来源: '圣武士 18级',
          targetFeature: '守护灵光',
          updates: [
            { path: '描述', value: '你和你30尺内的任何友方生物在进行豁免检定时，可以获得等同于你魅力调整值的加值。' },
          ],
        },
        {
          类型: 'Upgrade',
          来源: '圣武士 18级',
          targetFeature: '勇气灵光',
          updates: [{ path: '描述', value: '你和你30尺内的任何友方生物不会陷入恐慌状态。' }],
        },
      ],
    },
  },
  游侠: {
    featuresByLevel: {
      1: [
        {
          名称: '宿敌',
          来源: '游侠 1级',
          类型: '被动',
          描述: '你选择一种生物类型作为你的宿敌。你在追踪这些生物的求生检定和回忆它们信息的情报检定上具有优势。',
        },
        {
          名称: '自然探索者',
          来源: '游侠 1级',
          类型: '被动',
          描述: '你选择一种偏好的地形。当你在偏好地形中旅行时，你获得不会迷路、追踪时保持警惕等好处。',
        },
      ],
      3: [
        {
          名称: '原始意识',
          来源: '游侠 3级',
          类型: '动作',
          描述: '以一个动作并消耗一个游侠法术位，你可以感知1英里内是否有宿敌类型的生物存在。',
        },
      ],
      5: [
        {
          名称: '额外攻击',
          来源: '游侠 5级',
          类型: '被动',
          描述: '当你在你的回合中执行攻击动作时，你可以攻击两次而非一次。',
        },
      ],
      8: [{ 名称: '健步', 来源: '游侠 8级', 类型: '被动', 描述: '移动于非魔法的困难地形时，你无需花费额外的移动力。' }],
      10: [
        {
          名称: '遁影',
          来源: '游侠 10级',
          类型: '动作',
          描述: '以一个动作，你可以尝试隐藏自己，即使你只有轻度遮蔽。长休后可再次使用。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
        },
      ],
      14: [
        {
          名称: '消失',
          来源: '游侠 14级',
          类型: '被动',
          描述: '你可以用一个附赠动作来进行躲藏动作。此外，你无法被非魔法的方式追踪，除非你自愿。',
        },
      ],
      18: [
        {
          名称: '野性知觉',
          来源: '游侠 18级',
          类型: '被动',
          描述: '即使你看不到、听不到或闻不到一个躲藏起来的生物，你也能感知到它在你30尺内的存在。',
        },
      ],
      20: [
        {
          名称: '猎杀之王',
          来源: '游侠 20级',
          类型: '被动',
          描述: '每回合一次，你可以将你的感知调整值加到你对一个宿敌的攻击检定或伤害掷骰上。',
        },
      ],
    },
  },
  武僧: {
    featuresByLevel: {
      1: [
        {
          名称: '无甲防御',
          来源: '武僧 1级',
          类型: '被动',
          描述: '未着装护甲且未使用盾牌时，你的AC等于 10 + 敏捷调整值 + 感知调整值。',
        },
        {
          名称: '武艺',
          来源: '武僧 1级',
          类型: '被动',
          描述: '你可以用敏捷代替力量进行徒手和武僧武器的攻击和伤害检定，徒手伤害为1d4，且在攻击动作后可以附赠动作进行一次徒手打击。',
        },
      ],
      2: [
        {
          名称: '气',
          来源: '武僧 2级',
          类型: '资源',
          描述: '你拥有一个等于你武僧等级的气池。你可以花费气来驱动多种能力。短休或长休后恢复。',
          资源: { 最大次数: '等于武僧等级', 剩余次数: '等于武僧等级', 恢复方式: '短休或长休' },
        },
        {
          名称: '疾风连击',
          来源: '武僧 2级',
          类型: '动作',
          描述: '花费1点气，在攻击动作后，可以附赠动作进行两次徒手打击。',
        },
        { 名称: '耐烦防御', 来源: '武僧 2级', 类型: '动作', 描述: '花费1点气，可以附赠动作执行“闪避”动作。' },
        { 名称: '飞檐走壁', 来源: '武僧 2级', 类型: '动作', 描述: '花费1点气，可以附赠动作执行“冲刺”或“撤离”动作。' },
      ],
      3: [
        {
          名称: 'Deflect Missiles (拨挡飞弹)',
          来源: '武僧 3级',
          类型: '反应',
          描述: '以一个反应，你可以减少受到的远程武器攻击伤害 1d10 + 敏捷调整值 + 武僧等级。若伤害减至0，可花费1点气将武器掷回。',
        },
      ],
      4: [
        {
          名称: '慢落',
          来源: '武僧 4级',
          类型: '反应',
          描述: '以一个反应，当你坠落时，你可以减少受到的坠落伤害，其数值等于你武僧等级的五倍。',
        },
      ],
      5: [
        {
          名称: '额外攻击',
          来源: '武僧 5级',
          类型: '被动',
          描述: '当你在你的回合中执行攻击动作时，你可以攻击两次而非一次。',
        },
        {
          名称: '震慑击',
          来源: '武僧 5级',
          类型: '动作',
          描述: '花费1点气，当你用一次近战武器攻击命中时，可以尝试震慑目标。',
        },
        {
          类型: 'Upgrade',
          来源: '武僧 5级',
          targetFeature: '武艺',
          updates: [{ path: '描述', value: '你的徒手伤害变为1d6。' }],
        },
      ],
      6: [
        {
          名称: '真气击',
          来源: '武僧 6级',
          类型: '被动',
          描述: '你的徒手打击在穿透对非魔法攻击的抗性和免疫时，被视为魔法攻击。',
        },
      ],
      7: [
        {
          名称: '心如止水',
          来源: '武僧 7级',
          类型: '动作',
          描述: '以一个动作，你可以终止一个正在影响你的魅惑或恐慌效应。',
        },
        { 名称: '身轻如燕', 来源: '武僧 7级', 类型: '被动', 描述: '你获得反射闪避的能力。' },
      ],
      10: [{ 名称: '百病不侵', 来源: '武僧 10级', 类型: '被动', 描述: '你免疫疾病和毒素。' }],
      11: [
        {
          类型: 'Upgrade',
          来源: '武僧 11级',
          targetFeature: '武艺',
          updates: [{ path: '描述', value: '你的徒手伤害变为1d8。' }],
        },
      ],
      13: [
        {
          名称: '精通口才',
          来源: '武僧 13级',
          类型: '被动',
          描述: '你可以理解所有口头语言，并且任何能理解一种语言的生物都能理解你。',
        },
      ],
      14: [
        {
          名称: '金刚魂',
          来源: '武僧 14级',
          类型: '被动',
          描述: '你获得所有豁免的熟练项。当你豁免失败时，可花费1点气重掷。',
        },
      ],
      15: [{ 名称: '不老之躯', 来源: '武僧 15级', 类型: '被动', 描述: '你不再受衰老的减益，并且不会被魔法变老。' }],
      17: [
        {
          类型: 'Upgrade',
          来源: '武僧 17级',
          targetFeature: '武艺',
          updates: [{ path: '描述', value: '你的徒手伤害变为1d10。' }],
        },
      ],
      18: [
        {
          名称: '空灵体',
          来源: '武僧 18级',
          类型: '动作',
          描述: '花费4点气，你可以用一个动作使自己隐形1分钟，并获得对除力场伤害外的所有伤害的抗性。你也可花费8点气施展异界传送。',
        },
      ],
      20: [
        {
          名称: '圆满之躯',
          来源: '武僧 20级',
          类型: '被动',
          描述: '当你进行先攻检定且你的气点数为0时，你可以恢复4点气。',
        },
      ],
    },
  },
  术士: {
    featuresByLevel: {
      2: [
        {
          名称: '术法点',
          来源: '术士 2级',
          类型: '资源',
          描述: '你获得一个等于你术士等级的术法点池。你可以花费术法点来驱动超魔法，或转换法术位。长休后恢复。',
          资源: { 最大次数: '等于术士等级', 剩余次数: '等于术士等级', 恢复方式: '长休' },
        },
      ],
      3: [
        { 名称: '超魔法', 来源: '术士 3级', 类型: '动作', 描述: '你获得两项超魔法选项，例如“法术孪生”或“法术瞬发”。' },
      ],
      10: [
        {
          类型: 'Upgrade',
          来源: '术士 10级',
          targetFeature: '超魔法',
          updates: [{ path: '描述', value: '你获得第三项超魔法选项。' }],
        },
      ],
      17: [
        {
          类型: 'Upgrade',
          来源: '术士 17级',
          targetFeature: '超魔法',
          updates: [{ path: '描述', value: '你获得第四项超魔法选项。' }],
        },
      ],
      20: [
        {
          名称: '术法回涌',
          来源: '术士 20级',
          类型: '被动',
          描述: '当你完成一次短休时，你可以恢复4点已消耗的术法点。',
        },
      ],
    },
  },
  邪术师: {
    featuresByLevel: {
      1: [
        {
          名称: '契约魔法',
          来源: '邪术师 1级',
          类型: '被动',
          描述: '你的施法能力来自于你的宗主。你拥有独特的契约法术位，在短休或长休后恢复。',
        },
      ],
      2: [{ 名称: '魔能祈唤', 来源: '邪术师 2级', 类型: '被动', 描述: '你学会两项魔能祈唤。' }],
      3: [
        {
          名称: '契约恩泽',
          来源: '邪术师 3级',
          类型: '被动',
          描述: '你的宗主赐予你一份礼物。你从“链之契约”、“刃之契约”或“书之契约”中选择其一。',
        },
      ],
      5: [
        {
          类型: 'Upgrade',
          来源: '邪术师 5级',
          targetFeature: '魔能祈唤',
          updates: [{ path: '描述', value: '你学会第三项魔能祈唤。' }],
        },
      ],
      7: [
        {
          类型: 'Upgrade',
          来源: '邪术师 7级',
          targetFeature: '魔能祈唤',
          updates: [{ path: '描述', value: '你学会第四项魔能祈唤。' }],
        },
      ],
      9: [
        {
          类型: 'Upgrade',
          来源: '邪术师 9级',
          targetFeature: '魔能祈唤',
          updates: [{ path: '描述', value: '你学会第五项魔能祈唤。' }],
        },
      ],
      11: [
        {
          名称: '秘法真传 (6环)',
          来源: '邪术师 11级',
          类型: '被动',
          描述: '你的宗主让你能够从一个法术列表中选择一个6环法术。每日一次，你可以施展此法术而无需消耗法术位。长休后恢复。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
        },
      ],
      12: [
        {
          类型: 'Upgrade',
          来源: '邪术师 12级',
          targetFeature: '魔能祈唤',
          updates: [{ path: '描述', value: '你学会第六项魔能祈唤。' }],
        },
      ],
      13: [
        {
          名称: '秘法真传 (7环)',
          来源: '邪术师 13级',
          类型: '被动',
          描述: '你学会一个7环法术，同样每日一次，长休恢复。',
        },
      ],
      15: [
        {
          名称: '秘法真传 (8环)',
          来源: '邪术师 15级',
          类型: '被动',
          描述: '你学会一个8环法术，同样每日一次，长休恢复。',
        },
        {
          类型: 'Upgrade',
          来源: '邪术师 15级',
          targetFeature: '魔能祈唤',
          updates: [{ path: '描述', value: '你学会第七项魔能祈唤。' }],
        },
      ],
      17: [
        {
          名称: '秘法真传 (9环)',
          来源: '邪术师 17级',
          类型: '被动',
          描述: '你学会一个9环法术，同样每日一次，长休恢复。',
        },
      ],
      18: [
        {
          类型: 'Upgrade',
          来源: '邪术师 18级',
          targetFeature: '魔能祈唤',
          updates: [{ path: '描述', value: '你学会第八项魔能祈唤。' }],
        },
      ],
      20: [
        {
          名称: '魔能之主',
          来源: '邪术师 20级',
          类型: '动作',
          描述: '以一个动作，你可以与你的宗主沟通，请求恢复所有已消耗的契约法术位。使用此特性后，你必须完成一次长休才能再次使用。',
          资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
        },
      ],
    },
  },
  德鲁伊: {
    featuresByLevel: {
      1: [{ 名称: '德鲁伊教团语言', 来源: '德鲁伊 1级', 类型: '被动', 描述: '你懂得德鲁伊们的秘密语言。' }],
      2: [
        {
          名称: '野性变身',
          来源: '德鲁伊 2级',
          类型: '动作',
          描述: '以一个动作，你可以魔法性地变身为一头挑战等级为1/4或更低、且没有飞行或游泳速度的野兽。短休之间可使用两次。',
          资源: { 最大次数: 2, 剩余次数: 2, 恢复方式: '短休或长休' },
        },
      ],
      4: [
        {
          类型: 'Upgrade',
          来源: '德鲁伊 4级',
          targetFeature: '野性变身',
          updates: [
            { path: '描述', value: '你的野性变身限制放宽。你可以变身为挑战等级为1/2或更低、且可以有游泳速度的野兽。' },
          ],
        },
      ],
      8: [
        {
          类型: 'Upgrade',
          来源: '德鲁伊 8级',
          targetFeature: '野性变身',
          updates: [
            { path: '描述', value: '你的野性变身限制放宽。你可以变身为挑战等级为1或更低、且可以有飞行速度的野兽。' },
          ],
        },
      ],
      18: [
        {
          名称: '不老之躯',
          来源: '德鲁伊 18级',
          类型: '被动',
          描述: '你的衰老速度变得极为缓慢。你每度过10年，身体只相当于老去1岁。',
        },
        { 名称: '野兽法术', 来源: '德鲁伊 18级', 类型: '被动', 描述: '你可以在使用野性变身时施展许多德鲁伊法术。' },
      ],
      20: [{ 名称: '大德鲁伊', 来源: '德鲁伊 20级', 类型: '被动', 描述: '你的“野性变身”使用次数变得无限。' }],
    },
  },
  野蛮人: {
    featuresByLevel: {
      1: [
        {
          名称: '狂暴',
          来源: '野蛮人 1级',
          类型: '动作',
          描述: '以一个附赠动作进入狂暴状态，获得力量检定/豁免优势、力量攻击伤害加值、以及对挥砍/穿刺/钝击伤害的抗性。初始每日2次。',
          资源: { 最大次数: 2, 剩余次数: 2, 恢复方式: '长休' },
        },
        {
          名称: '无甲防御',
          来源: '野蛮人 1级',
          类型: '被动',
          描述: '未着装护甲时，你的AC等于 10 + 敏捷调整值 + 体质调整值。',
        },
      ],
      2: [
        {
          名称: '鲁莽攻击',
          来源: '野蛮人 2级',
          类型: '动作',
          描述: '在你回合的第一次攻击前，你可以决定发动鲁莽攻击，使本回合的力量近战攻击获得优势，但所有对你的攻击也获得优势。',
        },
        {
          名称: '危险感知',
          来源: '野蛮人 2级',
          类型: '被动',
          描述: '你对那些你能看见的效应进行的敏捷豁免检定具有优势。',
        },
      ],
      3: [
        { 类型: 'Upgrade', 来源: '野蛮人 3级', targetFeature: '狂暴', updates: [{ path: '资源.最大次数', value: 3 }] },
      ],
      5: [
        {
          名称: '额外攻击',
          来源: '野蛮人 5级',
          类型: '被动',
          描述: '当你在你的回合中执行攻击动作时，你可以攻击两次而非一次。',
        },
        { 名称: '快速移动', 来源: '野蛮人 5级', 类型: '被动', 描述: '只要你未着装重甲，你的速度增加10尺。' },
      ],
      6: [
        { 类型: 'Upgrade', 来源: '野蛮人 6级', targetFeature: '狂暴', updates: [{ path: '资源.最大次数', value: 4 }] },
      ],
      7: [{ 名称: '野性直觉', 来源: '野蛮人 7级', 类型: '被动', 描述: '你在先攻检定上具有优势。' }],
      9: [
        {
          名称: '野蛮重击',
          来源: '野蛮人 9级',
          类型: '被动',
          描述: '当你用近战武器造成重击时，你可以额外掷一个武器伤害骰。',
        },
      ],
      11: [
        {
          名称: '不屈狂暴',
          来源: '野蛮人 11级',
          类型: '被动',
          描述: '当你生命值降至0但未被直接杀死时，你可以进行一次DC10的体质豁免，成功则生命值变为1。每次使用后DC增加5，短休或长休后重置。',
        },
      ],
      12: [
        { 类型: 'Upgrade', 来源: '野蛮人 12级', targetFeature: '狂暴', updates: [{ path: '资源.最大次数', value: 5 }] },
      ],
      13: [
        {
          类型: 'Upgrade',
          来源: '野蛮人 13级',
          targetFeature: '野蛮重击',
          updates: [{ path: '描述', value: '当你用近战武器造成重击时，你可以额外掷两个武器伤害骰。' }],
        },
      ],
      15: [
        {
          名称: '顽强狂暴',
          来源: '野蛮人 15级',
          类型: '被动',
          描述: '你的狂暴状态只有在你倒地或自愿终止时才会提前结束。',
        },
      ],
      17: [
        { 类型: 'Upgrade', 来源: '野蛮人 17级', targetFeature: '狂暴', updates: [{ path: '资源.最大次数', value: 6 }] },
        {
          类型: 'Upgrade',
          来源: '野蛮人 17级',
          targetFeature: '野蛮重击',
          updates: [{ path: '描述', value: '当你用近战武器造成重击时，你可以额外掷三个武器伤害骰。' }],
        },
      ],
      18: [
        {
          名称: '不屈之力',
          来源: '野蛮人 18级',
          类型: '被动',
          描述: '如果你的力量检定总值低于你的力量属性值，则你可以用你的力量属性值替代该检定结果。',
        },
      ],
      20: [
        {
          名称: '野蛮人酋长',
          来源: '野蛮人 20级',
          类型: '被动',
          描述: '你的力量和体质属性值提升4点，其上限也提升至24。',
        },
        {
          类型: 'Upgrade',
          来源: '野蛮人 20级',
          targetFeature: '狂暴',
          updates: [{ path: '资源.最大次数', value: '无限' }],
        },
      ],
    },
  },
};

const SUBCLASS_FEATURES_DATA = {
  战士: {
    勇士: {
      featuresByLevel: {
        3: [
          { 名称: '暴击强化', 来源: '勇士 3级', 类型: '被动', 描述: '你的武器攻击在掷骰结果为19或20时即可造成重击。' },
        ],
        7: [
          {
            名称: '卓越体格',
            来源: '勇士 7级',
            类型: '被动',
            描述: '你可以将你的力量、敏捷或体质调整值加到任何你未熟练的力量、敏捷或体质豁免检定上。',
          },
        ],
        10: [{ 名称: '额外战斗风格', 来源: '勇士 10级', 类型: '被动', 描述: '你获得第二种战斗风格选项。' }],
        15: [
          {
            类型: 'Upgrade',
            来源: '勇士 15级',
            targetFeature: '暴击强化',
            updates: [{ path: '描述', value: '你的武器攻击在掷骰结果为18-20时即可造成重击。' }],
          },
        ],
        18: [
          {
            名称: '不屈生机',
            来源: '勇士 18级',
            类型: '被动',
            描述: '在你的回合开始时，如果你剩余的生命值不多于你生命值上限的一半，则你恢复等同于 5 + 你体质调整值的生命值。',
          },
        ],
      },
    },
    战斗大师: {
      featuresByLevel: {
        3: [
          {
            名称: '战斗卓越',
            来源: '战斗大师 3级',
            类型: '资源',
            描述: '你获得4个d8卓越骰，可用于驱动你的战技。你在一次短休或长休后恢复所有已消耗的卓越骰。',
            资源: { 最大次数: 4, 剩余次数: 4, 恢复方式: '短休或长休' },
          },
          {
            名称: '战技研习',
            来源: '战斗大师 3级',
            类型: '被动',
            描述: '你学会三项战技。战技会增强你的攻击。每次攻击你只能使用一项战技。',
          },
        ],
        7: [
          {
            名称: '知己知彼',
            来源: '战斗大师 7级',
            类型: '被动',
            描述: '若花费至少1分钟的时间在战斗外观察另一个生物或与之交互，则可以得知某些关于它能力的情报（例如属性值、AC、当前生命值等）。',
          },
        ],
        10: [
          {
            类型: 'Upgrade',
            来源: '战斗大师 10级',
            targetFeature: '战斗卓越',
            updates: [
              { path: '资源.最大次数', value: 5 },
              { path: '描述', value: '你的卓越骰变为d10，并且最大数量增加到5个。' },
            ],
          },
        ],
        15: [
          {
            名称: '无穷战技',
            来源: '战斗大师 15级',
            类型: '被动',
            描述: '当你进行先攻检定且你的卓越骰资源已经耗尽时，你可以恢复一个卓越骰。',
          },
        ],
        18: [
          {
            类型: 'Upgrade',
            来源: '战斗大师 18级',
            targetFeature: '战斗卓越',
            updates: [
              { path: '资源.最大次数', value: 6 },
              { path: '描述', value: '你的卓越骰变为d12，并且最大数量增加到6个。' },
            ],
          },
        ],
      },
    },
    奥法骑士: {
      featuresByLevel: {
        3: [
          {
            名称: '武器联结',
            来源: '奥法骑士 3级',
            类型: '动作',
            描述: '以一个附赠动作，你可以召唤一把已与你联结的武器到你手中。你不能被缴械，除非你已失能。你最多可以联结两把武器。',
          },
          {
            名称: '奥法骑士施法',
            来源: '奥法骑士 3级',
            类型: '施法',
            描述: '你获得施展法师法术的能力。你的施法关键属性为智力。你主要学习防护系和塑能系法术。',
          },
        ],
        7: [
          {
            名称: '战争魔法',
            来源: '奥法骑士 7级',
            类型: '动作',
            描述: '当你在你的回合中使用动作施展一个戏法时，你可以用一个附赠动作进行一次武器攻击。',
          },
        ],
        10: [
          {
            名称: '奥术冲锋',
            来源: '奥法骑士 10级',
            类型: '动作',
            描述: '当你使用你的“动作如潮”特性时，你可以在额外的动作前后传送最多30尺的距离。',
          },
        ],
        15: [
          {
            名称: '秘法反击',
            来源: '奥法骑士 15级',
            类型: '反应',
            描述: '当你看到一个生物在你身边60尺内施法时，你可以用你的反应来进行一次武器攻击来打断它。如果命中，该生物在进行维持法术专注的豁免检定时具有劣势。',
          },
        ],
        18: [
          {
            名称: '精通战争魔法',
            来源: '奥法骑士 18级',
            类型: '动作',
            描述: '当你在你的回合中使用动作施展一个法术时，你可以用一个附赠动作进行一次武器攻击。',
          },
        ],
      },
    },
  },
  法师: {
    塑能学派: {
      featuresByLevel: {
        2: [
          {
            名称: '法术塑形',
            来源: '塑能学派 2级',
            类型: '被动',
            描述: '当你施展一个塑能系法术时，你可以指定一定数量的生物（数量等于1+法术环阶），这些生物在该法术的豁免检定中将自动成功，且不会受到任何伤害。',
          },
        ],
        6: [
          {
            名称: '强效戏法',
            来源: '塑能学派 6级',
            类型: '被动',
            描述: '当你施展一个塑能系戏法时，你可以将你的智力调整值加到该戏法的一次伤害掷骰上。',
          },
        ],
        10: [
          {
            名称: '充能塑能',
            来源: '塑能学派 10级',
            类型: '动作',
            描述: '你可以将能量储存在体内。当你施展一个1环或更高环阶的塑能法术时，你可以用该次施法为自己充能。充能后，你下一次用塑能法术造成的伤害，可以获得等于你法师等级一半的额外伤害。',
          },
        ],
        14: [
          {
            名称: '能量过载',
            来源: '塑能学派 14级',
            类型: '动作',
            描述: '当你施展一个法师法术时，你可以选择将该法术的伤害最大化。每日一次。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
          },
        ],
      },
    },
    防护学派: {
      featuresByLevel: {
        2: [
          {
            名称: '奥术守御',
            来源: '防护学派 2级',
            类型: '资源',
            描述: '你获得一个魔法守御，其生命值等于（你的法师等级x2）+你的智力调整值。每当你受到伤害，都由守御代替你承受。守御生命值为0时失效。每次长休后守御恢复所有生命值。',
            资源: { 最大次数: '等级x2+智调', 剩余次数: '等级x2+智调', 恢复方式: '长休' },
          },
          {
            名称: '守御充能',
            来源: '防护学派 2级',
            类型: '被动',
            描述: '当你施展一个1环或更高环阶的防护系法术时，你的奥术守御将恢复等同于（法术环阶x2）的生命值。',
          },
        ],
        6: [
          {
            名称: '投射守御',
            来源: '防护学派 6级',
            类型: '反应',
            描述: '当你30尺内一个你能看见的生物将要受到伤害时，你可以用你的反应启动你的奥术守御来为该生物吸收伤害。',
          },
        ],
        10: [
          {
            名称: '精通防护',
            来源: '防护学派 10级',
            类型: '被动',
            描述: '当你必须进行一次需要你施展法术来反制或解除的豁免检定时，例如解除魔法，你可以在该次属性检定上加上你的熟练加值。',
          },
        ],
        14: [
          {
            名称: '法术抗力',
            来源: '防护学派 14级',
            类型: '被动',
            描述: '你对法术的豁免检定具有优势，并且其他生物对你的法术进行的豁免检定具有劣势。',
          },
        ],
      },
    },
    咒法学派: {
      featuresByLevel: {
        2: [
          {
            名称: '次级咒法',
            来源: '咒法学派 2级',
            类型: '动作',
            描述: '以一个动作，你可以在你手中或地面上召唤出一个3尺见方，重量不超过10磅的无生命物体。该物体存在1小时或直到你再次使用此特性。',
          },
        ],
        6: [
          {
            名称: '移形换位',
            来源: '咒法学派 6级',
            类型: '动作',
            描述: '以一个动作，你可以传送最多30尺的距离到一个未被占据的空间。或者，你可以与一个自愿的中型或小型生物交换位置。',
          },
        ],
        10: [
          {
            名称: '专注咒法',
            来源: '咒法学派 10级',
            类型: '被动',
            描述: '当你因受到伤害而必须进行维持咒法系法术专注的体质豁免时，你具有优势。',
          },
        ],
        14: [
          {
            名称: '强力召唤',
            来源: '咒法学派 14级',
            类型: '被动',
            描述: '任何你通过咒法系法术召唤或创造的生物，都可以获得30点临时生命值。',
          },
        ],
      },
    },
  },
  盗贼: {
    刺客: {
      featuresByLevel: {
        3: [
          {
            名称: '刺杀',
            来源: '刺客 3级',
            类型: '被动',
            描述: '你对一个尚未行动的生物发动的任何攻击检定都具有优势。',
          },
          {
            名称: '出其不意',
            来源: '刺客 3级',
            类型: '被动',
            描述: '任何你对一个处于受惊状态的生物发动的攻击，只要命中，就必定是重击。',
          },
        ],
        9: [
          {
            名称: '渗透专家',
            来源: '刺客 9级',
            类型: '被动',
            描述: '你可以完美地伪造另一个人的言谈、书写和行为，花费七天和25gp即可建立一个新的身份。',
          },
        ],
        13: [
          {
            名称: '易容大师',
            来源: '刺客 13级',
            类型: '被动',
            描述: '你可以花费1分钟完美地模仿另一个类人生物的言行举止，让你在任何欺瞒检定中都具有优势。',
          },
        ],
        17: [
          {
            名称: '一击必杀',
            来源: '刺客 17级',
            类型: '被动',
            描述: '当你对一个受惊的生物发动攻击并命中时，该生物必须进行一次体质豁免（DC=8+你的熟练加值+你的敏捷调整值）。豁免失败则其受到的伤害加倍。',
          },
        ],
      },
    },
    诡术师: {
      featuresByLevel: {
        3: [
          {
            名称: '诡术师施法',
            来源: '诡术师 3级',
            类型: '施法',
            描述: '你获得施展法师法术的能力。你的施法关键属性为智力。你主要学习惑控系和幻术系法术。',
          },
          {
            名称: '法师之手戏法',
            来源: '诡术师 3级',
            类型: '被动',
            描述: '你学会法师之手戏法，并且可以使其隐形。你还可以用它来完成一些特殊任务，例如开锁、解除陷阱或从他人身上扒窃。',
          },
        ],
        9: [
          {
            名称: '魔法伏击',
            来源: '诡术师 9级',
            类型: '被动',
            描述: '如果你处于躲藏状态，你对一个生物施展法术时，该生物对该法术的豁免检定具有劣势。',
          },
        ],
        13: [
          {
            名称: '万能诡计',
            来源: '诡术师 13级',
            类型: '动作',
            描述: '以一个动作，你可以将你的法师之手转移到你30尺内一个你能看见的生物身上。这会让你在该生物身边的下一次攻击检定中获得优势。',
          },
        ],
        17: [
          {
            名称: '法术盗贼',
            来源: '诡术师 17级',
            类型: '反应',
            描述: '当一个生物对你施展法术时，你可以用你的反应强迫该生物进行一次豁免检定。如果失败，该法术对你无效，并且你“偷”得此法术。在接下来的8小时内，你可以用盗贼法术位施展它。',
          },
        ],
      },
    },
    盗法者: {
      featuresByLevel: {
        3: [
          {
            名称: '快速巧手',
            来源: '盗法者 3级',
            类型: '动作',
            描述: '你可以在你的回合中用一个附赠动作，来使用盗贼工具解除陷阱、打开一个锁，或者进行一次敏捷（巧手）检定。',
          },
          {
            名称: '二楼故事',
            来源: '盗法者 3级',
            类型: '被动',
            描述: '你的攀爬不再消耗额外移动力。此外，当你进行奔跑跳跃时，跳跃距离增加等同于你敏捷调整值的尺数。',
          },
        ],
        9: [
          {
            名称: '至高潜行',
            来源: '盗法者 9级',
            类型: '被动',
            描述: '当你以正常速度的一半移动时，你在进行敏捷（隐匿）检定时具有优势。',
          },
        ],
        13: [
          {
            名称: '运用魔法装置',
            来源: '盗法者 13级',
            类型: '被动',
            描述: '你学会了如何使用几乎所有魔法物品，即使你并未满足其职业、种族和等级的要求。',
          },
        ],
        17: [
          {
            名称: '盗贼直觉',
            来源: '盗法者 17级',
            类型: '被动',
            描述: '你可以在你的回合中获得两个回合。你在你的正常先攻位置行动，并在先攻-10的位置再次行动。你不能在第二次行动中使用反应。',
          },
        ],
      },
    },
  },
  牧师: {
    生命领域: {
      featuresByLevel: {
        1: [
          { 名称: '重甲熟练', 来源: '生命领域 1级', 类型: '被动', 描述: '你获得重甲的熟练项。' },
          {
            名称: '生命信徒',
            来源: '生命领域 1级',
            类型: '被动',
            描述: '当你使用1环或更高环阶的法术恢复生命值时，该生物可以额外恢复 2 + 法术环阶 的生命值。',
          },
        ],
        2: [
          {
            名称: '引导神力：维系生命',
            来源: '生命领域 2级',
            类型: '动作',
            描述: '以一个动作，你可以引导神圣能量恢复总计为（你的牧师等级x5）的生命值。你可以将这些生命值分配给你30尺内任意数量的生物，但不能使任何生物的生命值超过其上限的一半。',
          },
        ],
        6: [
          {
            名称: '受佑治疗者',
            来源: '生命领域 6级',
            类型: '被动',
            描述: '当你使用1环或更高环阶的法术为其他生物恢复生命值时，你自身也会恢复 2 + 法术环阶 的生命值。',
          },
        ],
        8: [
          {
            名称: '神圣打击',
            来源: '生命领域 8级',
            类型: '被动',
            描述: '每回合一次，当你用武器攻击命中一个生物时，该次攻击可以额外造成 1d8 光耀伤害。',
          },
        ],
        17: [
          {
            名称: '至高治疗',
            来源: '生命领域 17级',
            类型: '被动',
            描述: '当你为他人恢复生命值而掷骰时，你可以不用掷骰，而是直接取最大可能结果。',
          },
        ],
      },
    },
    知识领域: {
      featuresByLevel: {
        1: [
          {
            名称: '知识祝福',
            来源: '知识领域 1级',
            类型: '被动',
            描述: '你学会两种语言，并在两项你选择的技能（奥秘、历史、自然、宗教）上获得双倍熟练加值。',
          },
        ],
        2: [
          {
            名称: '引导神力：知识渠道',
            来源: '知识领域 2级',
            类型: '动作',
            描述: '以一个动作，你可以引导神力来获得某项技能或工具的熟练项，持续10分钟。',
          },
        ],
        6: [
          {
            名称: '引导神力：读取思想',
            来源: '知识领域 6级',
            类型: '动作',
            描述: '以一个动作，你可以引导神力来施展侦测思想法术，而无需消耗法术位。你也可以用心灵感应与目标交流。',
          },
        ],
        8: [
          {
            名称: '强效施法',
            来源: '知识领域 8级',
            类型: '被动',
            描述: '你将你的感知调整值加到你所有牧师戏法的伤害掷骰上。',
          },
        ],
        17: [
          {
            名称: '知识幻景',
            来源: '知识领域 17级',
            类型: '动作',
            描述: '你可以通过冥想来观看一个地方的过去或现在的幻景，获得关于重要事件、人物或物体的信息。',
          },
        ],
      },
    },
    诡术领域: {
      featuresByLevel: {
        1: [
          {
            名称: '诡术祝福',
            来源: '诡术领域 1级',
            类型: '动作',
            描述: '以一个动作，你可以触摸一个自愿的生物，使其在敏捷（隐匿）检定上具有优势，持续1小时或直到你再次使用此特性。',
          },
        ],
        2: [
          {
            名称: '引导神力：召唤分身',
            来源: '诡术领域 2级',
            类型: '动作',
            描述: '以一个动作，你创造一个完美的幻影分身，持续1分钟或直到你失去专注。你可以用附赠动作移动分身，并且你可以从分身的位置施展法术。',
          },
        ],
        6: [
          {
            名称: '引导神力：化暗为影',
            来源: '诡术领域 6级',
            类型: '反应',
            描述: '当一个生物攻击你时，你可以用你的反应变得隐形，直到你的下个回合结束或你攻击或施法为止。',
          },
        ],
        8: [
          {
            名称: '神圣打击',
            来源: '诡术领域 8级',
            类型: '被动',
            描述: '每回合一次，当你用武器攻击命中一个生物时，该次攻击可以额外造成 1d8 毒素伤害。',
          },
        ],
        17: [
          {
            名称: '精通分身',
            来源: '诡术领域 17级',
            类型: '动作',
            描述: '当你使用“召唤分身”时，你可以创造四个分身而非一个。你可以用一个附赠动作同时移动它们。',
          },
        ],
      },
    },
  },
  吟游诗人: {
    逸乐学院: {
      featuresByLevel: {
        3: [
          { 名称: '额外熟练项', 来源: '逸乐学院 3级', 类型: '被动', 描述: '你获得三项任意技能的熟练项。' },
          {
            名称: '削弱攻击',
            来源: '逸乐学院 3级',
            类型: '反应',
            描述: '当你用吟游诗人激励激励一个盟友后，你可以用你的反应来消耗另一个激励骰。选择一个你能看见的生物，其下一次武器攻击的伤害掷骰将减去你激励骰的结果。',
          },
        ],
        6: [
          {
            名称: '额外魔法奥秘',
            来源: '逸乐学院 6级',
            类型: '被动',
            描述: '你可以从任何职业的法术列表中选择两个法术（环阶不能高于你所能施展的最高环阶），它们将视为你的吟游诗人法术。',
          },
        ],
        14: [
          {
            名称: '精湛技艺',
            来源: '逸乐学院 14级',
            类型: '动作',
            描述: '当你进行一次属性检定时，你可以消耗一次吟游诗人激励的使用次数，并将激励骰的结果加到你的属性检定上。你可以在掷骰后，但在得知结果前决定是否使用。',
          },
        ],
      },
    },
    勇气学院: {
      featuresByLevel: {
        3: [
          { 名称: '战斗熟练', 来源: '勇气学院 3级', 类型: '被动', 描述: '你获得中甲、盾牌和军用武器的熟练项。' },
          {
            名称: '战斗激励',
            来源: '勇气学院 3级',
            类型: '被动',
            描述: '一个受你吟游诗人激励影响的生物，可以选择将激励骰加到武器伤害掷骰上，或用反应将激励骰加到AC上以应对一次攻击。',
          },
        ],
        6: [
          {
            名称: '额外攻击',
            来源: '勇气学院 6级',
            类型: '被动',
            描述: '当你在你的回合中执行攻击动作时，你可以攻击两次而非一次。',
          },
        ],
        14: [
          {
            名称: '战争魔法',
            来源: '勇气学院 14级',
            类型: '动作',
            描述: '当你在你的回合中使用动作施展一个吟游诗人法术时，你可以用一个附赠动作进行一次武器攻击。',
          },
        ],
      },
    },
    逸闻学院: {
      // 虽然 SRD 中没有，但这是最经典的学院之一
      featuresByLevel: {
        3: [
          {
            名称: '尖酸嘲讽',
            来源: '逸闻学院 3级',
            类型: '反应',
            描述: '当一个你能看见的生物进行攻击、伤害或属性检定时，你可以用你的反应消耗一次吟游诗人激励，掷出激励骰并从对方的掷骰结果中减去该数值。',
          },
        ],
        6: [
          {
            名称: '额外魔法奥秘',
            来源: '逸闻学院 6级',
            类型: '被动',
            描述: '你可以从任何职业的法术列表中选择两个法术（环阶不能高于你所能施展的最高环阶），它们将视为你的吟游诗人法术。',
          },
        ],
        14: [
          {
            名称: '无双技艺',
            来源: '逸闻学院 14级',
            类型: '动作',
            描述: '当你进行一次属性检定时，你可以消耗一次吟游诗人激励的使用次数，并将激励骰的结果加到你的属性检定上。你可以在掷骰后，但在得知结果前决定是否使用。',
          },
        ],
      },
    },
  },
  圣武士: {
    奉献之誓: {
      featuresByLevel: {
        3: [
          {
            名称: '引导神力：圣洁武器',
            来源: '奉献之誓 3级',
            类型: '动作',
            描述: '以一个动作，你可以引导神力，让你的武器散发圣光。在1分钟内，你的武器攻击检定可以加上你的魅力调整值。',
          },
          {
            名称: '引导神力：驱散不洁',
            来源: '奉献之誓 3级',
            类型: '动作',
            描述: '以一个动作，你可以展现你的圣徽，驱散30尺内的邪魔和亡灵。',
          },
        ],
        7: [
          {
            名称: '奉献灵光',
            来源: '奉献之誓 7级',
            类型: '被动',
            描述: '你和你10尺内的任何友方生物不会陷入魅惑状态。',
          },
        ],
        15: [
          { 名称: '不灭虔诚', 来源: '奉献之誓 15级', 类型: '被动', 描述: '你获得对法术和其他魔法效应的豁免检定优势。' },
        ],
        20: [
          {
            名称: '神圣使者',
            来源: '奉献之誓 20级',
            类型: '动作',
            描述: '以一个动作，你可以化身为神圣的化身，持续1分钟。你散发30尺的明亮光环，你和你光环内的盟友对邪魔和亡灵的攻击具有优势。',
          },
        ],
      },
    },
    复仇之誓: {
      featuresByLevel: {
        3: [
          {
            名称: '引导神力：憎恶敌人',
            来源: '复仇之誓 3级',
            类型: '动作',
            描述: '以一个附赠动作，你可以引导神力诅咒一个生物。在1分钟内，你对该生物的攻击检定具有优势。',
          },
          {
            名称: '引导神力：猎物誓言',
            来源: '复仇之誓 3级',
            类型: '动作',
            描述: '当你用一个机会攻击命中一个生物时，你可以立即移动最多等于你速度一半的距离。',
          },
        ],
        7: [
          {
            名称: '无情复仇者',
            来源: '复仇之誓 7级',
            类型: '被动',
            描述: '你学会了如何阻止敌人逃跑。当你用一个机会攻击命中一个生物时，你可以将其速度降至0，直到回合结束。',
          },
        ],
        15: [
          {
            名称: '坚韧灵魂',
            来源: '复仇之誓 15级',
            类型: '被动',
            描述: '当你生命值降至0但又没有被直接杀死时，你可以选择生命值变为1。长休后可再次使用。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
          },
        ],
        20: [
          {
            名称: '复仇天使',
            来源: '复仇之誓 20级',
            类型: '动作',
            描述: '以一个动作，你可以化身为复仇的化身，长出翅膀并获得飞行速度，持续1小时。期间，你散发30尺的威胁灵光，进入或开始回合于其中的敌人必须进行豁免，否则陷入恐慌。',
          },
        ],
      },
    },
    忠诚之誓: {
      // PHB 中的 "Crown Oath"
      featuresByLevel: {
        3: [
          {
            名称: '引导神力：拥护挑战',
            来源: '忠诚之誓 3级',
            类型: '动作',
            描述: '以一个动作，你可以强迫30尺内所有生物进行感知豁免。失败者在1分钟内不能主动远离你超过30尺。',
          },
          {
            名称: '引导神力：扭转战局',
            来源: '忠诚之誓 3级',
            类型: '动作',
            描述: '以一个附赠动作，你可以治疗一个30尺内的盟友，恢复1d6+你的魅力调整值点生命值。',
          },
        ],
        7: [
          {
            名称: '神圣忠诚',
            来源: '忠诚之誓 7级',
            类型: '反应',
            描述: '当一个5尺内的盟友将要受到伤害时，你可以用你的反应魔法性地代替他承受该次伤害。',
          },
        ],
        15: [{ 名称: '坚贞不屈', 来源: '忠诚之誓 15级', 类型: '被动', 描述: '你对麻痹和震慑状态的豁免具有优势。' }],
        20: [
          {
            名称: '正义化身',
            来源: '忠诚之誓 20级',
            类型: '动作',
            描述: '以一个动作，你可以化身为忠诚的化身，持续1小时。你获得对非魔法的挥砍、穿刺、钝击伤害的抗性，并且你和你盟友的豁免检定具有优势。',
          },
        ],
      },
    },
  },
  游侠: {
    猎人: {
      featuresByLevel: {
        3: [
          {
            名称: '猎人猎物',
            来源: '猎人 3级',
            类型: '被动',
            描述: '你获得一项猎人猎物特性，从“巨像杀手”、“部落破坏者”或“巨兽屠夫”中选择其一。',
          },
        ],
        7: [
          {
            名称: '防御战术',
            来源: '猎人 7级',
            类型: '被动',
            描述: '你获得一项防御战术特性，从“脱离兽群”、“多重攻击防御”或“钢铁意志”中选择其一。',
          },
        ],
        11: [
          {
            名称: '多重攻击',
            来源: '猎人 11级',
            类型: '被动',
            描述: '你获得一项多重攻击特性，从“乱射”或“旋风攻击”中选择其一。',
          },
        ],
        15: [
          {
            名称: '高等猎人猎物',
            来源: '猎人 15级',
            类型: '被动',
            描述: '你获得一项高等猎人猎物特性，从“闪避大师”、“恐怖巨兽”或“躲避反击”中选择其一。',
          },
        ],
      },
    },
    驯兽师: {
      featuresByLevel: {
        3: [
          {
            名称: '游侠伴侣',
            来源: '驯兽师 3级',
            类型: '被动',
            描述: '你获得一个野兽伙伴，它会服从你的命令。在战斗中，你可以用你的动作命令它进行攻击。',
          },
        ],
        5: [
          {
            类型: 'Upgrade',
            来源: '驯兽师 5级',
            targetFeature: '游侠伴侣',
            updates: [
              {
                path: '描述',
                value:
                  '你的野兽伙伴可以在你的回合中，无需你花费动作命令，自行进行移动和闪避。你依然需要用动作命令它攻击。',
              },
            ],
          },
        ],
        7: [
          {
            名称: '协同攻击',
            来源: '驯兽师 7级',
            类型: '被动',
            描述: '当你使用攻击动作时，如果你的野兽伙伴能看见你，它可以用它的反应进行一次近战攻击。',
          },
        ],
        11: [
          { 名称: '野兽之怒', 来源: '驯兽师 11级', 类型: '被动', 描述: '你的野兽伙伴可以在一次攻击动作中攻击两次。' },
        ],
        15: [
          {
            名称: '共享法术',
            来源: '驯兽师 15级',
            类型: '被动',
            描述: '当你施展一个以自身为目标的法术时，如果你的野兽伙伴在30尺内，你也可以让它同时获得该法术的效果。',
          },
        ],
      },
    },
    幽影巡林客: {
      // Xanathar's Guide to Everything, a very popular choice
      featuresByLevel: {
        3: [
          {
            名称: '恐惧伏击',
            来源: '幽影巡林客 3级',
            类型: '被动',
            描述: '在你的先攻检定上，你可以加上你的感知调整值。在你的第一个战斗回合，你的移动速度增加10尺，并且可以进行一次额外的武器攻击，造成额外1d8伤害。',
          },
          {
            名称: '暗影视觉',
            来源: '幽影巡林客 3级',
            类型: '被动',
            描述: '你获得30尺的黑暗视觉。如果你已经有黑暗视觉，其范围增加30尺。',
          },
        ],
        7: [
          {
            名称: '暗影行者',
            来源: '幽影巡林客 7级',
            类型: '被动',
            描述: '当你在昏暗光线或黑暗中时，你可以用一个附赠动作变得隐形，直到你攻击、施法或进入明亮光线。',
          },
        ],
        11: [{ 名称: '钢铁意志', 来源: '幽影巡林客 11级', 类型: '被动', 描述: '你对陷入恐慌状态的豁免检定具有优势。' }],
        15: [
          {
            名称: '暗影闪避',
            来源: '幽影巡林客 15级',
            类型: '反应',
            描述: '当一个你能看见的生物将要攻击你时，你可以用你的反应强迫该次攻击具有劣势。你必须在得知攻击结果前使用。',
          },
        ],
      },
    },
  },
  武僧: {
    开放掌之道: {
      featuresByLevel: {
        3: [
          {
            名称: '开放掌法',
            来源: '开放掌之道 3级',
            类型: '被动',
            描述: '当你用疾风连击命中一个生物时，你可以对其施加以下效应之一：目标必须进行敏捷豁免，失败则倒地；目标必须进行力量豁免，失败则被你推开最多15尺；目标在本回合内无法进行反应。',
          },
        ],
        6: [
          {
            名称: '完整之躯',
            来源: '开放掌之道 6级',
            类型: '动作',
            描述: '以一个动作，你可以恢复等同于你武僧等级三倍的生命值。长休后可再次使用。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
          },
        ],
        11: [
          {
            名称: '宁静心境',
            来源: '开放掌之道 11级',
            类型: '被动',
            描述: '在一次长休结束时，你可以进入一种特殊的冥想状态，获得圣域术的效果，持续直到你的下一次长休开始。',
          },
        ],
        17: [
          {
            名称: '颤掌',
            来源: '开放掌之道 17级',
            类型: '动作',
            描述: '当你用徒手打击命中一个生物时，你可以花费3点气在其体内种下致命的震颤。震颤持续等同于你武僧等级的天数。你可以用一个动作终止震颤，若目标当前生命值低于100，则其直接死亡；否则受到10d10力场伤害。',
          },
        ],
      },
    },
    暗影之道: {
      featuresByLevel: {
        3: [
          {
            名称: '暗影技艺',
            来源: '暗影之道 3级',
            类型: '动作',
            描述: '你可以花费2点气来施展黑暗术、黑暗视觉、沉默术或克敌机先，而无需材料构材。',
          },
        ],
        6: [
          {
            名称: '暗影步',
            来源: '暗影之道 6级',
            类型: '动作',
            描述: '当你在昏暗光线或黑暗中时，你可以用一个附赠动作传送最多60尺到一个你能看见的、同样处于昏暗或黑暗中的未被占据空间。你在传送后的第一次近战攻击具有优势。',
          },
        ],
        11: [
          {
            名称: '暗影斗篷',
            来源: '暗影之道 11级',
            类型: '动作',
            描述: '当你在昏暗光线或黑暗中时，你可以用一个动作变得隐形。你将一直保持隐形，直到你攻击、施法或进入明亮光线。',
          },
        ],
        17: [
          {
            名称: '投机打击',
            来源: '暗影之道 17级',
            类型: '反应',
            描述: '当一个30尺内的生物被另一个生物攻击命中时，你可以用你的反应对该生物进行一次近战攻击。',
          },
        ],
      },
    },
    四象之道: {
      featuresByLevel: {
        3: [
          {
            名称: '元素调谐',
            来源: '四象之道 3级',
            类型: '被动',
            描述: '你学会一些次级元素能力，例如创造无害的元素效应，点燃或熄灭火焰等。',
          },
          {
            名称: '元素法门',
            来源: '四象之道 3级',
            类型: '动作',
            描述: '你学会一些元素法门，它们让你能够花费气来施展类似法术的效果，例如“火焰之牙”（燃烧之手）或“风卷残云”（艾伐黑触手）。',
          },
        ],
        6: [
          {
            类型: 'Upgrade',
            来源: '四象之道 6级',
            targetFeature: '元素法门',
            updates: [{ path: '描述', value: '你学会更多元素法门。' }],
          },
        ],
        11: [
          {
            类型: 'Upgrade',
            来源: '四象之道 11级',
            targetFeature: '元素法门',
            updates: [{ path: '描述', value: '你学会更多元素法门。' }],
          },
        ],
        17: [
          {
            类型: 'Upgrade',
            来源: '四象之道 17级',
            targetFeature: '元素法门',
            updates: [{ path: '描述', value: '你学会更多元素法门。' }],
          },
        ],
      },
    },
  },
  术士: {
    龙族血脉: {
      featuresByLevel: {
        1: [
          {
            名称: '龙族先祖',
            来源: '龙族血脉 1级',
            类型: '被动',
            描述: '你选择一种龙作为你的先祖。你获得与该龙类相关的伤害类型的抗性。',
          },
          {
            名称: '龙族韧性',
            来源: '龙族血脉 1级',
            类型: '被动',
            描述: '你的生命值上限额外增加等同于你术士等级的数值。此外，未着装护甲时，你的AC等于 13 + 你的敏捷调整值。',
          },
        ],
        6: [
          {
            名称: '元素亲和',
            来源: '龙族血脉 6级',
            类型: '被动',
            描述: '当你施展一个造成你龙族先祖对应伤害类型的法术时，你可以将你的魅力调整值加到该法术的一次伤害掷骰上。你也可以花费1点术法点来获得该伤害类型的抗性，持续1小时。',
          },
        ],
        14: [
          {
            名称: '龙翼',
            来源: '龙族血脉 14级',
            类型: '动作',
            描述: '以一个附赠动作，你可以从背后长出一对龙翼，获得等同于你当前速度的飞行速度。你可以随时用附赠动作收回龙翼。',
          },
        ],
        18: [
          {
            名称: '龙族气势',
            来源: '龙族血脉 18级',
            类型: '动作',
            描述: '以一个动作，你可以花费5点术法点散发敬畏或恐惧的灵光，持续1分钟。你选择一种效应，60尺内的所有敌人都必须进行感知豁免，失败则陷入魅惑或恐慌。',
          },
        ],
      },
    },
    狂野魔法: {
      featuresByLevel: {
        1: [
          {
            名称: '狂野魔法浪涌',
            来源: '狂野魔法 1级',
            类型: '被动',
            描述: '当你施展一个1环或更高环阶的术士法术时，DM可以让你投掷一次d20。如果结果为1，则投掷狂野魔法浪涌表来创造一个随机的魔法效应。',
          },
          {
            名称: '命运浪潮',
            来源: '狂野魔法 1级',
            类型: '被动',
            描述: '你获得操控命运的能力。你可以在一次攻击、豁免或属性检定上获得优势。使用后，DM可以让你在施法后强制触发一次狂野魔法浪涌来恢复此能力。每日两次。',
            资源: { 最大次数: 2, 剩余次数: 2, 恢复方式: '长休' },
          },
        ],
        6: [
          {
            名称: '扭转天命',
            来源: '狂野魔法 6级',
            类型: '反应',
            描述: '当一个你能看见的生物进行一次攻击、豁免或属性检定时，你可以用你的反应花费2点术法点，让该次掷骰加上或减去1d4。',
          },
        ],
        14: [
          {
            名称: '受控混沌',
            来源: '狂野魔法 14级',
            类型: '被动',
            描述: '当你投掷狂野魔法浪涌表时，你可以投掷两次，并从两个结果中选择一个你希望生效的。',
          },
        ],
        18: [
          {
            名称: '法术轰炸',
            来源: '狂野魔法 18级',
            类型: '被动',
            描述: '当你为一个法术投掷伤害骰，且其中一个骰子的结果为最大值时，你可以再投掷一个同类型的伤害骰并加入总伤害中。',
          },
        ],
      },
    },
    神圣灵魂: {
      // Xanathar's Guide to Everything
      featuresByLevel: {
        1: [
          {
            名称: '神圣魔法',
            来源: '神圣灵魂 1级',
            类型: '被动',
            描述: '你从善良、邪恶、秩序、混乱或中立中选择一种神圣倾向。你获得一个对应倾向的牧师法术，并且可以学习牧师法术列表中的法术。',
          },
          {
            名称: '受佑者',
            来源: '神圣灵魂 1级',
            类型: '被动',
            描述: '当一个你能看见的生物进行一次豁免检定或攻击检定时，你可以花费1点术法点，掷出2d4并将其结果加到对方的掷骰上。短休后可再次使用。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '短休' },
          },
        ],
        6: [
          {
            名称: '赋能治疗',
            来源: '神圣灵魂 6级',
            类型: '被动',
            描述: '当你或一个盟友掷骰来恢复生命值时，你可以花费1点术法点，重掷任意数量的骰子。',
          },
        ],
        14: [
          {
            名称: '天使形态',
            来源: '神圣灵魂 14级',
            类型: '动作',
            描述: '以一个附赠动作，你可以花费5点术法点长出天使之翼，获得30尺飞行速度，持续1分钟。',
          },
        ],
        18: [
          {
            名称: '超凡恢复',
            来源: '神圣灵魂 18级',
            类型: '动作',
            描述: '以一个附赠动作，你可以恢复最多等于你生命值上限一半的生命值。长休后可再次使用。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '长休' },
          },
        ],
      },
    },
  },
  邪术师: {
    邪魔: {
      featuresByLevel: {
        1: [
          {
            名称: '黑暗祝福',
            来源: '邪魔 1级',
            类型: '被动',
            描述: '当你将一个敌对生物的生命值降至0时，你获得等同于你的邪术师等级 + 你的魅力调整值的临时生命值。',
          },
        ],
        6: [
          {
            名称: '黑暗气运',
            来源: '邪魔 6级',
            类型: '被动',
            描述: '当你进行一次属性检定或豁免检定时，你可以将一个d10加到你的结果上。你可以在掷骰后，但在得知结果前决定是否使用。短休或长休后可再次使用。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '短休' },
          },
        ],
        10: [
          {
            名称: '邪魔韧性',
            来源: '邪魔 10级',
            类型: '被动',
            描述: '你选择一种伤害类型，获得对其的抗性。你可以在完成一次短休或长休后更换选择的伤害类型。',
          },
        ],
        14: [
          {
            名称: '地狱穿行',
            来源: '邪魔 14级',
            类型: '动作',
            描述: '以一个动作，你可以将一个生物瞬间传送至下层位面。目标会短暂消失并受到10d10心灵伤害，然后在你的下个回合结束时回到原地。',
          },
        ],
      },
    },
    巨龙宗主: {
      // Xanathar's Guide to Everything
      featuresByLevel: {
        1: [
          {
            名称: '龙之韧性',
            来源: '巨龙宗主 1级',
            类型: '被动',
            描述: '当你未着装护甲时，你的AC等于 13 + 你的敏捷调整值。',
          },
          {
            名称: '龙之感知',
            来源: '巨龙宗主 1级',
            类型: '被动',
            描述: '你对历史检定具有优势，只要该检定与龙有关。此外，你能以龙语说、读、写。',
          },
        ],
        6: [
          {
            名称: '龙息',
            来源: '巨龙宗主 6级',
            类型: '动作',
            描述: '以一个动作，你可以喷吐出毁灭性的能量。所有30尺锥形范围内的生物必须进行敏捷豁免，失败则受到等同于你邪术师等级一半d6的伤害，成功则减半。短休或长休后可再次使用。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '短休' },
          },
        ],
        10: [
          {
            名称: '龙魂',
            来源: '巨龙宗主 10级',
            类型: '被动',
            描述: '你获得对你宗主龙对应伤害类型的抗性。此外，当你施展一个造成该类型伤害的法术时，你可以将你的魅力调整值加到一次伤害掷骰上。',
          },
        ],
        14: [
          {
            名称: '龙之心',
            来源: '巨龙宗主 14级',
            类型: '动作',
            描述: '以一个动作，你可以将恐惧或魅惑的灵光散布到周围30尺。所有你选择的生物必须进行感知豁免，失败则陷入恐慌或魅惑状态，持续1分钟。',
          },
        ],
      },
    },
    旧日支配者: {
      featuresByLevel: {
        1: [
          {
            名称: '唤醒心灵',
            来源: '旧日支配者 1级',
            类型: '被动',
            描述: '你可以与30尺内任何你能看见的生物进行心灵感应交流。你无需与它有共通语言。',
          },
        ],
        6: [
          {
            名称: '熵力结界',
            来源: '旧日支配者 6级',
            类型: '反应',
            描述: '当一个生物对你进行攻击检定时，你可以用你的反应强迫该次攻击具有劣势。如果攻击因此失手，你在你的下个回合对该生物的第一次攻击具有优势。短休或长休后可再次使用。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '短休' },
          },
        ],
        10: [
          {
            名称: '思想之盾',
            来源: '旧日支配者 10级',
            类型: '被动',
            描述: '你的思想无法被读取，除非你自愿。你获得心灵伤害抗性，并且每当一个生物对你造成心灵伤害时，它也会受到等量的伤害。',
          },
        ],
        14: [
          {
            名称: '创造奴仆',
            来源: '旧日支配者 14级',
            类型: '动作',
            描述: '以一个动作，你可以触摸一个失能的类人生物，并魔法性地将其变为你的永久奴仆，直到你再次使用此特性或它被移除诅咒。',
          },
        ],
      },
    },
  },
  德鲁伊: {
    月亮结社: {
      featuresByLevel: {
        2: [
          {
            名称: '战斗野性变身',
            来源: '月亮结社 2级',
            类型: '动作',
            描述: '你可以用一个附赠动作而非动作来使用你的野性变身。',
          },
          {
            名称: '结社形态',
            来源: '月亮结社 2级',
            类型: '被动',
            描述: '你的野性变身限制放宽。你可以变身为挑战等级为1或更低的野兽。这个CR上限会随等级提升。',
          },
        ],
        6: [
          {
            名称: '原初打击',
            来源: '月亮结社 6级',
            类型: '被动',
            描述: '你在野兽形态下的攻击在穿透对非魔法攻击的抗性和免疫时，被视为魔法攻击。',
          },
        ],
        10: [
          {
            名称: '元素野性变身',
            来源: '月亮结社 10级',
            类型: '动作',
            描述: '你可以消耗两次野性变身的使用次数，变身为气、土、火或水元素。',
          },
        ],
        14: [
          {
            名称: '千面万相',
            来源: '月亮结社 14级',
            类型: '被动',
            描述: '你学会了随意施展变身术法术而无需消耗法术位。',
          },
        ],
      },
    },
    大地结社: {
      featuresByLevel: {
        2: [
          { 名称: '额外戏法', 来源: '大地结社 2级', 类型: '被动', 描述: '你学会一个额外的德鲁伊戏法。' },
          {
            名称: '自然恢复',
            来源: '大地结社 2级',
            类型: '被动',
            描述: '每日一次，当你完成一次短休后，你可以恢复一些已消耗的法术位。这些法术位的总环阶等级不能超过你德鲁伊等级的一半（向上取整）。',
          },
        ],
        3: [
          {
            名称: '结社法术',
            来源: '大地结社 3级',
            类型: '被动',
            描述: '你选择一种地形（例如：森林）。你获得一系列与该地形相关的额外法术，它们始终处于准备状态且不计入你每日可准备法术的数量。',
          },
        ],
        6: [
          {
            名称: '大地行者',
            来源: '大地结社 6级',
            类型: '被动',
            描述: '移动于非魔法的困难地形时，你无需花费额外的移动力。此外，你在穿行于非魔法植物时具有优势，且不会被其减速或受到伤害。',
          },
        ],
        10: [
          {
            名称: '自然守护',
            来源: '大地结社 10级',
            类型: '被动',
            描述: '你免疫毒素和疾病。此外，精怪和元素生物对你发动攻击时具有劣势，且不能魅惑或恐慌你。',
          },
        ],
        14: [
          {
            名称: '自然庇护',
            来源: '大地结社 14级',
            类型: '被动',
            描述: '当你处于自然环境中时，野兽和植物生物不会主动攻击你，除非被魔法强迫。',
          },
        ],
      },
    },
    梦想结社: {
      // Xanathar's Guide to Everything
      featuresByLevel: {
        2: [
          {
            名称: '月光抚慰',
            来源: '梦想结社 2级',
            类型: '动作',
            描述: '你拥有一个等于你德鲁伊等级d6的治疗骰池。以一个附赠动作，你可以选择一个120尺内的生物，并花费任意数量的骰子为其恢复生命值。',
            资源: { 最大次数: '等级xd6', 剩余次数: '等级xd6', 恢复方式: '长休' },
          },
        ],
        6: [
          {
            名称: '壁炉之家',
            来源: '梦想结社 6级',
            类型: '动作',
            描述: '在一次短休或长休期间，你可以创造一个隐形的魔法庇护所。在其中的生物可以获得额外的临时生命值和隐匿加值。',
          },
        ],
        10: [
          {
            名称: '暗影之路',
            来源: '梦想结社 10级',
            类型: '动作',
            描述: '以一个附赠动作，你可以花费一次野性变身的使用次数，传送最多60尺到一个你能看见的未被占据空间。',
          },
        ],
        14: [
          {
            名称: '夏日之梦',
            来源: '梦想结社 14级',
            类型: '被动',
            描述: '当你使用“月光抚慰”治疗盟友时，你也可以选择终止一个正在影响他们的疾病或状态。',
          },
        ],
      },
    },
  },
  野蛮人: {
    狂战士之道: {
      featuresByLevel: {
        3: [
          {
            名称: '狂热',
            来源: '狂战士之道 3级',
            类型: '动作',
            描述: '当你进入狂暴状态后，你可以在你之后的每个回合中，以一个附赠动作进行一次近战武器攻击。当你狂暴结束时，你会受到1级力竭。',
          },
        ],
        6: [{ 名称: '无心狂怒', 来源: '狂战士之道 6级', 类型: '被动', 描述: '你在狂暴状态下免疫魅惑和恐慌状态。' }],
        10: [
          {
            名称: '威吓仪态',
            来源: '狂战士之道 10级',
            类型: '动作',
            描述: '以一个动作，你可以选择一个30尺内的生物，强迫它进行感知豁免。如果失败，它将陷入对你的恐慌状态。',
          },
        ],
        14: [
          {
            名称: '报复',
            来源: '狂战士之道 14级',
            类型: '反应',
            描述: '当一个在你5尺内的生物对你造成伤害时，你可以用你的反应对该生物进行一次近战武器攻击。',
          },
        ],
      },
    },
    图腾武士之道: {
      featuresByLevel: {
        3: [
          {
            名称: '图腾之魂',
            来源: '图腾武士之道 3级',
            类型: '被动',
            描述: '你选择一种图腾动物（例如：熊、鹰、狼），并获得其对应的特性。例如，选择熊图腾，你在狂暴时将获得对除心灵伤害外的所有伤害的抗性。',
          },
          {
            名称: '精魂求索',
            来源: '图腾武士之道 3级',
            类型: '被动',
            描述: '你获得施展野兽知觉和动物交谈仪式的能力。',
          },
        ],
        6: [
          {
            名称: '图腾之貌',
            来源: '图腾武士之道 6级',
            类型: '被动',
            描述: '你再次选择一种图腾动物（可以与之前不同），并获得其对应的特性。例如，选择鹰图腾，你将获得鹰眼般的视力。',
          },
        ],
        10: [{ 名称: '精魂行者', 来源: '图腾武士之道 10级', 类型: '被动', 描述: '你获得施展与君共梦仪式的能力。' }],
        14: [
          {
            名称: '图腾协调',
            来源: '图腾武士之道 14级',
            类型: '被动',
            描述: '你再次选择一种图腾动物（可以与之前不同），并获得其对应的特性。例如，选择熊图腾，你在狂暴时，敌人在5尺内对除你之外的其他生物发动攻击时具有劣势。',
          },
        ],
      },
    },
    狂热者之道: {
      // Xanathar's Guide to Everything
      featuresByLevel: {
        3: [
          {
            名称: '神圣狂怒',
            来源: '狂热者之道 3级',
            类型: '被动',
            描述: '当你进入狂暴后，在你的第一个回合，你可以对一个目标造成额外的 1d6 + 你野蛮人等级一半 的光耀或黯蚀伤害。',
          },
          {
            名称: '为神而战',
            来源: '狂热者之道 3级',
            类型: '被动',
            描述: '如果一个法术（例如起死回生）将你从死亡中复活，施法者无需提供任何材料构材。',
          },
        ],
        6: [
          {
            名称: '狂热信徒',
            来源: '狂热者之道 6级',
            类型: '被动',
            描述: '你在狂暴状态下，进行豁免检定失败时，你可以选择重掷。每狂暴一次限用一次。',
            资源: { 最大次数: 1, 剩余次数: 1, 恢复方式: '每次狂暴' },
          },
        ],
        10: [
          {
            名称: '狂热仪态',
            来源: '狂热者之道 10级',
            类型: '动作',
            描述: '以一个附赠动作，你可以让10尺内最多10个生物在对抗魅惑和恐慌的豁免中具有优势，持续到你的下个回合开始。',
          },
        ],
        14: [
          {
            名称: '不死狂怒',
            来源: '狂热者之道 14级',
            类型: '被动',
            描述: '当你的生命值降至0时，你不会立即昏迷，而是可以继续战斗。但每次受到伤害或回合开始时，你都必须进行一次死亡豁免。三次失败后你才会死亡。',
          },
        ],
      },
    },
  },
};

const NEW_FEATURE_TEMPLATE = {
  名称: '未知',
  来源: '未知',
  类型: '未知',
  描述: '未知',
  资源: {
    最大次数: '未知',
    剩余次数: '未知',
  },
};

// --- Section 2: 事件监听与规则执行 ---

eventOn('mag_variable_update_ended', variables => {
  const 主角 = _.get(variables, 'stat_data.主角');
  if (!主角) return;

  console.log(`规则引擎：为 [${_.get(主角, '身份.姓名', '未知角色')}] 重新计算并授予/升级特性...`);

  // --- 1. 核心计算函数 (防御性) ---
  const getModifier = score => {
    const numericScore = _.isNumber(score) ? score : 10;
    return Math.floor((numericScore - 10) / 2);
  };
  const calculateMaxHP = character => {
    const hitDiceMap = {
      野蛮人: 12,
      战士: 10,
      圣武士: 10,
      游侠: 10,
      牧师: 8,
      吟游诗人: 8,
      德鲁伊: 8,
      武僧: 8,
      盗贼: 8,
      邪术师: 8,
      法师: 6,
      术士: 6,
    };
    let totalMaxHp = 0;
    const conModifier = getModifier(_.get(character, '属性.体质'));
    const classDetails = _.get(character, '职业详情', {});
    const activeClasses = _.get(character, '职业列表', []);
    if (!_.isArray(activeClasses) || activeClasses.length === 0 || !classDetails[activeClasses[0]])
      return 10 + conModifier;
    const firstClassName = activeClasses[0];
    const firstClassLevel = _.get(classDetails, `${firstClassName}.等级`, 1);
    const firstClassHitDie = hitDiceMap[firstClassName] || 8;
    totalMaxHp += firstClassHitDie + conModifier;
    if (firstClassLevel > 1) totalMaxHp += (firstClassLevel - 1) * (Math.floor(firstClassHitDie / 2) + 1 + conModifier);
    activeClasses.slice(1).forEach(className => {
      const level = _.get(classDetails, `${className}.等级`, 0);
      const hitDie = hitDiceMap[className] || 8;
      if (level > 0) totalMaxHp += level * (Math.floor(hitDie / 2) + 1 + conModifier);
    });
    return totalMaxHp > 0 ? totalMaxHp : 1;
  };
  const calculateAC = character => {
    const dexModifier = getModifier(_.get(character, '属性.敏捷'));
    let finalAC = 10 + dexModifier;
    const armor = _.get(character, '装备栏.护甲', {});
    const shield = _.get(character, '装备栏.副手武器', {});
    const armorACValue = _.parseInt(armor.AC);
    if (_.isFinite(armorACValue)) {
      finalAC = armorACValue;
      const armorType = _.get(armor, '类型', '');
      if (_.isString(armorType)) {
        if (armorType.includes('中甲')) finalAC += Math.min(dexModifier, 2);
        else if (armorType.includes('轻甲')) finalAC += dexModifier;
      }
    }
    const shieldACValue = _.parseInt(shield.AC);
    if (_.isFinite(shieldACValue)) finalAC += shieldACValue;
    return finalAC;
  };
  const calculateSpellcastingStats = (character, proficiencyBonus) => {
    const classDetails = _.get(character, '职业详情', {});
    const activeClasses = _.get(character, '职业列表', []);
    let totalCasterLevel = 0;
    const fullCasters = ['法师', '牧师', '德鲁伊', '术士', '吟游诗人'];
    const halfCasters = ['圣武士', '游侠'];
    if (_.isArray(activeClasses)) {
      activeClasses.forEach(className => {
        const c = classDetails[className];
        if (!c) return;
        if (fullCasters.includes(className)) totalCasterLevel += c.等级;
        else if (halfCasters.includes(className)) totalCasterLevel += Math.floor(c.等级 / 2);
        else if (className === '战士' && c.子职业 === '奥法骑士') totalCasterLevel += Math.floor(c.等级 / 3);
        else if (className === '盗贼' && c.子职业 === '诡术师') totalCasterLevel += Math.floor(c.等级 / 3);
      });
    }
    const spellSlotsTable = [
      [],
      [2],
      [3],
      [4, 2],
      [4, 3],
      [4, 3, 2],
      [4, 3, 3],
      [4, 3, 3, 1],
      [4, 3, 3, 2],
      [4, 3, 3, 3, 1],
      [4, 3, 3, 3, 2],
      [4, 3, 3, 3, 2, 1],
      [4, 3, 3, 3, 2, 1, 1],
      [4, 3, 3, 3, 2, 1, 1],
      [4, 3, 3, 3, 2, 1, 1, 1],
      [4, 3, 3, 3, 2, 1, 1, 1, 1],
      [4, 3, 3, 3, 3, 1, 1, 1, 1],
      [4, 3, 3, 3, 3, 2, 1, 1, 1],
      [4, 3, 3, 3, 3, 2, 2, 1, 1],
      [4, 3, 3, 3, 3, 2, 2, 2, 1],
    ];
    const maxSlots = spellSlotsTable[totalCasterLevel] ?? [];
    const spellDCs = {};
    const spellAttacks = {};
    const activeCasterClasses = _.isArray(activeClasses)
      ? activeClasses.filter(c => _.get(character, `法术系统.施法主属性.${c}`))
      : [];
    activeCasterClasses.forEach(className => {
      const attrName = _.get(character, `法术系统.施法主属性.${className}`);
      const modifier = getModifier(_.get(character, `属性.${attrName}`));
      spellDCs[className] = 8 + proficiencyBonus + modifier;
      spellAttacks[className] = proficiencyBonus + modifier;
    });
    return { totalCasterLevel, maxSlots, spellDCs, spellAttacks };
  };

  // --- 2. 写入计算好的只读数值 ---
  const proficiencyBonus = _.get(主角, '熟练.熟练加值', 2);
  _.set(主角, '战斗.生命值.最大生命值', calculateMaxHP(主角));
  _.set(主角, '战斗.护甲等级', calculateAC(主角));
  if (_.get(主角, '法术系统')) {
    const spellStats = calculateSpellcastingStats(主角, proficiencyBonus);
    _.set(主角, '法术系统.总施法者等级', spellStats.totalCasterLevel);
    _.set(主角, '法术系统.法术豁免DC', spellStats.spellDCs);
    _.set(主角, '法术系统.法术攻击加值', spellStats.spellAttacks);
    const rings = ['一环', '二环', '三环', '四环', '五环', '六环', '七环', '八环', '九环'];
    rings.forEach((ringName, index) => {
      if (_.has(主角, `法术系统.法术位.${ringName}`)) {
        _.set(主角, `法术系统.法术位.${ringName}.最大值`, spellStats.maxSlots[index] || 0);
      }
    });
  }

  // --- 3. 核心功能：高效授予并升级职业特性 ---
  if (!_.has(主角, '系统状态.特性授予记录')) _.set(主角, '系统状态.特性授予记录', {});

  const activeClasses = _.get(主角, '职业列表', []);
  if (_.isArray(activeClasses)) {
    activeClasses.forEach(className => {
      const currentLevel = _.get(主角, `职业详情.${className}.等级`, 0);
      if (currentLevel === 0) return;

      const lastGrantedLevel = _.get(主角, `系统状态.特性授予记录.${className}`, 0);
      const startLevel = lastGrantedLevel + 1;

      for (let i = startLevel; i <= currentLevel; i++) {
        processFeaturesForLevel(className, i, '主职业');

        const subclassName = _.get(主角, `职业详情.${className}.子职业`);
        if (subclassName && subclassName !== '待定') {
          processFeaturesForLevel(className, i, '子职业', subclassName);
        }
      }

      if (currentLevel > lastGrantedLevel) {
        _.set(主角, `系统状态.特性授予记录.${className}`, currentLevel);
        console.log(`[系统状态] 已更新 [${className}] 的特性授予记录至 ${currentLevel} 级。`);
      }
    });
  }

  /**
   * [内部函数] 统一处理指定等级的特性授予和升级
   * @param {string} className - 主职业名
   * @param {number} level - 要处理的等级
   * @param {string} type - '主职业' 或 '子职业'
   * @param {string} [subclassName] - 子职业名 (如果type是'子职业')
   */
function processFeaturesForLevel(className, level, type, subclassName = '') {
  // 注意：我们将 existingFeatureNames 移到循环外获取一次即可
  const existingFeatureNames = _.map(_.get(主角, '能力特性'), '名称');
  let featuresSource = {};

  if (type === '主职业') {
    featuresSource = CLASS_FEATURES_DATA;
  } else {
    featuresSource = SUBCLASS_FEATURES_DATA;
  }

  const path = subclassName
    ? `${className}.${subclassName}.featuresByLevel.${level}`
    : `${className}.featuresByLevel.${level}`;
  const featuresForLevel = _.get(featuresSource, path, []);

  featuresForLevel.forEach(featureData => {
    if (featureData.类型 === 'Upgrade') {
      // 这是升级指令
      const targetName = featureData.targetFeature;
      if (_.has(主角, `能力特性.${targetName}`)) {
        featureData.updates.forEach(update => {
          const fullPath = `能力特性.${targetName}.${update.path}`;
          _.set(主角, fullPath, update.value);
        });
        console.log(`[特性升级] 已为 [${主角.身份.姓名}] 升级${type}特性: [${targetName}]`);
      }
    } else if (!existingFeatureNames.includes(featureData.名称)) {
      // ▼▼▼ 核心修改点 ▼▼▼
      // 使用 else if 替代了原来的 else { if (...) } 结构
      // 这是普通的新特性授予
      const newFeature = JSON.parse(JSON.stringify(NEW_FEATURE_TEMPLATE));
      Object.keys(featureData).forEach(key => {
        _.set(newFeature, key, featureData[key]);
      });
      _.set(主角, `能力特性.${featureData.名称}`, newFeature);
      console.log(`[特性授予] 已为 [${主角.身份.姓名}] 添加${type}特性: [${featureData.名称}]`);
      // 授予新特性后，需要将其名称加入到“已拥有”列表，以防在同一轮循环中被重复判断
      existingFeatureNames.push(featureData.名称);
    }
  });
}

  console.log(`规则引擎：为 [${_.get(主角, '身份.姓名', '未知角色')}] 的处理已全部完成。`);
});
