<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>DnD 最简同层流式</title><script type="module">import{createPinia as e,defineStore as t,storeToRefs as a}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{useFullscreen as n}from'https://testingcf.jsdelivr.net/npm/@vueuse/core/+esm';var l={772:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}}},o={};const r=Vue,s=VueRouter;var c=function e(t){var a=o[t];if(void 0!==a)return a.exports;var n=o[t]={exports:{}};return l[t](n,n.exports,e),n.exports}(772);const i={},d=(0,c.A)(i,[['render',function(e,t){const a=(0,r.resolveComponent)('RouterView');return(0,r.openBlock)(),(0,r.createBlock)(a)}]]),u=d,m=t('chat',()=>{const e=(0,r.ref)(null),t=(0,r.ref)(null),a=(0,r.ref)(''),n=(0,r.ref)(''),l=(0,r.ref)(''),o=(0,r.ref)(''),s=(0,r.ref)(''),c=(0,r.ref)(!1),i=(0,r.ref)(!1),d=(0,r.ref)(null),u=(0,r.computed)(()=>d.value?.['主角']??null),m=(0,r.ref)(null);async function p(e){let t=null;try{if(Number.isFinite(e)){const a=getVariables({type:'message',message_id:e});a&&a.stat_data&&(t=a.stat_data)}}catch{}if(!t)try{const e=getVariables({type:'chat'});e&&e.stat_data&&(t=e.stat_data)}catch{}d.value=t}function v(){try{for(let e=getLastMessageId();e>=0;e--){const t=getChatMessages(e)[0]||{};if('user'===t?.role)return e}}catch{}return null}async function y(r){e.value=r;let s=null;if(a.value='',n.value='',l.value='',o.value='',null==r)return;let c=null;try{c=getChatMessages(r)[0]||{}}catch{const e=v();return null!=e&&e!==r?void await y(e):void 0}if(c){l.value=String(c.message||'');try{a.value=await formatAsDisplayedMessage(String(c.message||''))}catch{a.value=String(c.message||'')}}try{const e=getChatMessages(r+1)[0]||{};if(e&&'assistant'===e.role){s=r+1,o.value=String(e.message||'');try{n.value=await formatAsDisplayedMessage(String(e.message||''))}catch{n.value=String(e.message||'')}}}catch{}t.value=s,await p(s??r)}function f(){if(null!=e.value)for(let t=e.value-1;t>=0;t--)try{const e=getChatMessages(t)[0]||{};if('user'===e?.role)return void y(t)}catch{continue}}return{pairUserId:e,pairAssistantId:t,pairUserHtml:a,pairAssistantHtml:n,pairUserRaw:l,pairAssistantRaw:o,input:s,isRerolling:c,isGenerating:i,mvu:d,mainChar:u,lastUserId:v,renderPairByUserId:y,pagePrevPair:f,pageNextPair:function(){try{const t=getLastMessageId();for(let a=(e.value??-1)+1;a<=t;a++)try{const e=getChatMessages(a)[0]||{};if('user'===e?.role)return void y(a)}catch{continue}}catch{}},deleteById:async function(t){const a='number'==typeof t?t:void 0;if(!Number.isFinite(a))return;await deleteChatMessages([a],{refresh:'none'});const n=e.value;n===a?f():y(n)},editById:async function(r,s){const c='number'==typeof r?r:void 0;if(!Number.isFinite(c))return;const i=(getChatMessages(c)[0]||{})?.message||'',d=void 0!==s?String(s):window.prompt('编辑内容',String(i));if(null!=d){await setChatMessages([{message_id:c,message:String(d)}],{refresh:'affected'});try{if(c===e.value){l.value=String(d);try{a.value=await formatAsDisplayedMessage(String(d))}catch{a.value=String(d)}}if(c===t.value){o.value=String(d);try{n.value=await formatAsDisplayedMessage(String(d))}catch{n.value=String(d)}}}catch{}await new Promise(e=>setTimeout(e,120)),y(e.value)}},onReroll:async function(a){if(null==e.value)return;const l=getChatMessages(e.value)[0]||{};if('user'===l?.role){try{const e=getChatMessages(getLastMessageId())[0]||{};console.log('next',e),'assistant'===e?.role&&(console.log('getLastMessageId()',getLastMessageId()),await deleteChatMessages([getLastMessageId()],{refresh:'none'}))}catch{}await createChatMessages([{role:'assistant',message:''}],{refresh:'affected'});try{const e=getLastMessageId();m.value=e,t.value=e,n.value='';try{const t=Number(e)-1;if(Number.isFinite(t)&&t>=0){const a=Mvu.getMvuData({type:'message',message_id:t})||{};await Mvu.replaceMvuData(a,{type:'message',message_id:e})}}catch{}}catch{}c.value=!0,i.value=!0;try{await generate({user_input:String(l.message||''),should_stream:a})}finally{i.value=!1}}},onSend:async function(o){const r=String(s.value||'').trim();if(!r)return;await createChatMessages([{role:'user',message:r}],{refresh:'affected'});let c=null;try{c=getLastMessageId(),e.value=c}catch(e){}await createChatMessages([{role:'assistant',message:''}],{refresh:'affected'}),s.value='';try{const e=getLastMessageId();m.value=e,t.value=e,n.value=''}catch{}l.value=r;try{a.value=await formatAsDisplayedMessage(r)}catch{a.value=r}o&&(n.value=''),i.value=!0;try{await generate({user_input:r,should_stream:o})}finally{i.value=!1}},stopAll:async function(){try{await stopAllGeneration()}catch(e){}i.value=!1,c.value=!1},init:function(a){const l=async e=>{if(a.value)try{n.value=await formatAsDisplayedMessage(e||'')}catch{n.value=e||''}},o=async a=>{const l=String(a||'');try{n.value=await formatAsDisplayedMessage(l)}catch{n.value=l}try{c.value,null!=m.value?await setChatMessages([{message_id:m.value,message:l}],{refresh:'affected'}):await createChatMessages([{role:'assistant',message:l}],{refresh:'affected'}),parent&&'function'==typeof parent.handleVariablesInMessage&&await parent.handleVariablesInMessage(getLastMessageId())}catch{}c.value=!1,i.value=!1,m.value=null;const o=v();if(await p(getLastMessageId()),null!=o){e.value=o;const a=getChatMessages(o+1)[0]||{};t.value='assistant'===a?.role?o+1:null}};'function'==typeof globalThis.eventOn&&(eventOn(iframe_events.GENERATION_STARTED,()=>{i.value=!0}),eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY,l),eventOn(iframe_events.GENERATION_ENDED,o),eventOn(tavern_events.GENERATION_STOPPED,()=>{i.value=!1,c.value=!1}),eventOn(tavern_events.GENERATION_ENDED,()=>{i.value=!1,c.value=!1})),(async()=>{await p(v()),y(v())})()},refreshMvuPreferMessage:p}}),p={class:'panel glass'},v=(0,r.defineComponent)({__name:'Character',setup(e){const t=m(),{mainChar:n}=a(t);return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',p,[t[0]||(t[0]=(0,r.createElementVNode)('h2',null,'人物',-1)),(0,r.createElementVNode)('pre',null,(0,r.toDisplayString)(JSON.stringify((0,r.unref)(n),null,2)),1)]))}}),y=(0,c.A)(v,[['__scopeId','data-v-49683b20']]),f=y,k=t('ui',{state:()=>({stream:!1,showInfo:!1,showSkill:!1}),actions:{startHostStreamSync(){try{const e=window.frameElement,t=e?.ownerDocument||document,a=this,n=e=>{try{const n=e.target;if(!n)return;if('stream_toggle'===n.id||n.closest?.('#stream_toggle')){const e='stream_toggle'===n.id?n:t.querySelector('#stream_toggle');e&&(a.stream=!!e.checked)}}catch(e){}};t.addEventListener('change',n,!0),t.addEventListener('input',n,!0),window.__dnd_unbindStreamListener__=()=>{try{t.removeEventListener('change',n,!0)}catch(e){}try{t.removeEventListener('input',n,!0)}catch(e){}}}catch(e){}},stopHostStreamSync(){try{const e=window.__dnd_unbindStreamListener__;'function'==typeof e&&e()}catch(e){}window.__dnd_unbindStreamListener__=void 0},syncStreamFromHost(){try{const e=window.frameElement,t=(e?.ownerDocument||document).querySelector('#stream_toggle');t&&(this.stream=!!t.checked)}catch(e){}},toggleStream(){this.stream=!this.stream;try{const e=window.frameElement,t=(e?.ownerDocument||document).querySelector('#stream_toggle');t&&t.checked!==this.stream&&(t.checked=this.stream,t.dispatchEvent(new Event('change',{bubbles:!0})),t.dispatchEvent(new Event('input',{bubbles:!0})))}catch(e){}},openInfo(){this.showInfo=!0},closeInfo(){this.showInfo=!1},toggleInfo(){this.showInfo=!this.showInfo},openSkill(){this.showSkill=!0},closeSkill(){this.showSkill=!1},toggleSkill(){this.showSkill=!this.showSkill}}}),g={战士:3,法师:2,盗贼:3,牧师:1,吟游诗人:3,圣武士:3,游侠:3,武僧:3,术士:1,邪术师:3,德鲁伊:2,野蛮人:3},h={战士:['勇士','战斗大师','奥法骑士'],法师:['塑能学派','防护学派','咒法学派'],盗贼:['刺客','诡术师','盗法者'],牧师:['生命领域','知识领域','诡术领域'],吟游诗人:['逸乐学院','勇气学院','逸闻学院'],圣武士:['奉献之誓','复仇之誓','忠诚之誓'],游侠:['猎人','驯兽师','幽影巡林客'],武僧:['开放掌之道','暗影之道','四象之道'],术士:['龙族血脉','狂野魔法','神圣灵魂'],邪术师:['邪魔','巨龙宗主','旧日支配者'],德鲁伊:['月亮结社','大地结社','梦想结社'],野蛮人:['狂战士之道','图腾武士之道','狂热者之道']},E={class:'section'},N={class:'row'},V=['value'],B=['value'],b=['value'],w={key:0,class:'row'},C=['value'],S={class:'bg-info'},D={class:'desc'},M={key:0,class:'chips'},A={class:'bg-info'},x={class:'desc'},L={key:0,class:'chips'},I={key:1,class:'note'},P={class:'section'},F={class:'points'},H={class:'attr-rows'},T={class:'k'},O=['disabled','onClick'],j={class:'v'},R=['disabled','onClick'],U={class:'section'},q={class:'skills'},G=['value','disabled'],K=(0,r.defineComponent)({__name:'Init',setup(e){const t=(0,s.useRouter)(),n=m(),l=k(),{stream:o}=a(l),c=['人类','精灵','矮人','半身人','半精灵','半兽人','提夫林','龙裔','侏儒'],i=['贵族','士兵','学者','罪犯','工匠','水手','侍僧','流浪儿','隐士','猎人'],d=['战士','法师','盗贼','牧师','吟游诗人','圣武士','游侠','武僧','术士','邪术师','德鲁伊','野蛮人'],u=['运动','体操','巧手','隐匿','奥秘','历史','调查','自然','宗教','驯兽','洞悉','医药','察觉','求生','欺瞒','威吓','表演','游说'],p=(0,r.ref)(c[0]),v=(0,r.ref)(i[0]),y=(0,r.ref)(d[0]),f=['力量','敏捷','体质','智力','感知','魅力'],K=(0,r.computed)(()=>1===g[y.value]),J=(0,r.computed)(()=>h[y.value]||[]),W=(0,r.ref)(''),Y=(0,r.ref)({力量:8,敏捷:8,体质:8,智力:8,感知:8,魅力:8});function X(e,t){let a=0;for(let n=e;n<t;n++)a+=n>=13?2:1;return a}const Q=(0,r.computed)(()=>f.reduce((e,t)=>e+X(8,Y.value[t]),0)),Z=(0,r.computed)(()=>27-Q.value);function ee(e){const t=Y.value[e];if(t>=15)return!1;const a=X(t,t+1);return Z.value>=a}function te(e){return Y.value[e]>8}function ae(e){const t=Y.value[e];return t>=15?'-':X(t,t+1)}function ne(){f.forEach(e=>Y.value[e]=8)}function le(){ne();const e=f.slice().sort(()=>Math.random()-.5);let t=200;for(;Z.value>0&&t-- >0;){const t=e[Math.floor(Math.random()*e.length)];if(ee(t))Y.value[t]+=1;else if(e.every(e=>!ee(e)))break}}function oe(e){return Math.floor((e-10)/2)}const re={战士:{主手武器:{名称:'长剑',伤害:'1d8 斩击'},副手武器:{名称:'盾牌',AC:2},护甲:{名称:'链甲',AC:16}},野蛮人:{主手武器:{名称:'巨斧',伤害:'1d12 斩击'},副手武器:null,护甲:{名称:'无甲',AC:null}},圣武士:{主手武器:{名称:'长剑',伤害:'1d8 斩击'},副手武器:{名称:'盾牌',AC:2},护甲:{名称:'链甲',AC:16}},游侠:{主手武器:{名称:'长弓',伤害:'1d8 穿刺'},副手武器:{名称:'短剑',伤害:'1d6 斩击'},护甲:{名称:'鳞甲',AC:14}},盗贼:{主手武器:{名称:'短剑',伤害:'1d6 斩击'},副手武器:{名称:'匕首',伤害:'1d4 穿刺'},护甲:{名称:'皮甲',AC:11}},武僧:{主手武器:{名称:'短棍',伤害:'1d6 钝击'},副手武器:null,护甲:{名称:'无甲',AC:null}},牧师:{主手武器:{名称:'战锤',伤害:'1d8 钝击'},副手武器:{名称:'盾牌',AC:2},护甲:{名称:'链甲',AC:16}},德鲁伊:{主手武器:{名称:'弯刀',伤害:'1d6 斩击'},副手武器:null,护甲:{名称:'鳞甲',AC:14}},法师:{主手武器:{名称:'法杖',伤害:'1d6 钝击'},副手武器:null,护甲:{名称:'无甲',AC:null}},术士:{主手武器:{名称:'匕首',伤害:'1d4 穿刺'},副手武器:null,护甲:{名称:'皮甲',AC:11}},邪术师:{主手武器:{名称:'弯刀',伤害:'1d6 斩击'},副手武器:null,护甲:{名称:'皮甲',AC:11}},吟游诗人:{主手武器:{名称:'细剑',伤害:'1d8 穿刺'},副手武器:{名称:'鲁特琴',描述:'演奏用'},护甲:{名称:'皮甲',AC:11}}};function se(e,t){if(void 0===t)return e;if(Array.isArray(t))return t.slice();if(t&&'object'==typeof t){const a=e&&'object'==typeof e&&!Array.isArray(e)?{...e}:{};for(const n of Object.keys(t))a[n]=se(e?e[n]:void 0,t[n]);return a}return t}function ce(){const e={};e['身份']={姓名:'冒险者',种族:p.value,背景:v.value,总等级:1,经验值:0},e['属性']={...Y.value},e['熟练']={熟练加值:2,技能熟练:Array.from(new Set([...de.value.skills||[],...ye.value]))};const t=Y.value['体质']||10,a=Y.value['敏捷']||10,n=y.value,l=function(e,t){const a=oe(t),n={野蛮人:12,战士:10,圣武士:10,游侠:10,武僧:8,盗贼:8,吟游诗人:8,牧师:8,德鲁伊:8,法师:6,术士:6,邪术师:8}[e]??8;return Math.max(1,n+a)}(n,t),o=function(e,t){const a=oe(t),n={野蛮人:e=>10+e+2,武僧:e=>10+e+2,盗贼:e=>11+e,游侠:e=>12+Math.min(2,e),战士:16,圣武士:16,牧师:16,德鲁伊:e=>12+Math.min(2,e),吟游诗人:e=>11+e,法师:e=>10+e,术士:e=>10+e,邪术师:e=>11+e}[e];return'function'==typeof n?n(a):'number'==typeof n?n:11+a}(n,a);e['战斗']={生命值:{最大生命值:l,当前生命值:l,临时生命值:0},护甲等级:o};const r=re[n]||{};return e['装备栏']={},['主手武器','副手武器','护甲'].forEach(t=>{r&&r[t]&&(e['装备栏'][t]=r[t])}),e['职业列表']=[n],1===g[n]&&W.value&&(e['职业详情']=e['职业详情']||{},e['职业详情'][n]={...e['职业详情'][n]||{},子职业:W.value}),e}const ie={贵族:{description:'出身显贵，受良好教育与礼仪训练。',skills:['游说','历史'],feature:'特权地位'},士兵:{description:'历经战阵，纪律严明，熟悉军中生活。',skills:['运动','威吓'],feature:'军旅人脉'},学者:{description:'钻研学识，热衷于典籍与研究。',skills:['奥秘','历史'],feature:'学术人脉'},罪犯:{description:'在阴影中求生，擅长潜行与欺瞒。',skills:['隐匿','欺瞒'],feature:'地下关系'},工匠:{description:'手艺精湛，注重专注与创造。',skills:['调查','洞悉']},水手:{description:'熟悉海上航行与水手技巧。',skills:['运动','求生'],feature:'船员通行'},侍僧:{description:'信仰虔诚，掌握宗教礼仪与经典。',skills:['宗教','洞悉']},流浪儿:{description:'街头长大，机敏与生存本能出众。',skills:['隐匿','巧手']},隐士:{description:'远离尘嚣，沉思冥想，洞察本心。',skills:['医疗','自然'].map(e=>'医疗'===e?'医药':e)},猎人:{description:'荒野追踪者，精通求生与察觉。',skills:['求生','察觉']}},de=(0,r.computed)(()=>ie[v.value]||{description:'选择一个背景以获得额外熟练与特色。',skills:[]}),ue={人类:{description:'通用而多才，适应力强。',features:['通用适应']},精灵:{description:'敏捷、感知敏锐，擅弓与感知魔法。',features:['黑暗视觉','敏锐感官']},矮人:{description:'结实耐久，抗性与工艺著称。',features:['毒素抗性','黑暗视觉']},半身人:{description:'幸运与灵巧，小巧而难以被察觉。',features:['幸运','勇敢']},半精灵:{description:'兼具人类与精灵特质。',features:['黑暗视觉','多才多艺']},半兽人:{description:'强韧而好战。',features:['顽强耐力','威吓气场']},提夫林:{description:'地狱之血，具火焰抗性与秘法感。',features:['火焰抗性','地狱遗泽']},龙裔:{description:'龙裔之息，具吐息武器与抗性。',features:['龙息','元素抗性']},侏儒:{description:'灵巧聪慧，天生对魔法有抵抗。',features:['侏儒狡黠']}},me=(0,r.computed)(()=>ue[p.value]||{description:'选择一个种族以查看特性。',features:[]}),pe={战士:{description:'力量与体质优先，兼顾敏捷。',preset:{力量:15,体质:15,敏捷:14,智力:8,感知:10,魅力:8}},野蛮人:{description:'力量/体质极高，重装或双手武器。',preset:{力量:15,体质:15,敏捷:14,智力:8,感知:10,魅力:8}},圣武士:{description:'力量与魅力优先，体质次之。',preset:{力量:15,魅力:15,体质:14,敏捷:10,感知:8,智力:8}},游侠:{description:'敏捷与感知优先，体质次之。',preset:{敏捷:15,感知:15,体质:14,力量:8,智力:10,魅力:8}},盗贼:{description:'敏捷极高，体质/感知辅助。',preset:{敏捷:15,体质:14,感知:14,力量:8,智力:10,魅力:8}},武僧:{description:'敏捷与感知双修。',preset:{敏捷:15,感知:15,体质:14,力量:8,智力:10,魅力:8}},牧师:{description:'感知为主，体质/力量或敏捷视分支。',preset:{感知:15,体质:14,力量:12,敏捷:12,智力:8,魅力:8}},德鲁伊:{description:'感知与体质优先。',preset:{感知:15,体质:14,敏捷:12,智力:10,力量:8,魅力:8}},法师:{description:'智力极高，体质/敏捷辅助。',preset:{智力:15,体质:14,敏捷:14,感知:10,力量:8,魅力:8}},术士:{description:'魅力极高，体质/敏捷辅助。',preset:{魅力:15,体质:14,敏捷:14,智力:10,力量:8,感知:8}},邪术师:{description:'魅力为主，体质其次。',preset:{魅力:15,体质:14,敏捷:12,智力:10,力量:8,感知:8}},吟游诗人:{description:'魅力极高，敏捷/体质辅助。',preset:{魅力:15,敏捷:14,体质:14,智力:10,力量:8,感知:8}}},ve=(0,r.computed)(()=>pe[y.value]||{description:'选择职业以查看推荐加点。',preset:{}});(0,r.computed)(()=>{const e=ve.value.preset||{},t={...Y.value};return Object.keys(e).forEach(a=>t[a]=e[a]),t});const ye=(0,r.ref)([]);function fe(e){const t=new Set((de.value.skills||[]).filter(Boolean));return ye.value.filter(e=>!t.has(e)).length>=2&&!ye.value.includes(e)}function ke(){const e=ce();(async()=>{try{n.input=function(e){const t=e['身份']||{},a=t['种族']||'旅人',n=y.value;return[`清晨微光洒在街石上，我这位来自「${t['背景']||'无名'}」的${a}${n}推门走出酒馆。`,'空气里有麦香与铁腥的混杂，我系紧披风，平复心跳，任靴跟踏过水渍，迎向未知的道路。'].join('\n')}(e)}catch{}try{let t;try{t=Mvu.getMvuData({type:'chat'})||{}}catch{t={}}t.stat_data=t.stat_data||{};const a=se(t.stat_data['主角']||{},e),n=y.value,l=Array.isArray(a['职业列表'])?a['职业列表'].slice():[];let o;l.includes(n)||l.push(n),a['职业列表']=l,K.value&&W.value&&(a['职业详情']=a['职业详情']||{},a['职业详情'][n]={...a['职业详情'][n]||{},子职业:W.value}),t.stat_data['主角']=a,await Mvu.replaceMvuData(t,{type:'chat'});try{o=Mvu.getMvuData({type:'message'})||{}}catch{o={}}o.stat_data=o.stat_data||{};const r=se(o.stat_data['主角']||{},a);o.stat_data['主角']=r,await Mvu.replaceMvuData(o,{type:'message'})}catch{}try{n.onSend(!!o.value)}catch{}try{t.replace('/')}catch{}})()}(0,r.watch)(y,()=>function(){const e=ve.value.preset||{};ne();const t=f.slice().sort((t,a)=>(e[a]||8)-(e[t]||8));let a=400;for(const n of t)for(;Y.value[n]<(e[n]||8)&&a-- >0&&ee(n);)Y.value[n]+=1}(),{immediate:!0});const ge=(0,r.ref)(null);function he(){const e=ge.value;if(!e)return;const t=e.getBoundingClientRect(),a=window.innerHeight||document.documentElement.clientHeight||800,n=Math.max(520,Math.floor(a-t.top-16));e.style.height=n+'px',e.style.overflow='auto'}return(0,r.onMounted)(()=>{requestAnimationFrame(he),window.addEventListener('resize',he),window.addEventListener('orientationchange',he)}),(0,r.onBeforeUnmount)(()=>{window.removeEventListener('resize',he),window.removeEventListener('orientationchange',he)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{class:'init-page',ref_key:'wrap',ref:ge},[t[14]||(t[14]=(0,r.createElementVNode)('h2',null,'创建角色',-1)),(0,r.createElementVNode)('div',E,[t[10]||(t[10]=(0,r.createElementVNode)('h3',null,'基础信息',-1)),(0,r.createElementVNode)('div',N,[t[5]||(t[5]=(0,r.createElementVNode)('label',null,'种族',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[0]||(t[0]=e=>p.value=e)},[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(c,e=>(0,r.createElementVNode)('option',{key:e,value:e},(0,r.toDisplayString)(e),9,V)),64))],512),[[r.vModelSelect,p.value]]),t[6]||(t[6]=(0,r.createElementVNode)('label',null,'背景',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[1]||(t[1]=e=>v.value=e)},[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i,e=>(0,r.createElementVNode)('option',{key:e,value:e},(0,r.toDisplayString)(e),9,B)),64))],512),[[r.vModelSelect,v.value]]),t[7]||(t[7]=(0,r.createElementVNode)('label',null,'初始职业',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[2]||(t[2]=e=>y.value=e)},[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(d,e=>(0,r.createElementVNode)('option',{key:e,value:e},(0,r.toDisplayString)(e),9,b)),64))],512),[[r.vModelSelect,y.value]])]),(0,r.createCommentVNode)(' 某些职业 1 级必须选择子职业：联动显示选择框 '),K.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',w,[t[8]||(t[8]=(0,r.createElementVNode)('label',null,'子职业',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[3]||(t[3]=e=>W.value=e)},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(J.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('option',{key:e,value:e},(0,r.toDisplayString)(e),9,C))),128))],512),[[r.vModelSelect,W.value]])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',S,[t[9]||(t[9]=(0,r.createElementVNode)('h4',null,'种族特性',-1)),(0,r.createElementVNode)('p',D,(0,r.toDisplayString)(me.value.description),1),me.value.features&&me.value.features.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',M,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(me.value.features,e=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{class:'chip',key:e},(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',A,[(0,r.createElementVNode)('p',x,(0,r.toDisplayString)(de.value.description),1),de.value.skills&&de.value.skills.length?((0,r.openBlock)(),(0,r.createElementBlock)('div',L,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(de.value.skills,e=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{class:'chip',key:e},'背景熟练：'+(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)('v-if',!0),de.value.feature?((0,r.openBlock)(),(0,r.createElementBlock)('div',I,'特性：'+(0,r.toDisplayString)(de.value.feature),1)):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createElementVNode)('div',P,[t[12]||(t[12]=(0,r.createElementVNode)('h3',null,'属性（点数分配：27 点，从 8 开始，最高 15）',-1)),(0,r.createElementVNode)('div',F,[t[11]||(t[11]=(0,r.createTextVNode)(' 剩余点数：',-1)),(0,r.createElementVNode)('b',null,(0,r.toDisplayString)(Z.value),1)]),(0,r.createElementVNode)('div',H,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(f,e=>(0,r.createElementVNode)('div',{class:'attr-row',key:e},[(0,r.createElementVNode)('div',T,(0,r.toDisplayString)(e),1),(0,r.createElementVNode)('button',{class:'step',disabled:!te(e),onClick:t=>function(e){te(e)&&(Y.value[e]-=1)}(e)},'−',8,O),(0,r.createElementVNode)('div',j,(0,r.toDisplayString)(Y.value[e]),1),(0,r.createElementVNode)('button',{class:'step',disabled:!ee(e),onClick:t=>function(e){ee(e)&&(Y.value[e]+=1)}(e)},'＋',8,R),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['cost',{disabled:!ee(e)}])},'下一级花费：'+(0,r.toDisplayString)(ae(e)),3)])),64))]),(0,r.createElementVNode)('div',{class:'row'},[(0,r.createElementVNode)('button',{onClick:ne},'重置'),(0,r.createElementVNode)('button',{onClick:le},'随机分配')])]),(0,r.createElementVNode)('div',U,[t[13]||(t[13]=(0,r.createElementVNode)('h3',null,'熟练项（最多 2）',-1)),(0,r.createElementVNode)('div',q,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u,e=>(0,r.createElementVNode)('label',{key:e},[(0,r.withDirectives)((0,r.createElementVNode)('input',{type:'checkbox',value:e,'onUpdate:modelValue':t[4]||(t[4]=e=>ye.value=e),disabled:fe(e)},null,8,G),[[r.vModelCheckbox,ye.value]]),(0,r.createTextVNode)(' '+(0,r.toDisplayString)(e),1)])),64))])]),(0,r.createElementVNode)('div',{class:'actions'},[(0,r.createElementVNode)('button',{onClick:le},'随机分配属性'),(0,r.createElementVNode)('button',{class:'primary',onClick:ke},'保存并开始')])],512))}}),J=(0,c.A)(K,[['__scopeId','data-v-0de37b7e']]),W={class:'panel glass'},Y=(0,r.defineComponent)({__name:'Inventory',setup(e){const t=m(),{mainChar:n}=a(t),l=(0,r.computed)(()=>n.value?.['物品栏']??{});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',W,[t[0]||(t[0]=(0,r.createElementVNode)('h2',null,'背包',-1)),(0,r.createElementVNode)('pre',null,(0,r.toDisplayString)(JSON.stringify(l.value,null,2)),1)]))}}),X=(0,c.A)(Y,[['__scopeId','data-v-6e05e7ac']]),Q={class:'kv-tree'},Z={key:0,class:'row'},ee={class:'k'},te={class:'v'},ae={key:1,class:'branch',open:''},ne={class:'title'},le={class:'meta'},oe={key:0,class:'row'},re={class:'k'},se={class:'v'},ce={key:1,class:'branch',open:''},ie={class:'title'},de={class:'meta'},ue={key:2,class:'v'},me=(0,r.defineComponent)({__name:'KvTree',props:{data:{}},setup(e){function t(e){return null==e||'string'==typeof e||'number'==typeof e||'boolean'==typeof e}function a(e){try{if(Array.isArray(e))return`[${e.length}]`;if(e&&'object'==typeof e)return`{${Object.keys(e).length}}`}catch{}return''}function n(e){if(null==e)return'-';try{return'string'==typeof e||'number'==typeof e||'boolean'==typeof e?String(e):Array.isArray(e)?`[${e.length}]`:'object'==typeof e?'{...}':String(e)}catch{return String(e)}}return(e,l)=>{const o=(0,r.resolveComponent)('KvTree',!0);return(0,r.openBlock)(),(0,r.createElementBlock)('div',Q,[(s=e.data,s&&'object'==typeof s&&!Array.isArray(s)?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(e.data,(e,l)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:String(l),class:'node'},[t(e)?((0,r.openBlock)(),(0,r.createElementBlock)('div',Z,[(0,r.createElementVNode)('span',ee,(0,r.toDisplayString)(l),1),(0,r.createElementVNode)('span',te,(0,r.toDisplayString)(n(e)),1)])):((0,r.openBlock)(),(0,r.createElementBlock)('details',ae,[(0,r.createElementVNode)('summary',ne,[(0,r.createTextVNode)((0,r.toDisplayString)(l)+' ',1),(0,r.createElementVNode)('span',le,(0,r.toDisplayString)(a(e)),1)]),(0,r.createVNode)(o,{data:e},null,8,['data'])]))]))),128)):Array.isArray(e.data)?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:1},(0,r.renderList)(e.data,(e,l)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:l},[t(e)?((0,r.openBlock)(),(0,r.createElementBlock)('div',oe,[(0,r.createElementVNode)('span',re,'#'+(0,r.toDisplayString)(l+1),1),(0,r.createElementVNode)('span',se,(0,r.toDisplayString)(n(e)),1)])):((0,r.openBlock)(),(0,r.createElementBlock)('details',ce,[(0,r.createElementVNode)('summary',ie,[(0,r.createTextVNode)(' #'+(0,r.toDisplayString)(l+1)+' ',1),(0,r.createElementVNode)('span',de,(0,r.toDisplayString)(a(e)),1)]),(0,r.createVNode)(o,{data:e},null,8,['data'])]))],64))),128)):((0,r.openBlock)(),(0,r.createElementBlock)('span',ue,(0,r.toDisplayString)(n(e.data)),1)))]);var s}}}),pe=(0,c.A)(me,[['__scopeId','data-v-716fa843']]),ve={key:0,class:'kv2'},ye={key:0,class:'arr'},fe={class:'k'},ke={class:'v'},ge={key:1,class:'obj'},he={class:'k'},Ee={class:'v'},Ne={key:2,class:'atom'},Ve=(0,r.defineComponent)({__name:'KvTree2',props:{data:{}},setup(e){const t=e,a=(0,r.computed)(()=>t.data);function n(e){return e&&'object'==typeof e&&!Array.isArray(e)}function l(e){if(null==e)return'-';if('string'==typeof e||'number'==typeof e||'boolean'==typeof e)return String(e);try{return JSON.stringify(e)}catch{return String(e)}}const o=(0,r.computed)(()=>!0);return(e,t)=>{const s=(0,r.resolveComponent)('KvTree2',!0);return o.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',ve,[(c=a.value,Array.isArray(c)?((0,r.openBlock)(),(0,r.createElementBlock)('div',ye,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:t,class:'row'},[(0,r.createElementVNode)('div',fe,'['+(0,r.toDisplayString)(t)+']',1),(0,r.createElementVNode)('div',ke,[(0,r.createVNode)(s,{data:e},null,8,['data'])])]))),128))])):n(a.value)?((0,r.openBlock)(),(0,r.createElementBlock)('div',ge,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:String(t),class:'row'},[(0,r.createElementVNode)('div',he,(0,r.toDisplayString)(t),1),(0,r.createElementVNode)('div',Ee,[(0,r.createVNode)(s,{data:e},null,8,['data'])])]))),128))])):((0,r.openBlock)(),(0,r.createElementBlock)('span',Ne,(0,r.toDisplayString)(l(a.value)),1)))])):(0,r.createCommentVNode)('v-if',!0);var c}}}),Be=(0,c.A)(Ve,[['__scopeId','data-v-6a1f6601']]),be={class:'topbar'},we={class:'right-actions'},Ce=['disabled'],Se={class:'desktop-layout'},_e={class:'skill-panel'},De={class:'side-buttons'},Me={class:'lv-panel'},Ae={class:'lv-body'},xe={class:'class-list'},Le=['onClick'],Ie={key:0,class:'badge'},Pe={class:'lv-footer'},Fe=['disabled'],He={class:'lv-panel'},Te={class:'lv-body'},Oe={class:'asi-grid'},$e={class:'k'},je={class:'asi-ctrl'},ze=['onClick','disabled'],Re={class:'v'},Ue=['onClick','disabled'],qe={class:'lv-footer'},Ge=['disabled'],Ke={class:'lv-panel'},Je={class:'lv-body'},We={class:'class-list'},Ye=['onClick'],Xe={class:'lv-footer'},Qe=['disabled'],Ze={class:'body'},et={key:0,class:'card-grid'},tt={class:'card details-card',open:''},at={class:'card-title'},nt={key:0,class:'card details-card',open:''},lt={class:'card details-card',open:''},ot={class:'card-title'},rt={class:'k'},st={class:'v'},ct={class:'card details-card',open:''},it={class:'card-title'},dt={class:'kv-row'},ut={class:'v'},mt={class:'kv-row'},pt={class:'v'},vt={class:'kv-row'},yt={class:'v'},ft={key:0,class:'sub-title'},kt={key:1,class:'chips'},gt={key:2,class:'sub-title'},ht={key:3,class:'chips'},Et={class:'card details-card',open:''},Nt={class:'card-title'},Vt={class:'kv-row'},Bt={class:'v'},bt={class:'chips'},wt={key:1,class:'card details-card',open:''},Ct={class:'card-title'},St={class:'card-grid'},_t={class:'card-title'},Dt={class:'badge'},Mt={key:0,class:'card-grid'},At={class:'card-title'},xt={class:'kv-row'},Lt={class:'v'},It={key:0,class:'kv-row'},Pt={class:'v'},Ft={key:1,class:'kv-row'},Ht={class:'v'},Tt={key:2,class:'kv-row'},Ot={class:'v'},$t={key:3,class:'kv-row'},jt={class:'v'},zt={class:'card-grid'},Rt={class:'card-title'},Ut={class:'kv-row'},qt={class:'v'},Gt={key:0,class:'kv-row'},Kt={class:'v'},Jt={key:1,class:'kv-row'},Wt={class:'v'},Yt={key:2,class:'kv-row'},Xt={class:'v'},Qt={class:'chips'},Zt={class:'card-grid'},ea={class:'card-title'},ta={class:'kv-row'},aa={class:'v'},na={class:'card-grid'},la={class:'card details-card',open:''},oa={class:'card details-card',open:''},ra={key:0,class:'card-grid'},sa={class:'card-title'},ca={key:0,class:'card-grid'},ia={class:'card-title'},da={key:0,class:'card-grid'},ua={key:0,class:'card details-card',open:''},ma={key:1,class:'card details-card',open:''},pa={key:2,class:'card details-card',open:''},va={key:1,class:'note'},ya={key:0,class:'card-grid'},fa={class:'card details-card',open:''},ka={class:'card-title'},ga={key:1,class:'note'},ha={class:'kv-row'},Ea={class:'switch'},Na=['checked'],Va=(0,r.defineComponent)({__name:'Layout',setup(e){const t=k(),l=m(),{stream:o}=a(t),{mvu:s,mainChar:c}=a(l),i=(0,r.ref)(null),d=(0,r.ref)(0),u=(0,r.ref)(!1),p=(0,r.ref)(!1),v=(new Set,new Map);function y(){try{v.forEach((e,t)=>{try{e?t.setAttribute('style',e):t.removeAttribute('style')}catch{}})}catch{}v.clear()}const f=(0,r.computed)(()=>!1),E=(0,r.ref)(null),{isSupported:N,toggle:V}=n(E),B=(0,r.computed)(()=>s.value?.['主角']||c.value||{}),b=['力量','敏捷','体质','智力','感知','魅力'],w=['主手武器','副手武器','护甲','头盔','手套','鞋子','项链','戒指1','戒指2'];function C(){O.value='',S.value=!0}const S=(0,r.ref)(!1),D=(0,r.ref)(''),M=(0,r.ref)(!1),A=['战士','法师','盗贼','牧师','吟游诗人','圣武士','游侠','武僧','术士','邪术师','德鲁伊','野蛮人'];function x(){S.value=!1,D.value=''}function L(e){try{const t=s.value?.['主角']?.['职业列表']||[];return Array.isArray(t)&&t.includes(e)?Number(s.value?.['主角']?.['职业详情']?.[e]?.['等级']??0):0}catch{return 0}}async function I(){if(!M.value&&(M.value=!0,D.value))try{const e=Mvu.getMvuData({type:'chat'})||{},t=(e,t,a)=>'undefined'!=typeof _&&_.set?_.set(e,t,a):function(){const n=Array.isArray(t)?t:String(t).split('.');let l=e;n.forEach((e,t)=>{t===n.length-1?l[e]=a:l=l[e]=l[e]||{}})}(),a=['stat_data','主角'];t(e,[...a,'身份'],e.stat_data?.['主角']?.['身份']||{}),t(e,[...a,'职业列表'],Array.isArray(e.stat_data?.['主角']?.['职业列表'])?e.stat_data?.['主角']?.['职业列表']:e.stat_data?.['主角']?.['职业列表']||[]),t(e,[...a,'职业详情'],e.stat_data?.['主角']?.['职业详情']||{});const n=D.value,l=e.stat_data['主角']['职业列表'];l.includes(n)||l.push(n);const o=Number(e.stat_data['主角']['职业详情']?.[n]?.['等级']??0);o>0&&t(e,['stat_data','主角','职业详情',n,'等级'],o+1);const r=Number(e.stat_data['主角']['身份']['总等级']??1)+1;t(e,['stat_data','主角','身份','总等级'],r);t(e,['stat_data','主角','熟练','熟练加值'],[2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6][Math.min(Math.max(r,1),20)-1]),await Mvu.replaceMvuData(e,{type:'chat'}),await Mvu.replaceMvuData(e,{type:'message'});const s=Number(e.stat_data['主角']['职业详情'][n]?.['等级']??0);[4,8,12,16,19].includes(s)&&(se.value=2,b.forEach(e=>ce[e]=0),re.value=!0),function(e,t){const a=g[e];return!!a&&t===a}(n,s)&&function(e){H.value=e,T.value=h[e]||[],F.value='',P.value=!0}(n)}catch(e){console.error('升级失败',e)}finally{S.value=!1,D.value='',M.value=!1}}const P=(0,r.ref)(!1),F=(0,r.ref)(''),H=(0,r.ref)(''),T=(0,r.ref)([]);const O=(0,r.ref)(''),j=(0,r.computed)(()=>{switch(O.value){case'profile':return'⚔️ 角色';case'classes':return'🏆 职业';case'items':return'🎒 物品';case'equip':return'⚔️ 装备';case'features':return'🌟 特性';case'magic':return'🔮 法术系统';case'state':return'✨ 状态';case'tasks':return'📜 任务';case'system':return'⚙️ 系统设置';case'others':return'👥 其他角色';case'nearby':return'💀 附近敌人';default:return'❓ 未知'}});function R(e){O.value=e}function U(){O.value=''}function q(e){return Array.isArray(e)?e.filter(Boolean):[]}function G(e){return e&&'object'==typeof e&&!Array.isArray(e)}function K(e){return G(e)?e:{}}function J(e,t){if(!G(e))return{};const a={};return Object.keys(e).forEach(n=>{t.includes(n)||(a[n]=e[n])}),a}function W(e){return G(e)&&Object.keys(e).length>0}function Y(e){return/基础|身份/.test(e)?'📜':/属性|能力值/.test(e)?'💪':/战斗|防御|生命值|护甲/.test(e)?'⚔️':/熟练|技能/.test(e)?'🎯':/法术|魔法|施法/.test(e)?'🔮':/能力特性|特性|天赋/.test(e)?'🌟':/声望|名誉/.test(e)?'👑':/职业|等级/.test(e)?'🏆':/物品|背包|道具/.test(e)?'🎒':/装备|武器|防具/.test(e)?'🛡️':/状态|效果|增益|减益/.test(e)?'✨':/任务|目标|使命/.test(e)?'📜':/世界|时间|天气/.test(e)?'🌍':/货币|金币|财富/.test(e)?'💰':/资源|法术位|气力/.test(e)?'🔋':/契约|邪术/.test(e)?'👁️':/临时/.test(e)?'⏳':'📁'}function X(e){const t=(e?.['类型']||'').toString();return/武器|剑|刀|弓/.test(t)?'🗡️':/护甲|盔甲|盾/.test(t)?'🛡️':/药|药剂|卷轴|法术/.test(t)?'🧪':/食物|食/.test(t)?'🍞':'📦'}function Q(e){return e.includes('武器')?'🗡️':e.includes('护甲')?'🛡️':e.includes('头盔')?'🪖':e.includes('手套')?'🧤':e.includes('鞋')?'🥾':e.includes('项链')?'📿':e.includes('戒指')?'💍':'🎒'}function Z(e){if(!e)return[];try{if(Array.isArray(e))return e.map((e,t)=>[String(t),e]);if('object'==typeof e)return Object.entries(e)}catch{}return[]}const ee=(0,r.computed)(()=>s.value?.['主角']?.['法术系统']||{}),te=(0,r.computed)(()=>Array.isArray(s.value?.['主角']?.['职业列表'])?s.value?.['主角']?.['职业列表']:[]),ae=(0,r.computed)(()=>s.value?.['主角']?.['职业详情']||{}),ne=(0,r.computed)(()=>te.value.includes('邪术师')),le=(0,r.computed)(()=>{const e=ee.value['施法主属性']||{};if(!te.value||0===te.value.length)return!1;for(const t of te.value){if(e&&Object.prototype.hasOwnProperty.call(e,t))return!0;const a=ae.value?.[t]?.['子职业'];if(a&&Object.prototype.hasOwnProperty.call(e,a))return!0}return!1}),oe=(0,r.computed)(()=>{const e=ee.value['施法主属性']||{},t={},a=a=>{Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])};return te.value.forEach(e=>{a(e);const t=ae.value?.[e]?.['子职业'];t&&a(String(t))}),t}),re=(0,r.ref)(!1),se=(0,r.ref)(2),ce=(0,r.reactive)({力量:0,敏捷:0,体质:0,智力:0,感知:0,魅力:0});function ie(){re.value=!1,se.value=2,b.forEach(e=>ce[e]=0)}function de(){t.toggleInfo(),d.value++}function ue(){p.value=!p.value;try{localStorage.setItem('dnd-dark-mode',p.value.toString())}catch{}try{window.dispatchEvent(new Event('resize'))}catch{}}function me(){const e=navigator.userAgent||'',t=/iP(ad|hone|od)/i.test(e);!N.value||t?u.value=!u.value:V()}function ve(){t.showInfo&&(t.closeInfo(),d.value++)}return(0,r.onMounted)(()=>{l.init(o);try{t.syncStreamFromHost()}catch{}try{t.startHostStreamSync()}catch{}let e=null;try{e=localStorage.getItem('dnd-dark-mode'),e&&(p.value='true'===e)}catch{}try{const t=window.frameElement,a=t?.ownerDocument||document,n=a.documentElement.classList.contains('theme_dark')||a.body.classList.contains('dark')||null!=a.querySelector('.theme-dark, .dark');!e&&n&&(p.value=!0)}catch{}try{E.value=document.documentElement}catch{}const a=()=>{const e=document,t=!(!e.fullscreenElement&&!e.webkitFullscreenElement);u.value=t,t||setTimeout(()=>{const e=window.__dndManageHostScrollbars,t=window.__dndSetIframeHeight;e&&e(!1),t&&t(715);try{window.dispatchEvent(new Event('resize'))}catch{}},50)};document.addEventListener('fullscreenchange',a),document.addEventListener('webkitfullscreenchange',a),window.addEventListener('dnd-open-levelup',C);let n=!1;const s=new Map;let c=!1,i=null;const d=()=>{const e=window.frameElement;if(!e)return;const t=navigator.userAgent||'',a=/iP(ad|hone|od)/i.test(t),l=!(!document.fullscreenElement&&!document.webkitFullscreenElement);if(a&&!l&&(!u.value||!n)&&(u.value||n))if(u.value){e.setAttribute('data-dnd-fs','1'),e.style.setProperty('position','fixed','important'),e.style.setProperty('inset','0','important'),e.style.setProperty('z-index','2147483647','important'),e.style.setProperty('width','100vw','important'),e.style.setProperty('height','100dvh','important'),e.style.setProperty('min-height','100dvh','important'),e.style.setProperty('height','100svh','important'),e.style.setProperty('min-height','100svh','important'),(e=>{try{const t=window.visualViewport;if(!t||c)return;const a=()=>{try{e.style.setProperty('height',Math.round(t.height)+'px','important')}catch{}};t.addEventListener('resize',a),t.addEventListener('scroll',a),c=!0,a()}catch{}})(e);try{const t=e.ownerDocument,a=t?.getElementById('app');a&&(i=a.style.minHeight??null,a.style.setProperty('min-height','0','important'),a.style.setProperty('height','100%','important'),a.style.setProperty('max-height','none','important'));const n=t?.getElementById('form_sheld');n&&!v.has(n)&&(v.set(n,n.getAttribute('style')||''),n.style.setProperty('display','none','important'));let l=e.parentElement;const o=t?.body;for(;l&&l!==o;){try{const e=t.defaultView.getComputedStyle(l);('none'!==e.transform||'none'!==e.contain||'none'!==e.perspective||/transform|perspective/.test(e.willChange||'')||'visible'!==e.overflow&&'unset'!==e.overflow)&&(s.has(l)||s.set(l,l.getAttribute('style')||''),l.style.setProperty('transform','none','important'),l.style.setProperty('contain','initial','important'),l.style.setProperty('perspective','none','important'),l.style.setProperty('will-change','auto','important'),l.style.setProperty('overflow','visible','important'))}catch{}l=l.parentElement}const r=t?.documentElement,c=t?.body;[r,c].filter(Boolean).forEach(e=>{e&&(s.has(e)||s.set(e,e.getAttribute('style')||''),e.style.setProperty('overflow','hidden','important'),e.style.setProperty('touch-action','none','important'))})}catch{}n=!0}else{e.removeAttribute('data-dnd-fs'),['position','top','left','right','bottom','z-index','width','height','max-width','max-height','transform','margin','display','min-height'].forEach(t=>e.style.removeProperty(t));try{const t=e.ownerDocument,a=t?.getElementById('app');a&&(null!=i?a.style.setProperty('min-height',i):a.style.removeProperty('min-height')),s.forEach((e,t)=>{try{e?t.setAttribute('style',e):t.removeAttribute('style')}catch{}}),s.clear()}catch{}y(),(()=>{try{if(!window.visualViewport||!c)return;c=!1}catch{}})(),setTimeout(()=>{const e=window.__dndManageHostScrollbars;e&&e(!1)},100),n=!1}};(0,r.watch)(u,()=>d(),{immediate:!0}),(0,r.onBeforeUnmount)(()=>{document.removeEventListener('fullscreenchange',a),document.removeEventListener('webkitfullscreenchange',a),window.removeEventListener('dnd-open-levelup',C),y()})}),(e,a)=>{const n=(0,r.resolveComponent)('RouterView');return(0,r.openBlock)(),(0,r.createElementBlock)('div',{class:(0,r.normalizeClass)(['dnd-layout',{fs:u.value,'dark-mode':p.value}]),key:d.value},[(0,r.createElementVNode)('header',be,[a[23]||(a[23]=(0,r.createElementVNode)('div',{class:'brand'},'DnD',-1)),(0,r.createElementVNode)('div',we,[(0,r.createElementVNode)('button',{class:'menu-btn',title:'侧边栏',onClick:(0,r.withModifiers)(de,['stop','prevent'])},[...a[22]||(a[22]=[(0,r.createElementVNode)('span',{class:'hamburger'},[(0,r.createElementVNode)('span'),(0,r.createElementVNode)('span'),(0,r.createElementVNode)('span')],-1)])]),(0,r.createElementVNode)('button',{class:'menu-btn',title:'夜间模式',onClick:(0,r.withModifiers)(ue,['stop','prevent'])},(0,r.toDisplayString)(p.value?'☀️':'🌙'),1),(0,r.createElementVNode)('button',{class:'menu-btn',disabled:f.value,title:'全屏',onClick:(0,r.withModifiers)(me,['stop','prevent'])},' ⛶ ',8,Ce)])]),(0,r.createCommentVNode)(' 全屏平铺布局 '),(0,r.createElementVNode)('div',Se,[(0,r.createCommentVNode)(' 主内容区 '),(0,r.createElementVNode)('main',{class:'main-content',onClick:ve},[(0,r.createVNode)(n),(0,r.unref)(t).showSkill?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'skill-modal',onClick:a[1]||(a[1]=(0,r.withModifiers)(e=>(0,r.unref)(t).closeSkill(),['self']))},[(0,r.createElementVNode)('div',_e,[(0,r.createElementVNode)('header',null,[a[24]||(a[24]=(0,r.createElementVNode)('h3',null,'技能',-1)),(0,r.createElementVNode)('button',{class:'close',onClick:a[0]||(a[0]=e=>(0,r.unref)(t).closeSkill())},'×')]),a[25]||(a[25]=(0,r.createElementVNode)('div',{class:'body'},[(0,r.createElementVNode)('p',null,'这里展示角色技能、检定与投骰入口（预留）。')],-1))])])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createCommentVNode)(' 右侧HUD（按钮式导航，点击弹窗展示组件） '),(0,r.createElementVNode)('aside',{ref_key:'sidebarEl',ref:i,class:(0,r.normalizeClass)(['sidebar-panel',{open:(0,r.unref)(t).showInfo}])},[(0,r.createElementVNode)('div',De,[(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[2]||(a[2]=e=>R('profile'))},'⚔️ 角色'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[3]||(a[3]=e=>R('classes'))},'🏆 职业'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[4]||(a[4]=e=>R('items'))},'🎒 物品'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[5]||(a[5]=e=>R('equip'))},'🛡️ 装备'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[6]||(a[6]=e=>R('features'))},'🌟 特性'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[7]||(a[7]=e=>R('magic'))},'🔮 法术'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[8]||(a[8]=e=>R('state'))},'✨ 状态'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[9]||(a[9]=e=>R('tasks'))},'📜 任务'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[10]||(a[10]=e=>R('others'))},'👥 队友'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[11]||(a[11]=e=>R('nearby'))},'💀 敌人'),(0,r.createElementVNode)('button',{class:'side-btn',onClick:a[12]||(a[12]=e=>R('system'))},'⚙️ 设置')])],2)]),(0,r.createCommentVNode)(' 升级选择职业弹窗 '),S.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'skill-modal',onClick:a[15]||(a[15]=(0,r.withModifiers)(e=>x(),['self']))},[(0,r.createElementVNode)('div',Me,[a[26]||(a[26]=(0,r.createElementVNode)('header',null,[(0,r.createElementVNode)('h3',null,'选择要升级的职业')],-1)),(0,r.createElementVNode)('div',Ae,[(0,r.createElementVNode)('div',xe,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(A,e=>(0,r.createElementVNode)('button',{key:e,class:(0,r.normalizeClass)(['class-btn',{active:D.value===e}]),onClick:t=>D.value=e},[(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e),1),L(e)?((0,r.openBlock)(),(0,r.createElementBlock)('span',Ie,'Lv. '+(0,r.toDisplayString)(L(e)),1)):(0,r.createCommentVNode)('v-if',!0)],10,Le)),64))])]),(0,r.createElementVNode)('footer',Pe,[(0,r.createElementVNode)('button',{class:'btn-alt',onClick:a[13]||(a[13]=e=>x())},'取消'),(0,r.createElementVNode)('button',{class:'btn-primary',disabled:!D.value||M.value,onClick:a[14]||(a[14]=e=>I())},'确认升级',8,Fe)])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 自由加点弹窗（2点，需确认） '),re.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:1,class:'skill-modal',onClick:a[18]||(a[18]=(0,r.withModifiers)(e=>ie(),['self']))},[(0,r.createElementVNode)('div',He,[(0,r.createElementVNode)('header',null,[(0,r.createElementVNode)('h3',null,'自由属性加点（剩余：'+(0,r.toDisplayString)(se.value)+'）',1)]),(0,r.createElementVNode)('div',Te,[(0,r.createElementVNode)('div',Oe,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(b,e=>(0,r.createElementVNode)('div',{class:'asi-row',key:e},[(0,r.createElementVNode)('span',$e,(0,r.toDisplayString)(e),1),(0,r.createElementVNode)('div',je,[(0,r.createElementVNode)('button',{class:'asi-btn',onClick:t=>function(e){(ce[e]??0)<=0||(ce[e]=(ce[e]??0)-1,se.value+=1)}(e),disabled:ce[e]<=0},'-',8,ze),(0,r.createElementVNode)('span',Re,(0,r.toDisplayString)((B.value['属性']?.[e]??0)+(ce[e]??0)),1),(0,r.createElementVNode)('button',{class:'asi-btn',onClick:t=>function(e){if(se.value<=0)return;Number(s.value?.['主角']?.['属性']?.[e]??0)+(ce[e]??0)>=20||(ce[e]=(ce[e]??0)+1,se.value-=1)}(e),disabled:se.value<=0||(B.value['属性']?.[e]??0)+(ce[e]??0)>=20},' + ',8,Ue)])])),64))])]),(0,r.createElementVNode)('footer',qe,[(0,r.createElementVNode)('button',{class:'btn-alt',onClick:a[16]||(a[16]=e=>ie())},'撤销'),(0,r.createElementVNode)('button',{class:'btn-primary',disabled:0!==se.value,onClick:a[17]||(a[17]=e=>async function(){if(0===se.value)try{const e=Mvu.getMvuData({type:'chat'})||{},t=e.stat_data=e.stat_data||{},a=t['主角']=t['主角']||{};a['属性']=a['属性']||{},b.forEach(e=>{const t=Number(a['属性'][e]??0);a['属性'][e]=Math.min(20,t+(ce[e]??0))}),await Mvu.replaceMvuData(e,{type:'chat'})}catch(e){console.error('加点失败',e)}finally{ie()}}())},'确认加点',8,Ge)])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 子职业选择弹窗 '),P.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:2,class:'skill-modal',onClick:(0,r.withModifiers)(e=>null,['self'])},[(0,r.createElementVNode)('div',Ke,[(0,r.createElementVNode)('header',null,[(0,r.createElementVNode)('h3',null,'选择子职业（'+(0,r.toDisplayString)(H.value)+'）',1)]),(0,r.createElementVNode)('div',Je,[(0,r.createElementVNode)('div',We,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(T.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:e,class:(0,r.normalizeClass)(['class-btn',{active:F.value===e}]),onClick:t=>F.value=e},[(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e),1)],10,Ye))),128))])]),(0,r.createElementVNode)('footer',Xe,[(0,r.createElementVNode)('button',{class:'btn-alt',onClick:a[19]||(a[19]=e=>{P.value=!1})},'稍后'),(0,r.createElementVNode)('button',{class:'btn-primary',disabled:!F.value,onClick:a[20]||(a[20]=e=>async function(){if(H.value&&F.value)try{const n=Mvu.getMvuData({type:'chat'})||{},l=H.value,o=F.value;e=n,t=['stat_data','主角','职业详情',l,'子职业'],a=o,'undefined'!=typeof _&&_.set?_.set(e,t,a):function(){const n=Array.isArray(t)?t:String(t).split('.');let l=e;n.forEach((e,t)=>{t===n.length-1?l[e]=a:l=l[e]=l[e]||{}})}(),await Mvu.replaceMvuData(n,{type:'chat'}),await Mvu.replaceMvuData(n,{type:'message'})}catch(e){console.error('选择子职业失败',e)}finally{P.value=!1,F.value='',H.value='',T.value=[]}var e,t,a}())},'确认子职业',8,Qe)])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 通用弹窗容器：根据 currentPanel 渲染对应内容 '),O.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:3,class:'skill-modal',onClick:(0,r.withModifiers)(U,['self'])},[(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['skill-panel',O.value])},[(0,r.createElementVNode)('header',null,[(0,r.createElementVNode)('h3',null,(0,r.toDisplayString)(j.value),1),(0,r.createElementVNode)('button',{class:'close',onClick:U},'×')]),(0,r.createElementVNode)('div',Ze,[(0,r.createCommentVNode)(' 角色（分组卡片） '),'profile'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',et,[(0,r.createElementVNode)('details',tt,[(0,r.createElementVNode)('summary',at,(0,r.toDisplayString)(Y('基础'))+' 基础',1),(0,r.createVNode)(Be,{data:B.value['身份']||{}},null,8,['data'])]),G(((0,r.unref)(s)||{})['世界信息'])?((0,r.openBlock)(),(0,r.createElementBlock)('details',nt,[a[27]||(a[27]=(0,r.createElementVNode)('summary',{class:'card-title'},'📅 世界信息',-1)),(0,r.createVNode)(Be,{data:((0,r.unref)(s)||{})['世界信息']||{}},null,8,['data'])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('details',lt,[(0,r.createElementVNode)('summary',ot,(0,r.toDisplayString)(Y('属性'))+' 属性',1),((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(b,e=>(0,r.createElementVNode)('div',{class:'kv-row',key:e},[(0,r.createElementVNode)('span',rt,(0,r.toDisplayString)(e),1),(0,r.createElementVNode)('span',st,(0,r.toDisplayString)(B.value['属性']?.[e]??'-'),1)])),64))]),(0,r.createElementVNode)('details',ct,[(0,r.createElementVNode)('summary',it,(0,r.toDisplayString)(Y('战斗'))+' 战斗',1),(0,r.createElementVNode)('div',dt,[a[28]||(a[28]=(0,r.createElementVNode)('span',{class:'k'},'HP',-1)),(0,r.createElementVNode)('span',ut,(0,r.toDisplayString)(B.value['战斗']?.['生命值']?.['当前生命值']??'-')+'/'+(0,r.toDisplayString)(B.value['战斗']?.['生命值']?.['最大生命值']??'-'),1)]),(0,r.createElementVNode)('div',mt,[a[29]||(a[29]=(0,r.createElementVNode)('span',{class:'k'},'临时HP',-1)),(0,r.createElementVNode)('span',pt,(0,r.toDisplayString)(B.value['战斗']?.['生命值']?.['临时生命值']??0),1)]),(0,r.createElementVNode)('div',vt,[a[30]||(a[30]=(0,r.createElementVNode)('span',{class:'k'},'AC',-1)),(0,r.createElementVNode)('span',yt,(0,r.toDisplayString)(B.value['战斗']?.['护甲等级']??'-'),1)]),G(B.value['战斗']?.['资源'])?((0,r.openBlock)(),(0,r.createElementBlock)('div',ft,'资源')):(0,r.createCommentVNode)('v-if',!0),G(B.value['战斗']?.['资源'])?((0,r.openBlock)(),(0,r.createElementBlock)('div',kt,['$meta'!==e.k?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(K(B.value['战斗']?.['资源']),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{key:t,class:'chip'},(0,r.toDisplayString)(t)+': '+(0,r.toDisplayString)(e),1))),128)):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0),G(((0,r.unref)(s)||{})['主角']?.['临时状态'])?((0,r.openBlock)(),(0,r.createElementBlock)('div',gt,'临时状态')):(0,r.createCommentVNode)('v-if',!0),G(((0,r.unref)(s)||{})['主角']?.['临时状态'])?((0,r.openBlock)(),(0,r.createElementBlock)('div',ht,['$meta'!==e.k?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(K(((0,r.unref)(s)||{})['主角']?.['临时状态']),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{key:t,class:'chip'},(0,r.toDisplayString)(t),1))),128)):(0,r.createCommentVNode)('v-if',!0)])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('details',Et,[(0,r.createElementVNode)('summary',Nt,(0,r.toDisplayString)(Y('熟练'))+' 熟练',1),(0,r.createElementVNode)('div',Vt,[a[31]||(a[31]=(0,r.createElementVNode)('span',{class:'k'},'熟练加值',-1)),(0,r.createElementVNode)('span',Bt,'+'+(0,r.toDisplayString)(B.value['熟练']?.['熟练加值']??'-'),1)]),a[32]||(a[32]=(0,r.createElementVNode)('div',{class:'sub-title'},'技能',-1)),(0,r.createElementVNode)('div',bt,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(q(B.value['熟练']?.['技能熟练']),e=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{key:e,class:'chip'},(0,r.toDisplayString)(e),1))),128))]),G(B.value['熟练'])&&W(J(B.value['熟练'],['熟练加值','技能熟练']))?((0,r.openBlock)(),(0,r.createBlock)(pe,{key:0,data:J(B.value['熟练'],['熟练加值','技能熟练'])},null,8,['data'])):(0,r.createCommentVNode)('v-if',!0)]),G(((0,r.unref)(s)||{})['主角']?.['声望'])?((0,r.openBlock)(),(0,r.createElementBlock)('details',wt,[(0,r.createElementVNode)('summary',Ct,(0,r.toDisplayString)(Y('声望'))+' 声望',1),(0,r.createVNode)(Be,{data:((0,r.unref)(s)||{})['主角']?.['声望']},null,8,['data'])])):(0,r.createCommentVNode)('v-if',!0)])):'classes'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' 职业（统一：details-card + KvTree2） '),(0,r.createElementVNode)('div',St,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(q(B.value['职业列表']),e=>((0,r.openBlock)(),(0,r.createElementBlock)('details',{key:String(e),class:'card details-card',open:''},[(0,r.createElementVNode)('summary',_t,[(0,r.createTextVNode)(' 📘 '+(0,r.toDisplayString)(e),1),(0,r.createElementVNode)('span',Dt,'Lv. '+(0,r.toDisplayString)(L(String(e))),1)]),(0,r.createVNode)(Be,{data:B.value['职业详情']?.[e]||{}},null,8,['data'])]))),128))])],64)):'items'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createCommentVNode)(' 物品（背包+货币） '),(0,r.createCommentVNode)(' 背包：将条目平铺为卡片 '),G(B.value['物品栏']?.['背包'])||Array.isArray(B.value['物品栏']?.['背包'])?((0,r.openBlock)(),(0,r.createElementBlock)('div',Mt,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Z(B.value['物品栏']?.['背包']),([e,t])=>((0,r.openBlock)(),(0,r.createElementBlock)('details',{class:'card details-card',key:String(e),open:''},[(0,r.createElementVNode)('summary',At,(0,r.toDisplayString)(X(t))+' '+(0,r.toDisplayString)(t?.['名称']||e),1),(0,r.createElementVNode)('div',xt,[a[33]||(a[33]=(0,r.createElementVNode)('span',{class:'k'},'类型',-1)),(0,r.createElementVNode)('span',Lt,(0,r.toDisplayString)(t?.['类型']??'-'),1)]),null!=t?.['数量']?((0,r.openBlock)(),(0,r.createElementBlock)('div',It,[a[34]||(a[34]=(0,r.createElementVNode)('span',{class:'k'},'数量',-1)),(0,r.createElementVNode)('span',Pt,(0,r.toDisplayString)(t?.['数量']),1)])):(0,r.createCommentVNode)('v-if',!0),t?.['稀有度']?((0,r.openBlock)(),(0,r.createElementBlock)('div',Ft,[a[35]||(a[35]=(0,r.createElementVNode)('span',{class:'k'},'稀有度',-1)),(0,r.createElementVNode)('span',Ht,(0,r.toDisplayString)(t?.['稀有度']),1)])):(0,r.createCommentVNode)('v-if',!0),null!=t?.['重量']?((0,r.openBlock)(),(0,r.createElementBlock)('div',Tt,[a[36]||(a[36]=(0,r.createElementVNode)('span',{class:'k'},'重量',-1)),(0,r.createElementVNode)('span',Ot,(0,r.toDisplayString)(t?.['重量']),1)])):(0,r.createCommentVNode)('v-if',!0),t?.['描述']?((0,r.openBlock)(),(0,r.createElementBlock)('div',$t,[a[37]||(a[37]=(0,r.createElementVNode)('span',{class:'k'},'描述',-1)),(0,r.createElementVNode)('span',jt,(0,r.toDisplayString)(t?.['描述']),1)])):(0,r.createCommentVNode)('v-if',!0),W(J(t,['名称','类型','数量','稀有度','重量','描述']))?((0,r.openBlock)(),(0,r.createBlock)(pe,{key:4,data:J(t,['名称','类型','数量','稀有度','重量','描述'])},null,8,['data'])):(0,r.createCommentVNode)('v-if',!0)]))),128))])):G(B.value['物品栏'])?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(' 回退：直接平铺 物品栏 顶层各键为卡片 '),(0,r.createElementVNode)('div',zt,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(K(B.value['物品栏']),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('details',{key:String(t),class:'card details-card',open:''},[(0,r.createElementVNode)('summary',Rt,(0,r.toDisplayString)(X(e))+' '+(0,r.toDisplayString)(e?.['名称']||t),1),(0,r.createElementVNode)('div',Ut,[a[38]||(a[38]=(0,r.createElementVNode)('span',{class:'k'},'类型',-1)),(0,r.createElementVNode)('span',qt,(0,r.toDisplayString)(e?.['类型']??'-'),1)]),null!=e?.['数量']?((0,r.openBlock)(),(0,r.createElementBlock)('div',Gt,[a[39]||(a[39]=(0,r.createElementVNode)('span',{class:'k'},'数量',-1)),(0,r.createElementVNode)('span',Kt,(0,r.toDisplayString)(e?.['数量']),1)])):(0,r.createCommentVNode)('v-if',!0),null!=e?.['重量']?((0,r.openBlock)(),(0,r.createElementBlock)('div',Jt,[a[40]||(a[40]=(0,r.createElementVNode)('span',{class:'k'},'重量',-1)),(0,r.createElementVNode)('span',Wt,(0,r.toDisplayString)(e?.['重量']),1)])):(0,r.createCommentVNode)('v-if',!0),e?.['描述']?((0,r.openBlock)(),(0,r.createElementBlock)('div',Yt,[a[41]||(a[41]=(0,r.createElementVNode)('span',{class:'k'},'描述',-1)),(0,r.createElementVNode)('span',Xt,(0,r.toDisplayString)(e?.['描述']),1)])):(0,r.createCommentVNode)('v-if',!0),W(J(e,['名称','类型','数量','重量','描述']))?((0,r.openBlock)(),(0,r.createBlock)(pe,{key:3,data:J(e,['名称','类型','数量','重量','描述'])},null,8,['data'])):(0,r.createCommentVNode)('v-if',!0)]))),128))])],2112)):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 货币 '),(0,r.createElementVNode)('div',Qt,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(K(B.value['货币']),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{key:t,class:'chip'},(0,r.toDisplayString)(t)+': '+(0,r.toDisplayString)(e),1))),128))]),G(B.value['货币'])&&W(J(B.value['货币'],[]))?((0,r.openBlock)(),(0,r.createBlock)(pe,{key:2,data:J(B.value['货币'],[])},null,8,['data'])):(0,r.createCommentVNode)('v-if',!0)],64)):'equip'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:3},[(0,r.createCommentVNode)(' 装备 '),(0,r.createElementVNode)('div',Zt,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(w,e=>(0,r.createElementVNode)('details',{key:e,class:'card details-card',open:''},[(0,r.createElementVNode)('summary',ea,(0,r.toDisplayString)(Q(e))+' '+(0,r.toDisplayString)(e),1),(0,r.createElementVNode)('div',ta,[a[42]||(a[42]=(0,r.createElementVNode)('span',{class:'k'},'名称',-1)),(0,r.createElementVNode)('span',aa,(0,r.toDisplayString)(B.value['装备栏']?.[e]?.['名称']||'-'),1)]),G(B.value['装备栏']?.[e])?((0,r.openBlock)(),(0,r.createBlock)(Be,{key:0,data:B.value['装备栏']?.[e]},null,8,['data'])):(0,r.createCommentVNode)('v-if',!0)])),64))])],64)):'state'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:4},[(0,r.createCommentVNode)(' 状态（统一：details-card + KvTree2） '),(0,r.createElementVNode)('div',na,[(0,r.createElementVNode)('details',la,[a[43]||(a[43]=(0,r.createElementVNode)('summary',{class:'card-title'},'🔖 临时状态',-1)),(0,r.createVNode)(Be,{data:((0,r.unref)(s)||{})['主角']?.['临时状态']||{}},null,8,['data'])]),(0,r.createElementVNode)('details',oa,[a[44]||(a[44]=(0,r.createElementVNode)('summary',{class:'card-title'},'🎯 战斗资源',-1)),(0,r.createVNode)(Be,{data:B.value['战斗']?.['资源']||{}},null,8,['data'])])])],64)):'tasks'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:5},[(0,r.createCommentVNode)(' 任务 '),(0,r.unref)(s)?((0,r.openBlock)(),(0,r.createBlock)(Be,{key:0,data:(0,r.unref)(s)['任务']},null,8,['data'])):(0,r.createCommentVNode)('v-if',!0)],64)):'others'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:6},[(0,r.createCommentVNode)(' 其他角色（顶层每个角色为可折叠卡片） '),G((0,r.unref)(s)?.['其他角色'])?((0,r.openBlock)(),(0,r.createElementBlock)('div',ra,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(K((0,r.unref)(s)?.['其他角色']),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('details',{key:String(t),class:'card details-card',open:''},[(0,r.createElementVNode)('summary',sa,'🧑‍🤝‍🧑 '+(0,r.toDisplayString)(t),1),(0,r.createVNode)(Be,{data:e},null,8,['data'])]))),128))])):(0,r.unref)(s)?((0,r.openBlock)(),(0,r.createBlock)(Be,{key:1,data:(0,r.unref)(s)['其他角色']||{}},null,8,['data'])):(0,r.createCommentVNode)('v-if',!0)],64)):'nearby'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:7},[(0,r.createCommentVNode)(' 附近敌人（顶层每个敌人为可折叠卡片） '),G((0,r.unref)(s)?.['附近敌人'])?((0,r.openBlock)(),(0,r.createElementBlock)('div',ca,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(K((0,r.unref)(s)?.['附近敌人']),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('details',{key:String(t),class:'card details-card',open:''},[(0,r.createElementVNode)('summary',ia,'👹 '+(0,r.toDisplayString)(t),1),(0,r.createVNode)(Be,{data:e},null,8,['data'])]))),128))])):(0,r.unref)(s)?((0,r.openBlock)(),(0,r.createBlock)(Be,{key:1,data:(0,r.unref)(s)['附近敌人']||{}},null,8,['data'])):(0,r.createCommentVNode)('v-if',!0)],64)):'magic'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:8},[(0,r.createCommentVNode)(' 法术系统（独立面板） '),le.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',da,[Object.keys(oe.value).length?((0,r.openBlock)(),(0,r.createElementBlock)('details',ua,[a[45]||(a[45]=(0,r.createElementVNode)('summary',{class:'card-title'},'✨ 施法主属性',-1)),(0,r.createVNode)(Be,{data:oe.value},null,8,['data'])])):(0,r.createCommentVNode)('v-if',!0),G(ee.value['法术位'])?((0,r.openBlock)(),(0,r.createElementBlock)('details',ma,[a[46]||(a[46]=(0,r.createElementVNode)('summary',{class:'card-title'},'🔮 法术位',-1)),(0,r.createVNode)(Be,{data:ee.value['法术位']},null,8,['data'])])):(0,r.createCommentVNode)('v-if',!0),ne.value&&G(ee.value['契约魔法'])?((0,r.openBlock)(),(0,r.createElementBlock)('details',pa,[a[47]||(a[47]=(0,r.createElementVNode)('summary',{class:'card-title'},'🕯️ 契约魔法（邪术师）',-1)),(0,r.createVNode)(Be,{data:ee.value['契约魔法']},null,8,['data'])])):(0,r.createCommentVNode)('v-if',!0)])):((0,r.openBlock)(),(0,r.createElementBlock)('p',va,'未检测到法系职业，暂无法术系统数据'))],64)):'features'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:9},[(0,r.createCommentVNode)(' 能力特性（独立面板） '),G(((0,r.unref)(s)||{})['主角']?.['能力特性'])?((0,r.openBlock)(),(0,r.createElementBlock)('div',ya,[(0,r.createElementVNode)('details',fa,[(0,r.createElementVNode)('summary',ka,(0,r.toDisplayString)(Y('能力特性'))+' 能力特性',1),(0,r.createVNode)(Be,{data:((0,r.unref)(s)||{})['主角']?.['能力特性']},null,8,['data'])])])):((0,r.openBlock)(),(0,r.createElementBlock)('p',ga,'暂无能力特性数据'))],64)):'system'===O.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:10},[(0,r.createCommentVNode)(' 系统设置 '),(0,r.createElementVNode)('div',ha,[a[48]||(a[48]=(0,r.createElementVNode)('span',{class:'k'},'流式生成',-1)),(0,r.createElementVNode)('label',Ea,[(0,r.createElementVNode)('input',{type:'checkbox',checked:(0,r.unref)(t).stream,onChange:a[21]||(a[21]=e=>(0,r.unref)(t).toggleStream())},null,40,Na),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)((0,r.unref)(t).stream?'开启':'关闭'),1)])]),a[49]||(a[49]=(0,r.createElementVNode)('p',{class:'note'},'此开关会直接影响发送/重新生成时是否采用流式。',-1))],64)):(0,r.createCommentVNode)('v-if',!0)])],2)])):(0,r.createCommentVNode)('v-if',!0)],2)}}}),Ba=(0,c.A)(Va,[['__scopeId','data-v-fcda3ee4']]),ba={ref:'host',style:{width:'100%',display:'block'}},wa=['sandbox','srcdoc'],Ca=(0,r.defineComponent)({__name:'HtmlEmbed',props:{html:{},allowSameOrigin:{type:Boolean},autoHeight:{type:Boolean},minHeight:{}},setup(e){const t=e,a=(0,r.ref)(null),n=(0,r.computed)(()=>{const e=['allow-scripts'];return t.allowSameOrigin&&e.push('allow-same-origin'),e.join(' ')});const l=(0,r.computed)(()=>function(e){const t='\n<script>(function(){\n  try{\n    function post(){\n      var h = Math.max(\n        document.documentElement ? document.documentElement.scrollHeight : 0,\n        document.body ? document.body.scrollHeight : 0,\n        0\n      );\n      try{ parent.postMessage({ __dndHtmlEmbed: true, height: h }, \'*\'); }catch(e){}\n    }\n    var obs = new MutationObserver(function(){ post(); });\n    obs.observe(document.documentElement || document.body, { subtree: true, childList: true, attributes: true });\n    window.addEventListener(\'load\', post);\n    setTimeout(post, 0);\n  }catch(e){}\n})();<\/script>',a='<style>html,body{margin:0;padding:0;box-sizing:border-box;}</style>';let n=e||'';return n=/<\/body>/i.test(n)?n.replace(/<\/body>/i,`${a}${t}</body>`):/<\/html>/i.test(n)?n.replace(/<\/html>/i,`${a}${t}</html>`):`${n}${a}${t}`,n}(t.html));function o(e){const n=a.value;if(n&&t.autoHeight)try{if(!e||!e.data)return;if(n.contentWindow&&e.source!==n.contentWindow)return;if(!(!0===e.data.__dndHtmlEmbed||'resizeIframe'===e.data.type))return;const a=Number(e.data.height||0),l=t.minHeight??'0px',o=parseInt(l,10)||0,r=Math.max(a,o);n.style.height=`${r}px`}catch{}}return(0,r.onMounted)(()=>{!1!==t.autoHeight&&window.addEventListener('message',o)}),(0,r.onBeforeUnmount)(()=>{!1!==t.autoHeight&&window.removeEventListener('message',o)}),(0,r.watch)(()=>t.html,()=>{a.value&&t.minHeight&&(a.value.style.height=t.minHeight)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createElementVNode)('div',ba,[(0,r.createElementVNode)('iframe',{ref_key:'frame',ref:a,sandbox:n.value,srcdoc:l.value,style:{width:'100%',border:'0',display:'block'}},null,8,wa)],512),(0,r.createCommentVNode)(' 说明：不再直接给 iframe 设定固定高度，改为由外层容器承载高度，以满足“不该有 height 属性”的要求。')],2112))}}),Sa=(0,c.A)(Ca,[['__scopeId','data-v-4db95bd1']]),_a={key:0,class:'hero-bar'},Da={class:'hero-main'},Ma={class:'row line1'},Aa={class:'name'},xa={class:'race'},La={class:'lvl'},Ia={class:'row line2'},Pa={class:'hp'},Fa={class:'val'},Ha={key:0,class:'temp'},Ta={class:'ac'},Oa={class:'val'},$a={class:'xp'},ja={class:'val'},za={key:0,class:'nxp'},Ra={class:'val'},Ua={class:'row line3'},qa={class:'chips'},Ga={key:1,class:'message-card player'},Ka={class:'card-header'},Ja={class:'actions'},Wa=['innerHTML'],Ya={key:2,class:'message-card narrator'},Xa={class:'card-header'},Qa={class:'actions'},Za={key:0,class:'content'},en=['innerHTML'],tn={class:'nav-row'},an={class:'chapter-info'},nn={class:'input-area'},ln={class:'button-row'},on=['disabled'],rn=['disabled'],sn=['disabled'],cn=(0,r.defineComponent)({__name:'Stage',setup(e){const t=k(),n=m(),{stream:l}=a(t),{pairUserId:o,pairAssistantId:s,pairUserHtml:c,pairAssistantHtml:i,pairUserRaw:d,pairAssistantRaw:u,input:p,mvu:v,mainChar:y}=a(n),f=['力量','敏捷','体质','智力','感知','魅力'],g=(0,r.computed)(()=>v.value?.['主角']?.['身份']||y.value?.['身份']||{}),h=(0,r.computed)(()=>v.value?.['主角']?.['属性']||y.value?.['属性']||{}),E=(0,r.computed)(()=>v.value?.['主角']?.['战斗']?.['生命值']||y.value?.['战斗']?.['生命值']||{}),N=(0,r.computed)(()=>v.value?.['主角']?.['战斗']?.['护甲等级']??y.value?.['战斗']?.['护甲等级']),V=[{xp:0,prof:2},{xp:300,prof:2},{xp:900,prof:2},{xp:2700,prof:2},{xp:6500,prof:3},{xp:14e3,prof:3},{xp:23e3,prof:3},{xp:34e3,prof:3},{xp:48e3,prof:4},{xp:64e3,prof:4},{xp:85e3,prof:4},{xp:1e5,prof:4},{xp:12e4,prof:5},{xp:14e4,prof:5},{xp:165e3,prof:5},{xp:195e3,prof:5},{xp:225e3,prof:6},{xp:265e3,prof:6},{xp:305e3,prof:6},{xp:355e3,prof:6}],B=(0,r.computed)(()=>{const e=Number(v.value?.['主角']?.['身份']?.['总等级']??1);return V[Math.min(e,V.length-1)]?.xp??1/0}),b=(0,r.computed)(()=>Number(v.value?.['主角']?.['身份']?.['经验值']??0)>=Number(B.value)),w=(0,r.computed)(()=>Number(v.value?.['主角']?.['身份']?.['经验值']??0)),C=(0,r.computed)(()=>{const e=Number(B.value);return isFinite(e)?Math.max(0,e-w.value):null}),S=(0,r.ref)(!1),D=(0,r.ref)(!1),M=(0,r.ref)(''),A=(0,r.ref)('');function x(e){'user'===e?(S.value=!0,M.value=String(d.value||'')):(D.value=!0,A.value=String(u.value||''))}async function L(e){try{if('user'===e){if(null==o.value)return;await n.editById(o.value,M.value)}else{if(null==s.value)return;await n.editById(s.value,A.value)}}finally{S.value=!1,D.value=!1}}function I(e){'user'===e?S.value=!1:D.value=!1}const P=(0,r.ref)(null);function F(){const e=P.value;if(!e)return;const t=e.getBoundingClientRect(),a=window.innerHeight||document.documentElement.clientHeight||800,n=Math.max(620,Math.floor(a-t.top-56));e.style.height=n+'px',e.style.overflow='auto'}function H(){try{const e=window;'object'==typeof e&&e.dispatchEvent(new CustomEvent('dnd-open-levelup'))}catch{}}(0,r.onMounted)(()=>{requestAnimationFrame(F),window.addEventListener('resize',F),window.addEventListener('orientationchange',F)}),(0,r.watch)(y,()=>setTimeout(F,0)),(0,r.onBeforeUnmount)(()=>{window.removeEventListener('resize',F),window.removeEventListener('orientationchange',F)});const T=(0,r.computed)(()=>{try{const e=String(i.value||''),t=e=>{try{const t=document.createElement('textarea');return t.innerHTML=e,t.value}catch{return e}},a=(new DOMParser).parseFromString(e,'text/html'),n=[];let l=0;const o=e=>{if(1===e.nodeType){const a=e;if('pre'===a.tagName.toLowerCase()){const e=a.querySelector('code'),o=e&&e.textContent||'',r=t(o);if(/(<!DOCTYPE\s+html|<html[\s\S]*?>)/i.test(r))return void n.push({kind:'embed',html:r,key:String(l++)+':embed'})}n.push({kind:'html',html:a.outerHTML,key:String(l++)+':html'})}else if(3===e.nodeType){(e.textContent||'').trim()&&n.push({kind:'html',html:e.textContent,key:String(l++)+':text'})}};return Array.from(a.body.childNodes).forEach(o),0===n.length&&n.push({kind:'html',html:e,key:'fallback:html'}),n}catch{return[{kind:'html',html:String(i.value||''),key:'fallback:html'}]}});(0,r.computed)(()=>{try{return String(i.value||'').replace(/<pre\b[\s\S]*?<code\b[\s\S]*?>[\s\S]*?<\/code>[\s\S]*?<\/pre>/i,'').trim()}catch{return String(i.value||'')}});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{ref_key:'wrap',ref:P,class:'stage-container'},[(0,r.createCommentVNode)(' 信息条（左栏风格） '),g.value||h.value||E.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',_a,[t[22]||(t[22]=(0,r.createElementVNode)('div',{class:'avatar','aria-hidden':''},'🧙',-1)),(0,r.createElementVNode)('div',Da,[(0,r.createElementVNode)('div',Ma,[(0,r.createElementVNode)('span',Aa,(0,r.toDisplayString)(g.value?.['姓名']||'未命名'),1),t[16]||(t[16]=(0,r.createElementVNode)('span',{class:'sep'},'·',-1)),(0,r.createElementVNode)('span',xa,(0,r.toDisplayString)(g.value?.['种族']||'-'),1),t[17]||(t[17]=(0,r.createElementVNode)('span',{class:'sep'},'·',-1)),(0,r.createElementVNode)('span',La,'Lv. '+(0,r.toDisplayString)(g.value?.['总等级']??'-'),1)]),(0,r.createElementVNode)('div',Ia,[(0,r.createElementVNode)('div',Pa,[t[18]||(t[18]=(0,r.createElementVNode)('span',{class:'label'},'HP',-1)),(0,r.createElementVNode)('span',Fa,(0,r.toDisplayString)(E.value?.['当前生命值']??'-')+'/'+(0,r.toDisplayString)(E.value?.['最大生命值']??'-'),1),(E.value?.['临时生命值']??0)>0?((0,r.openBlock)(),(0,r.createElementBlock)('span',Ha,'(+'+(0,r.toDisplayString)(E.value?.['临时生命值']??0)+')',1)):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Ta,[t[19]||(t[19]=(0,r.createElementVNode)('span',{class:'label'},'AC',-1)),(0,r.createElementVNode)('span',Oa,(0,r.toDisplayString)(N.value??'-'),1)]),(0,r.createElementVNode)('div',$a,[t[20]||(t[20]=(0,r.createElementVNode)('span',{class:'label'},'XP',-1)),(0,r.createElementVNode)('span',ja,(0,r.toDisplayString)(w.value),1)]),null!==C.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',za,[t[21]||(t[21]=(0,r.createElementVNode)('span',{class:'label'},'距下一级',-1)),(0,r.createElementVNode)('span',Ra,'还需 '+(0,r.toDisplayString)(C.value),1)])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',Ua,[(0,r.createElementVNode)('div',qa,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(f,e=>(0,r.createElementVNode)('span',{class:'chip',key:e},(0,r.toDisplayString)(e)+': '+(0,r.toDisplayString)(h.value?.[e]??'-'),1)),64))])])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.createCommentVNode)(' 玩家发言 '),((0,r.openBlock)(),(0,r.createElementBlock)('div',Ga,[(0,r.createElementVNode)('div',Ka,[t[23]||(t[23]=(0,r.createElementVNode)('span',{class:'speaker'},'⚔ 玩家',-1)),(0,r.createElementVNode)('div',Ja,[S.value?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'edit-btn',onClick:t[0]||(t[0]=e=>x('user'))},'✎')),S.value?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'delete-btn',onClick:t[1]||(t[1]=()=>(0,r.unref)(n).deleteById((0,r.unref)(o)||void 0))},' 🗑 ')),S.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createElementVNode)('button',{class:'edit-btn',onClick:t[2]||(t[2]=e=>L('user'))},'✔'),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:t[3]||(t[3]=e=>I('user'))},'✖')],64)):(0,r.createCommentVNode)('v-if',!0)])]),S.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[4]||(t[4]=e=>M.value=e),class:'edit-textarea',rows:'6'},null,512)),[[r.vModelText,M.value]]):((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'content',innerHTML:(0,r.unref)(c)},null,8,Wa))])),(0,r.createCommentVNode)(' 叙述者回应 '),((0,r.openBlock)(),(0,r.createElementBlock)('div',Ya,[(0,r.createElementVNode)('div',Xa,[t[24]||(t[24]=(0,r.createElementVNode)('span',{class:'speaker'},'📜 叙述者',-1)),(0,r.createElementVNode)('div',Qa,[D.value?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'edit-btn',onClick:t[5]||(t[5]=e=>x('assistant'))},'✎')),D.value?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'delete-btn',onClick:t[6]||(t[6]=()=>(0,r.unref)(n).deleteById((0,r.unref)(s)||void 0))},' 🗑 ')),D.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:2},[(0,r.createElementVNode)('button',{class:'edit-btn',onClick:t[7]||(t[7]=e=>L('assistant'))},'✔'),(0,r.createElementVNode)('button',{class:'delete-btn',onClick:t[8]||(t[8]=e=>I('assistant'))},'✖')],64)):(0,r.createCommentVNode)('v-if',!0)])]),D.value?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)('textarea',{key:1,'onUpdate:modelValue':t[9]||(t[9]=e=>A.value=e),class:'edit-textarea',rows:'10'},null,512)),[[r.vModelText,A.value]]):((0,r.openBlock)(),(0,r.createElementBlock)('div',Za,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(T.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:e.key},['html'===e.kind?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,innerHTML:e.html},null,8,en)):((0,r.openBlock)(),(0,r.createBlock)(Sa,{html:e.html,autoHeight:!0,allowSameOrigin:!0,key:e.key},null,8,['html']))],64))),128))]))])),(0,r.createCommentVNode)(' 分页导航 '),(0,r.createElementVNode)('div',tn,[(0,r.createElementVNode)('button',{class:'nav-btn',onClick:t[10]||(t[10]=(...e)=>(0,r.unref)(n).pagePrevPair&&(0,r.unref)(n).pagePrevPair(...e))},'‹ 上一幕'),(0,r.createElementVNode)('span',an,'#'+(0,r.toDisplayString)((0,r.unref)(o))+' • #'+(0,r.toDisplayString)((0,r.unref)(s)),1),(0,r.createElementVNode)('button',{class:'nav-btn',onClick:t[11]||(t[11]=(...e)=>(0,r.unref)(n).pageNextPair&&(0,r.unref)(n).pageNextPair(...e))},'下一幕 ›')]),(0,r.createCommentVNode)(' 输入区域 '),(0,r.createElementVNode)('div',nn,[(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[12]||(t[12]=e=>(0,r.isRef)(p)?p.value=e:null),class:'text-input',rows:'3',placeholder:'输入你的行动...'},null,512),[[r.vModelText,(0,r.unref)(p)]]),(0,r.createElementVNode)('div',ln,[(0,r.createElementVNode)('button',{class:'action-btn reroll',disabled:(0,r.unref)(n).isGenerating,onClick:t[13]||(t[13]=()=>(0,r.unref)(n).onReroll((0,r.unref)(l)))},' 🔄 重新生成 ',8,on),b.value?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:0,class:'action-btn send',disabled:(0,r.unref)(n).isGenerating,onClick:H},' ⬆️ 升级 ',8,rn)):(0,r.createCommentVNode)('v-if',!0),(0,r.unref)(n).isGenerating?((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:2,class:'action-btn stop',onClick:t[15]||(t[15]=(...e)=>(0,r.unref)(n).stopAll&&(0,r.unref)(n).stopAll(...e))},'🛑 停止')):((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:1,class:'action-btn send',disabled:(0,r.unref)(n).isGenerating,onClick:t[14]||(t[14]=()=>(0,r.unref)(n).onSend((0,r.unref)(l)))},' 📤 发送 ',8,sn))])])],512))}}),dn=(0,c.A)(cn,[['__scopeId','data-v-18c22603']]),un={class:'panel glass'},mn=['checked'],pn=(0,r.defineComponent)({__name:'System',setup(e){const t=k(),{stream:n}=a(t);return(e,a)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',un,[a[2]||(a[2]=(0,r.createElementVNode)('h2',null,'系统',-1)),(0,r.createElementVNode)('div',null,[a[1]||(a[1]=(0,r.createTextVNode)('流式生成：',-1)),(0,r.createElementVNode)('input',{type:'checkbox',checked:(0,r.unref)(n),onChange:a[0]||(a[0]=e=>(0,r.unref)(t).toggleStream())},null,40,mn)])]))}}),vn=(0,c.A)(pn,[['__scopeId','data-v-2eba7f34']]),yn={class:'panel glass'},fn=(0,r.defineComponent)({__name:'Tasks',setup(e){const t=m(),{mvu:n}=a(t),l=(0,r.computed)(()=>n.value?.['任务']??{});return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',yn,[t[0]||(t[0]=(0,r.createElementVNode)('h2',null,'任务',-1)),(0,r.createElementVNode)('pre',null,(0,r.toDisplayString)(JSON.stringify(l.value,null,2)),1)]))}}),kn=(0,c.A)(fn,[['__scopeId','data-v-4348a964']]),gn=(0,s.createRouter)({history:(0,s.createMemoryHistory)(),routes:[{path:'/',component:Ba,children:[{path:'',component:dn},{path:'character',component:f},{path:'tasks',component:kn},{path:'inventory',component:X},{path:'system',component:vn},{path:'init',component:J}]}]});function hn(e=715){try{const t=window.frameElement;if(!t)return;if('1'===t.getAttribute('data-dnd-fs'))return;t.style.setProperty('height',`${e}px`,'important'),t.style.setProperty('max-height','none','important'),t.style.setProperty('width','100%','important')}catch(e){}}gn.replace('/'),window.__dndSetIframeHeight=hn;const En=new Map;function Nn(e,t){if(En.has(e))return;const a={};for(const n of t)a[n]=e.style.getPropertyValue(n)||'';En.set(e,a)}function Vn(e){const t=En.get(e);if(t){for(const[a,n]of Object.entries(t))n?e.style.setProperty(a,n):e.style.removeProperty(a);En.delete(e)}}function Bn(e=!0){try{const t=window.frameElement;if(!t)return;const a=t.ownerDocument;if(!a)return;const n=a.querySelector('#chat'),l=a.querySelector('#sheld'),o=t.parentElement?.closest('.mes_text')||t.closest('.mes_text'),r=t.parentElement?.closest('.mes')||t.closest('.mes'),s=[n,l,o,r,t.parentElement?.closest('.mes_block')||t.closest('.mes_block')].filter(Boolean);if(e)for(const e of s)e===n||e===l?(Nn(e,['overflow','max-height']),e.style.setProperty('overflow','hidden','important'),e===n&&e.style.setProperty('max-height','none','important')):(Nn(e,['overflow','max-height','height','padding-bottom']),e.style.setProperty('overflow','visible','important'),e.style.setProperty('max-height','none','important'),e.style.setProperty('height','auto','important'),e===o&&e.style.setProperty('padding-bottom','0','important'));else for(const e of s){Vn(e);try{e!==n&&e!==l||(e.style.setProperty('overflow','auto','important'),e===n&&e.style.setProperty('max-height','none','important'))}catch(e){}}}catch(e){}}function bn(){const t=document.getElementById('app');if(!t)return!1;const a=(0,r.createApp)(u);a.use(gn),a.use(e()),a.mount(t);try{t.setAttribute('data-dnd-ui','ready'),t.style.display='block',t.style.minHeight||(t.style.minHeight='240px'),Bn(!1),function(){try{const e=window.frameElement?.ownerDocument;if(!e)return;const t=(t,a)=>{const n={};if(!t)return n;const l=e.defaultView.getComputedStyle(t);for(const e of a)n[e]=l.getPropertyValue(e);return n},a=t=>e.querySelector(`#chat .mes .mes_text ${t}`)||e.querySelector(t),n=a('p'),l=a('em'),o=a('q'),r=['color','font-family','font-size','font-style','font-weight','line-height'],s=['margin-top','margin-bottom'],c=t(n,[...r,...s]),i=t(l,r),d=t(o,r),u=[n?`p{color:${c.color};font-family:${c['font-family']};font-size:${c['font-size']};font-style:${c['font-style']};font-weight:${c['font-weight']};line-height:${c['line-height']};margin-top:${c['margin-top']};margin-bottom:${c['margin-bottom']};}`:'',l?`em{color:${i.color};font-family:${i['font-family']};font-style:${i['font-style']};font-weight:${i['font-weight']};line-height:${i['line-height']};}`:'',o?`q{color:${d.color};font-family:${d['font-family']};font-size:${d['font-size']};font-style:${d['font-style']};font-weight:${d['font-weight']};line-height:${d['line-height']};}`:'','q::before{content:none !important}q::after{content:none !important}'].filter(Boolean).join('');let m=document.getElementById('synced-host-typography');m||(m=document.createElement('style'),m.id='synced-host-typography',document.head.appendChild(m)),m.textContent=u,console.log('DnD typography synced:',u)}catch(e){console.error('Failed to sync typography:',e)}}(),setTimeout(()=>hn(715),16);try{const e=getLastMessageId();let t=!1;for(let a=e;a>=0&&a>=e-10;a--)try{const e=getChatMessages(a)[0]||{};if('user'===e?.role){t=!0;break}}catch(e){}t||gn.replace('/init')}catch(e){}}catch(e){}return!0}window.__dndManageHostScrollbars=Bn;const wn=()=>{if(bn())return;const e=new MutationObserver(()=>{bn()&&e.disconnect()});e.observe(document.documentElement||document.body,{childList:!0,subtree:!0})};'loading'===document.readyState?document.addEventListener('readystatechange',()=>{'loading'!==document.readyState&&wn()}):wn();const Cn=()=>{document.getElementById('app')};'loading'===document.readyState?document.addEventListener('readystatechange',()=>{'loading'!==document.readyState&&Cn()}):Cn();</script><style>@import url(https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Source+Code+Pro:wght@400;500;600&display=swap);
.panel[data-v-49683b20]{padding:16px}

.init-page[data-v-0de37b7e]{max-width:980px;padding:16px;background:#15151a;color:#e8e2d4;border:1px solid #3a3a3c;border-radius:10px;height:100%;max-height:none;box-sizing:border-box;overflow:auto;-webkit-overflow-scrolling:touch}.init-page[data-v-0de37b7e]::-webkit-scrollbar{width:10px;height:10px}.init-page[data-v-0de37b7e]::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.22);border-radius:8px;border:1px solid rgba(255,255,255,0.15)}.init-page[data-v-0de37b7e]::-webkit-scrollbar-track{background:rgba(255,255,255,0.06)}.section[data-v-0de37b7e]::-webkit-scrollbar{width:8px;height:8px}.section[data-v-0de37b7e]{max-height:unset;overflow:visible}h2[data-v-0de37b7e]{margin:0 0 12px;color:#ffd700}.section[data-v-0de37b7e]{margin:14px 0;padding:10px;border:1px solid #2a2a2f;border-radius:8px}.row[data-v-0de37b7e]{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:6px 0}label[data-v-0de37b7e]{opacity:0.9;margin-right:4px}input[data-v-0de37b7e],select[data-v-0de37b7e]{background:#0f1216;color:#e8e2d4;border:1px solid #3a3a3c;border-radius:6px;padding:6px 8px}.attrs[data-v-0de37b7e]{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:8px}.attr[data-v-0de37b7e]{display:flex;flex-direction:column;gap:4px}.skills[data-v-0de37b7e]{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:6px}.grid[data-v-0de37b7e]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:100%}.grid .wide[data-v-0de37b7e]{grid-column:span 3}.mini[data-v-0de37b7e]{padding:4px 8px;background:#2a2a2f;border:1px solid #47474a;border-radius:6px;color:#e8e2d4;cursor:pointer}.actions[data-v-0de37b7e]{display:flex;justify-content:flex-end;gap:10px;margin-top:10px}button[data-v-0de37b7e]{padding:8px 12px;background:#2a2a2f;border:1px solid #47474a;color:#e8e2d4;border-radius:6px;cursor:pointer}.primary[data-v-0de37b7e]{background:#0f1f3a;color:#93c5fd}.multi .list[data-v-0de37b7e]{display:flex;flex-wrap:wrap;gap:6px}.pill[data-v-0de37b7e]{display:inline-flex;gap:6px;align-items:center}.points[data-v-0de37b7e]{margin:6px 0}.attr-rows[data-v-0de37b7e]{display:flex;flex-direction:column;gap:6px}.attr-row[data-v-0de37b7e]{display:grid;grid-template-columns:80px 36px 48px 36px 1fr;align-items:center;gap:6px;padding:6px;border:1px solid #2a2a2f;border-radius:6px}.step[data-v-0de37b7e]{padding:4px 8px;background:#2a2a2f;border:1px solid #47474a;border-radius:6px;color:#e8e2d4;cursor:pointer}.v[data-v-0de37b7e]{font-weight:700;text-align:center}.cost[data-v-0de37b7e]{opacity:0.8;font-size:12px}.cost.disabled[data-v-0de37b7e]{opacity:0.4}.bg-info[data-v-0de37b7e]{margin-top:8px;padding:8px;border:1px dashed #3a3a3c;border-radius:6px;background:rgba(255,255,255,0.04)}.bg-info .desc[data-v-0de37b7e]{margin:0 0 6px}.chips[data-v-0de37b7e]{display:flex;gap:6px;flex-wrap:wrap}.chip[data-v-0de37b7e]{padding:2px 8px;border-radius:999px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.18)}.note[data-v-0de37b7e]{opacity:0.85;margin-top:4px}@media (max-width:900px){.attrs[data-v-0de37b7e]{grid-template-columns:repeat(3,minmax(0,1fr))}.skills[data-v-0de37b7e]{grid-template-columns:repeat(2,minmax(0,1fr))}.grid[data-v-0de37b7e]{grid-template-columns:repeat(2,1fr)}.grid .wide[data-v-0de37b7e]{grid-column:span 2}}@media (max-width:600px){.init-page[data-v-0de37b7e]{max-width:100%;padding:12px}.row[data-v-0de37b7e]{gap:6px;flex-direction:column;align-items:stretch}button[data-v-0de37b7e],.step[data-v-0de37b7e]{min-height:40px}.skills[data-v-0de37b7e]{grid-template-columns:repeat(1,minmax(0,1fr))}.attr-row[data-v-0de37b7e]{grid-template-columns:72px 32px 44px 32px 1fr}.actions[data-v-0de37b7e]{justify-content:stretch}.actions button[data-v-0de37b7e]{flex:1 1 48%}}@media (max-width:480px){.init-page[data-v-0de37b7e]{padding:10px}.row[data-v-0de37b7e]{gap:4px}button[data-v-0de37b7e],.step[data-v-0de37b7e]{min-height:44px}.points[data-v-0de37b7e]{margin:8px 0}}

.panel[data-v-6e05e7ac]{padding:16px}

.kv-tree[data-v-716fa843]{display:block}.row[data-v-716fa843]{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.12)}.k[data-v-716fa843]{opacity:0.85;margin-right:10px}.v[data-v-716fa843]{font-weight:600;word-break:break-word;white-space:pre-wrap}.branch[data-v-716fa843]{margin:6px 0 8px}.title[data-v-716fa843]{margin:8px 0 6px;font-size:14px;color:#ffd700;cursor:pointer}.meta[data-v-716fa843]{opacity:0.6;font-size:12px;margin-left:6px}.dnd-layout.fs{padding:8px 0}

.kv2[data-v-6a1f6601]{word-break:break-word;overflow-wrap:anywhere;width:100%;max-width:100%;box-sizing:border-box}.kv2 .row[data-v-6a1f6601]{display:grid;grid-template-columns:minmax(80px,35%) 1fr;gap:4px 8px;padding:4px 0;border-bottom:1px dashed rgba(255,255,255,0.12);align-items:flex-start;width:100%;max-width:100%;box-sizing:border-box}.kv2 .k[data-v-6a1f6601]{opacity:0.9;min-width:0;max-width:100%;font-family:'Crimson Text','Georgia',serif;font-weight:600;color:#d4af37;word-break:break-word;overflow-wrap:anywhere;hyphens:auto}.kv2 .v[data-v-6a1f6601]{min-width:0;max-width:100%;word-break:break-word;overflow-wrap:anywhere;font-family:'Source Code Pro','Consolas',monospace;font-weight:500;letter-spacing:0.1px;hyphens:auto}@media (max-width:500px){.kv2 .row[data-v-6a1f6601]{grid-template-columns:1fr;gap:2px;padding:3px 0}.kv2 .k[data-v-6a1f6601]{font-size:13px;margin-bottom:2px;padding-right:0}.kv2 .v[data-v-6a1f6601]{font-size:12px;letter-spacing:0;padding-left:8px}}.atom[data-v-6a1f6601]{opacity:0.95;font-family:'Source Code Pro','Consolas',monospace;font-weight:500}

#app{height:715px;max-height:715px;overflow:hidden}#app{height:100% !important;max-height:100% !important}.dnd-layout[data-v-fcda3ee4]{position:relative;height:100%;width:100%;max-width:100%;box-sizing:border-box;font-family:'Noto Sans',sans-serif;color:#e8dcc0;background:linear-gradient(135deg,#1a1612 0%,#2a2520 100%);font-size:15px;font-style:normal;font-weight:500;line-height:23px;margin-top:0px;margin-bottom:10px;--desk-bg:linear-gradient(135deg,#1a1612 0%,#2a2520 100%);--hero-bg:linear-gradient(135deg,#2d1810 0%,#1a1612 100%);--hero-border:rgba(139,69,19,0.4);--stage-bg:linear-gradient(135deg,#2d1810 0%,#1a1612 100%);--stage-border:rgba(139,69,19,0.4);--input-area-bg:linear-gradient(135deg,rgba(45,24,16,0.8) 0%,rgba(26,22,18,0.9) 100%);--input-area-border:rgba(139,69,19,0.4);--text-input-bg:linear-gradient(135deg,rgba(15,18,22,0.9) 0%,rgba(26,22,18,0.8) 100%);--text-input-border:rgba(139,69,19,0.3);--text-input-color:#e8dcc0;--text-input-border-focus:rgba(212,175,55,0.6);--text-input-outline:rgba(212,175,55,0.2);--text-input-placeholder:rgba(232,220,192,0.5);background-image:radial-gradient(circle at 25% 25%,rgba(244,236,210,0.02) 0%,transparent 50%),radial-gradient(circle at 75% 75%,rgba(244,236,210,0.01) 0%,transparent 50%);transition:color 0.3s ease,background 0.3s ease,box-shadow 0.3s ease,border-color 0.3s ease}.dnd-layout.dark-mode[data-v-fcda3ee4]{color:#c9d1d9;background:linear-gradient(135deg,#0d1117 0%,#161b22 100%);--desk-bg:linear-gradient(135deg,#0d1117 0%,#161b22 100%);--hero-bg:linear-gradient(135deg,#21262d 0%,#161b22 100%);--hero-border:rgba(48,54,61,0.4);--stage-bg:linear-gradient(135deg,#21262d 0%,#161b22 100%);--stage-border:rgba(48,54,61,0.4);--input-area-bg:linear-gradient(135deg,rgba(33,38,46,0.8) 0%,rgba(22,27,34,0.9) 100%);--input-area-border:rgba(48,54,61,0.4);--text-input-bg:linear-gradient(135deg,rgba(22,27,34,0.9) 0%,rgba(33,38,46,0.8) 100%);--text-input-border:rgba(48,54,61,0.3);--text-input-color:#c9d1d9;--text-input-border-focus:rgba(88,166,255,0.6);--text-input-outline:rgba(88,166,255,0.2);--text-input-placeholder:rgba(201,209,217,0.5);background-image:radial-gradient(circle at 25% 25%,rgba(48,54,61,0.02) 0%,transparent 50%),radial-gradient(circle at 75% 75%,rgba(33,38,46,0.01) 0%,transparent 50%)}.dnd-layout.dark-mode .sidebar-panel[data-v-fcda3ee4]{background:linear-gradient(135deg,#21262d 0%,#161b22 100%);border-color:rgba(48,54,61,0.4)}.dnd-layout.dark-mode .side-btn[data-v-fcda3ee4]{background:rgba(33,38,46,0.6);color:#c9d1d9;border-color:rgba(48,54,61,0.3)}.dnd-layout.dark-mode .side-btn[data-v-fcda3ee4]:hover{background:rgba(48,54,61,0.8);border-color:rgba(48,54,61,0.5);color:#58a6ff;box-shadow:0 2px 4px rgba(0,0,0,0.3),0 0 8px rgba(88,166,255,0.2)}.dnd-layout.dark-mode .skill-panel[data-v-fcda3ee4]{background:linear-gradient(135deg,#21262d 0%,#161b22 100%);border-color:rgba(48,54,61,0.4);box-shadow:0 0 0 2px rgba(88,166,255,0.2),0 12px 32px rgba(0,0,0,0.6),inset 0 0 0 1px rgba(255,255,255,0.05)}.dnd-layout.dark-mode .skill-panel[data-v-fcda3ee4]::before{border-color:rgba(88,166,255,0.1)}.dnd-layout.dark-mode .skill-panel header[data-v-fcda3ee4]{background:linear-gradient(135deg,rgba(33,38,46,0.8) 0%,rgba(22,27,34,0.9) 100%);border-bottom-color:rgba(48,54,61,0.4)}.dnd-layout.dark-mode .skill-panel header h3[data-v-fcda3ee4]{color:#58a6ff}.dnd-layout.dark-mode .skill-panel .body[data-v-fcda3ee4]{color:#c9d1d9}.dnd-layout.dark-mode .card[data-v-fcda3ee4]{background:rgba(33,38,46,0.6);border-color:rgba(48,54,61,0.3)}.dnd-layout.dark-mode .card[data-v-fcda3ee4]:hover{border-color:rgba(88,166,255,0.3);background:rgba(33,38,46,0.8)}.dnd-layout.dark-mode .card-title[data-v-fcda3ee4]{color:#58a6ff}.dnd-layout.dark-mode .menu-btn[data-v-fcda3ee4]{background:linear-gradient(145deg,#21262d 0%,#161b22 100%);border-color:rgba(48,54,61,0.6);color:#58a6ff}.dnd-layout.dark-mode .menu-btn[data-v-fcda3ee4]:hover{background:linear-gradient(145deg,#30363d 0%,#21262d 100%);border-color:rgba(48,54,61,0.8)}.dnd-layout.dark-mode .class-btn[data-v-fcda3ee4]{background:linear-gradient(145deg,#30363d 0%,#21262d 100%);color:#c9d1d9;border-color:rgba(48,54,61,0.6)}.dnd-layout.dark-mode .class-btn[data-v-fcda3ee4]:hover{background:linear-gradient(145deg,#3d444d 0%,#30363d 100%);border-color:rgba(48,54,61,1);box-shadow:inset 0 1px 0 rgba(255,255,255,0.1),0 3px 6px rgba(0,0,0,0.4),0 0 8px rgba(88,166,255,0.2)}.dnd-layout.dark-mode .btn-primary[data-v-fcda3ee4]{background:linear-gradient(145deg,#238636 0%,#1a7f37 100%);color:#c9d1d9;border-color:rgba(48,54,61,0.8)}.dnd-layout.dark-mode .btn-primary[data-v-fcda3ee4]:hover{background:linear-gradient(145deg,#2ea043 0%,#238636 100%);border-color:rgba(48,54,61,1);box-shadow:inset 0 1px 0 rgba(255,255,255,0.1),0 3px 6px rgba(0,0,0,0.4),0 0 8px rgba(46,160,67,0.2)}.dnd-layout.fs[data-v-fcda3ee4]{position:fixed;inset:0;z-index:2147483638}.dnd-title[data-v-fcda3ee4]{font-family:'Cinzel','Times New Roman',serif;font-weight:600;letter-spacing:0.5px}.dnd-body[data-v-fcda3ee4]{font-family:'Crimson Text','Georgia',serif;font-weight:400;line-height:1.6}.dnd-data[data-v-fcda3ee4]{font-family:'Source Code Pro','Consolas',monospace;font-weight:500;letter-spacing:0.2px}.dnd-description[data-v-fcda3ee4]{font-family:'Libre Baskerville','Times New Roman',serif;font-weight:400;line-height:1.7;font-style:italic}.dnd-layout.fs .desktop-layout[data-v-fcda3ee4]{padding:0 12px 12px;height:100%}.dnd-layout.fs .sidebar-panel[data-v-fcda3ee4]{width:min(360px,22vw);position:fixed;top:0;right:0;bottom:0;height:100vh}.dnd-layout.fs .skill-panel[data-v-fcda3ee4]{width:clamp(520px,42vw,1024px)}.dnd-layout.fs .stage-container{max-width:100% !important;width:100% !important}.dnd-layout.fs .init-page{max-width:96vw !important;width:96vw !important;min-height:100% !important}.dnd-layout.fs .skill-panel .body .card-grid[data-v-fcda3ee4]{grid-template-columns:1fr !important;gap:12px}.dnd-layout.fs .skill-panel .body .card[data-v-fcda3ee4]{padding:10px}.dnd-layout.fs .skill-panel .body .kv-row[data-v-fcda3ee4]{padding:6px 0}.dnd-layout.fs .skill-panel .body .chips[data-v-fcda3ee4]{gap:6px}.dnd-layout.fs .skill-panel .body .kv-tree .row[data-v-fcda3ee4]{padding:6px 0}.dnd-layout.fs .skill-panel .body .kv-tree .k[data-v-fcda3ee4]{margin-right:10px}.dnd-layout.fs .skill-panel .body .kv-tree .title[data-v-fcda3ee4]{margin:8px 0 6px}.topbar[data-v-fcda3ee4]{display:flex;align-items:center;justify-content:space-between;height:40px;padding:0 16px;border-bottom:1px solid rgba(139,69,19,0.4);background:linear-gradient(135deg,#2d1810 0%,#1a1612 100%);color:#e8dcc0;position:sticky;top:0;z-index:2147483639;box-shadow:0 1px 4px rgba(0,0,0,0.3);transition:all 0.3s ease}.dnd-layout.dark-mode .topbar[data-v-fcda3ee4]{background:linear-gradient(135deg,#21262d 0%,#161b22 100%);border-bottom-color:rgba(48,54,61,0.4);color:#c9d1d9}.brand[data-v-fcda3ee4]{font-family:'Cinzel','Times New Roman',serif;font-weight:700;font-size:16px;letter-spacing:1px;color:#d4af37;text-shadow:0 0 6px rgba(212,175,55,0.2)}.right-actions[data-v-fcda3ee4]{display:flex;gap:8px}.menu-btn[data-v-fcda3ee4]{padding:6px;background:linear-gradient(145deg,#3a2a1e 0%,#2d1810 100%);border:1px solid rgba(139,69,19,0.6);border-radius:6px;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;color:#d4af37;font-weight:500;box-shadow:0 1px 3px rgba(0,0,0,0.2);transition:all 0.15s ease}.menu-btn[data-v-fcda3ee4]:hover{background:linear-gradient(145deg,#4a3728 0%,#3a1e14 100%);border-color:rgba(139,69,19,0.8);box-shadow:0 2px 4px rgba(0,0,0,0.3);transform:translateY(-1px)}.menu-btn[data-v-fcda3ee4]:active{transform:translateY(0);box-shadow:0 1px 2px rgba(0,0,0,0.2)}.hamburger[data-v-fcda3ee4]{display:flex;flex-direction:column;gap:3px}.hamburger span[data-v-fcda3ee4]{width:14px;height:2px;background:#d4af37;border-radius:1px}.desktop-layout[data-v-fcda3ee4]{display:block;height:calc(100% - 40px);padding:16px;overflow:hidden;position:relative;transition:color 0.2s ease,background 0.2s ease,box-shadow 0.2s ease,border-color 0.2s ease;background:var(--desk-bg)}.sidebar-panel[data-v-fcda3ee4]{position:absolute;top:0;right:0;bottom:0;width:min(260px,20vw);background:linear-gradient(135deg,#2d1810 0%,#1a1612 100%);border:1px solid rgba(139,69,19,0.4);border-radius:8px 0 0 8px;border-right:none;transform:translateX(100%);transition:transform 0.12s ease-out;z-index:2147483640;pointer-events:none;overflow:hidden;box-shadow:-2px 0 8px rgba(0,0,0,0.3);will-change:transform;contain:layout style paint;transform:translateZ(0) translateX(100%);backface-visibility:hidden;scrollbar-width:none;-ms-overflow-style:none}.sidebar-panel[data-v-fcda3ee4]::-webkit-scrollbar{display:none}.sidebar-panel[data-v-fcda3ee4] *{box-sizing:border-box}@media (max-width:900px){.sidebar-panel[data-v-fcda3ee4]{width:40vw}}.sidebar-panel.open[data-v-fcda3ee4]{transform:translateZ(0) translateX(0);pointer-events:auto}.side-buttons[data-v-fcda3ee4]{display:flex;flex-direction:column;gap:6px;padding:6px;height:100%;overflow-y:auto;box-sizing:border-box;contain:layout style;will-change:auto;transform:translateZ(0);scrollbar-width:none;-ms-overflow-style:none}.side-buttons[data-v-fcda3ee4]::-webkit-scrollbar{display:none}.side-btn[data-v-fcda3ee4]{padding:8px 12px;border-radius:6px;border:1px solid rgba(139,69,19,0.4);background:rgba(45,24,16,0.6);color:#e8dcc0;cursor:pointer;text-align:left;font-size:13px;font-weight:500;line-height:1.2;transition:all 0.2s ease;box-shadow:0 1px 2px rgba(0,0,0,0.2)}.dnd-layout.fs .side-btn[data-v-fcda3ee4]{padding:10px 14px;font-size:14px}.side-btn[data-v-fcda3ee4]:hover{background:rgba(58,30,20,0.8);border-color:rgba(139,69,19,0.5);color:#d4af37;box-shadow:0 2px 4px rgba(0,0,0,0.3),0 0 8px rgba(212,175,55,0.2);transform:translateX(-2px) scale(1.02);animation:sideButtonGlow-fcda3ee4 0.6s ease-out}@keyframes sideButtonGlow-fcda3ee4{0%{box-shadow:0 2px 4px rgba(0,0,0,0.3)}50%{box-shadow:0 4px 12px rgba(212,175,55,0.4)}100%{box-shadow:0 2px 4px rgba(0,0,0,0.3),0 0 8px rgba(212,175,55,0.2)}}.main-content[data-v-fcda3ee4]{position:relative;z-index:1;overflow:hidden;overflow-x:hidden;min-width:0;height:100%;display:flex;flex-direction:column}.init-page{height:100%;overflow:auto;flex:1 1 auto;min-height:0}.dnd-layout.dark-mode .main-content[data-v-fcda3ee4]{background:linear-gradient(135deg,#0d1117 0%,#161b22 100%) !important;color:#c9d1d9 !important}.dnd-layout.dark-mode .desktop-layout[data-v-fcda3ee4]{background:linear-gradient(135deg,#0d1117 0%,#161b22 100%) !important}.dnd-layout.dark-mode[data-v-fcda3ee4]{background:linear-gradient(135deg,#0d1117 0%,#161b22 100%) !important}.skill-modal[data-v-fcda3ee4]{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:2147483641}.skill-panel[data-v-fcda3ee4]{width:min(320px,10vw);max-width:calc(100% - 40px);background:linear-gradient(135deg,#2d1810 0%,#1a1612 100%);border:3px solid #8b4513;border-radius:16px;box-shadow:0 0 0 2px rgba(212,175,55,0.3),0 12px 32px rgba(0,0,0,0.6),inset 0 0 0 1px rgba(255,255,255,0.1);overflow-x:hidden;position:relative}.skill-panel[data-v-fcda3ee4]::before{content:'';position:absolute;top:8px;left:8px;right:8px;bottom:8px;border:1px solid rgba(212,175,55,0.2);border-radius:12px;pointer-events:none;z-index:1}.skill-panel[data-v-fcda3ee4]::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background-image:radial-gradient(circle at 20% 20%,rgba(212,175,55,0.03) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(139,69,19,0.02) 0%,transparent 50%);pointer-events:none;z-index:1}.skill-panel header[data-v-fcda3ee4]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:2px solid rgba(139,69,19,0.4);background:linear-gradient(135deg,rgba(45,24,16,0.8) 0%,rgba(26,22,18,0.9) 100%);position:relative;z-index:2}.skill-panel header h3[data-v-fcda3ee4]{margin:0;color:#d4af37;font-family:'Cinzel','Times New Roman',serif;font-weight:700;font-size:16px;letter-spacing:0.5px;text-shadow:0 1px 2px rgba(0,0,0,0.5)}.skill-panel .body[data-v-fcda3ee4]{padding:16px;color:#e8dcc0;max-height:70vh;overflow:auto;box-sizing:border-box;overflow-x:hidden;word-break:break-word;overflow-wrap:anywhere;position:relative;z-index:2;width:100%;max-width:100%}.skill-panel .body[data-v-fcda3ee4] *{max-width:100%;box-sizing:border-box}.skill-panel .body .card-grid[data-v-fcda3ee4]{grid-template-columns:1fr !important}.skill-panel .body .card-grid[data-v-fcda3ee4]>*{min-width:0}[data-v-fcda3ee4] .kv-tree2,[data-v-fcda3ee4] .kv-tree{max-width:100%}[data-v-fcda3ee4] .kv-row,[data-v-fcda3ee4] .kv-row .v{min-width:0;word-break:break-word;overflow-wrap:anywhere}[data-v-fcda3ee4] details{min-width:0}[data-v-fcda3ee4] img,[data-v-fcda3ee4] video,[data-v-fcda3ee4] canvas{max-width:100%;height:auto}[data-v-fcda3ee4] pre,[data-v-fcda3ee4] code{white-space:pre-wrap;word-break:break-word}.skill-panel .body[data-v-fcda3ee4] *,.skill-panel .body img[data-v-fcda3ee4],.skill-panel .body video[data-v-fcda3ee4],.skill-panel .body canvas[data-v-fcda3ee4]{max-width:100%;box-sizing:border-box}.skill-panel .close[data-v-fcda3ee4]{background:#2a2a2f;border:1px solid #47474a;border-radius:6px;color:#e8e2d4;width:28px;height:28px;cursor:pointer}.skill-panel .close[data-v-fcda3ee4]:hover{background:#333338}.kv[data-v-fcda3ee4]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}.kv-row[data-v-fcda3ee4]{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.12)}.kv-row .k[data-v-fcda3ee4]{opacity:0.85;margin-right:10px;min-width:0;flex:0 1 auto}.kv-row .v[data-v-fcda3ee4]{font-weight:600;word-break:break-word;overflow-wrap:anywhere;min-width:0;flex:1 1 0}.chips[data-v-fcda3ee4]{display:flex;gap:6px;flex-wrap:wrap;width:100%}.chip[data-v-fcda3ee4]{padding:2px 8px;border-radius:999px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.18);min-width:0;max-width:100%;word-break:break-word;overflow-wrap:anywhere}.chip .badge[data-v-fcda3ee4]{margin-left:6px;padding:2px 8px;border-radius:6px;background:linear-gradient(145deg,#d4af37 0%,#b8941f 100%);color:#2d1810;border:1px solid rgba(139,69,19,0.4);font-size:11px;font-weight:700;white-space:nowrap;text-shadow:none;transition:all 0.3s ease;animation:badgePulse-fcda3ee4 2s ease-in-out infinite}@keyframes badgePulse-fcda3ee4{0%,100%{box-shadow:0 0 4px rgba(212,175,55,0.3)}50%{box-shadow:0 0 8px rgba(212,175,55,0.6)}}.note[data-v-fcda3ee4]{opacity:0.8;margin-top:10px;font-size:12px}.card-grid[data-v-fcda3ee4]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}.card[data-v-fcda3ee4]{border:1px solid rgba(255,255,255,0.18);border-radius:10px;padding:10px;background:rgba(255,255,255,0.06);min-width:0;transition:all 0.3s ease;position:relative;overflow:hidden}.card[data-v-fcda3ee4]:hover{border-color:rgba(212,175,55,0.3);background:rgba(255,255,255,0.08);transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,0.2)}.card[data-v-fcda3ee4]::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(212,175,55,0.1),transparent);transition:left 0.5s ease}.card[data-v-fcda3ee4]:hover::before{left:100%}.card-title[data-v-fcda3ee4]{font-family:'Cinzel','Times New Roman',serif;font-weight:600;font-size:14px;margin-bottom:8px;color:#d4af37;white-space:normal;letter-spacing:0.5px}.sub-title[data-v-fcda3ee4]{margin:8px 0 4px;opacity:0.9}.feature[data-v-fcda3ee4]{border:1px dashed rgba(255,255,255,0.18);border-radius:8px;padding:8px;margin-top:6px}.f-name[data-v-fcda3ee4]{font-weight:700;margin-bottom:4px}.stage-container[data-v-fcda3ee4]::-webkit-scrollbar,.skill-panel .body[data-v-fcda3ee4]::-webkit-scrollbar,.sidebar-panel[data-v-fcda3ee4]::-webkit-scrollbar{width:8px;height:8px}.stage-container[data-v-fcda3ee4]::-webkit-scrollbar-thumb,.skill-panel .body[data-v-fcda3ee4]::-webkit-scrollbar-thumb,.sidebar-panel[data-v-fcda3ee4]::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.22);border-radius:8px}.stage-container[data-v-fcda3ee4]::-webkit-scrollbar-track,.skill-panel .body[data-v-fcda3ee4]::-webkit-scrollbar-track,.sidebar-panel[data-v-fcda3ee4]::-webkit-scrollbar-track{background:rgba(255,255,255,0.06)}.stage-container[data-v-fcda3ee4]{scrollbar-width:thin;scrollbar-color:rgba(255,255,255,0.22) rgba(255,255,255,0.06)}@media (max-width:1200px){.skill-panel[data-v-fcda3ee4]{width:min(360px,24vw)}.card-grid[data-v-fcda3ee4]{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (max-width:900px){.skill-panel[data-v-fcda3ee4]{width:96vw;max-width:96vw;overflow-x:hidden}.skill-panel .body .card-grid[data-v-fcda3ee4]{grid-template-columns:1fr !important}.dnd-layout.fs .skill-panel .body .card-grid[data-v-fcda3ee4]{grid-template-columns:1fr}.details-card summary.card-title[data-v-fcda3ee4]{padding:10px 2px;font-size:16px}.card[data-v-fcda3ee4]{padding:10px}.skill-panel .body[data-v-fcda3ee4] .kv2{width:100%;max-width:100%;overflow-x:hidden}.skill-panel .body[data-v-fcda3ee4] .kv2 .row{grid-template-columns:1fr !important;gap:2px !important}.skill-panel .body[data-v-fcda3ee4] .kv2 .k,.skill-panel .body[data-v-fcda3ee4] .kv2 .v{font-size:12px !important;line-height:1.3 !important;word-break:break-all !important}.skill-panel .body[data-v-fcda3ee4]{padding:12px}.kv-row[data-v-fcda3ee4]{flex-direction:column;align-items:flex-start;gap:4px}.kv-row .v[data-v-fcda3ee4]{word-break:break-word}.chips[data-v-fcda3ee4]{gap:8px}.dnd-layout.fs .sidebar-panel[data-v-fcda3ee4]{width:40vw !important}.card-grid[data-v-fcda3ee4]{grid-template-columns:1fr}.desktop-layout[data-v-fcda3ee4]{padding:10px;background:var(--desk-bg)}.sidebar-panel[data-v-fcda3ee4]{top:0;bottom:0;width:40vw;border-radius:0;border-left:none;border-right:none;overflow-x:hidden}.side-buttons[data-v-fcda3ee4]{padding:8px}.side-btn[data-v-fcda3ee4]{padding:10px 10px;font-size:15px}.topbar[data-v-fcda3ee4]{height:48px}.skill-panel .body[data-v-fcda3ee4]{max-height:calc(100vh - 120px);-webkit-overflow-scrolling:touch}}.lv-panel[data-v-fcda3ee4]{width:560px;max-width:calc(100% - 40px);background:#15151a;border:1px solid #3a3a3c;border-radius:10px;box-shadow:0 10px 40px rgba(0,0,0,0.6)}.lv-panel header[data-v-fcda3ee4]{padding:10px 12px;border-bottom:1px solid #2a2a2f}.lv-panel header h3[data-v-fcda3ee4]{margin:0;color:#ffd700}.lv-body[data-v-fcda3ee4]{padding:12px}.class-list[data-v-fcda3ee4]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.class-btn[data-v-fcda3ee4]{padding:10px 12px;border:2px solid rgba(139,69,19,0.6);background:linear-gradient(145deg,#8b4513 0%,#2d1810 100%);color:#e8dcc0;border-radius:8px;cursor:pointer;font-family:'Cinzel','Times New Roman',serif;font-weight:600;font-size:13px;letter-spacing:0.3px;transition:all 0.2s ease;text-shadow:0 1px 2px rgba(0,0,0,0.4);box-shadow:inset 0 1px 0 rgba(255,255,255,0.1),0 2px 4px rgba(0,0,0,0.3)}.class-btn .badge[data-v-fcda3ee4]{margin-left:6px;padding:2px 6px;border-radius:4px;background:linear-gradient(145deg,#d4af37 0%,#b8941f 100%);color:#2d1810;border:1px solid rgba(139,69,19,0.4);font-size:11px;font-weight:700;text-shadow:none}.class-btn.active[data-v-fcda3ee4],.class-btn[data-v-fcda3ee4]:hover{background:linear-gradient(145deg,#a0531a 0%,#3a1e14 100%);border-color:rgba(139,69,19,1);transform:translateY(-1px);box-shadow:inset 0 1px 0 rgba(255,255,255,0.2),0 3px 6px rgba(0,0,0,0.4),0 0 8px rgba(212,175,55,0.2)}.lv-footer[data-v-fcda3ee4]{display:flex;justify-content:flex-end;gap:8px;padding:10px 12px;border-top:1px solid #2a2a2f}.btn-primary[data-v-fcda3ee4]{padding:10px 16px;background:linear-gradient(145deg,#2d4a22 0%,#1e3317 100%);color:#d4af37;border:2px solid rgba(139,69,19,0.8);border-radius:8px;cursor:pointer;font-family:'Cinzel','Times New Roman',serif;font-weight:600;font-size:13px;letter-spacing:0.3px;transition:all 0.2s ease;text-shadow:0 1px 2px rgba(0,0,0,0.4);box-shadow:inset 0 1px 0 rgba(255,255,255,0.1),0 2px 4px rgba(0,0,0,0.3)}.btn-primary[data-v-fcda3ee4]:hover{background:linear-gradient(145deg,#3a5c2c 0%,#25401c 100%);border-color:rgba(139,69,19,1);transform:translateY(-1px);box-shadow:inset 0 1px 0 rgba(255,255,255,0.2),0 3px 6px rgba(0,0,0,0.4),0 0 8px rgba(212,175,55,0.2)}.btn-primary[data-v-fcda3ee4]:disabled{opacity:0.6;cursor:not-allowed}.btn-alt[data-v-fcda3ee4]{padding:8px 12px;background:#2a2a2f;color:#e8e2d4;border:1px solid #47474a;border-radius:8px;cursor:pointer}.asi-grid[data-v-fcda3ee4]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}.asi-row[data-v-fcda3ee4]{display:flex;align-items:center;justify-content:space-between;border:1px solid #2a2a2f;border-radius:8px;padding:8px}.asi-ctrl[data-v-fcda3ee4]{display:flex;align-items:center;gap:8px}.asi-btn[data-v-fcda3ee4]{width:28px;height:28px;border-radius:6px;border:1px solid #47474a;background:#2a2a2f;color:#e8e2d4;cursor:pointer}

[data-v-4db95bd1]:host{display:block;width:100%}

.stage-container[data-v-18c22603]{padding:20px;max-width:1000px;overflow:auto;margin:0;width:100%;background:var(--stage-bg);border-radius:12px;border:2px solid var(--stage-border);-webkit-overflow-scrolling:touch;height:100%;box-sizing:border-box;position:relative;box-shadow:0 0 0 1px rgba(212,175,55,0.2),0 4px 16px rgba(0,0,0,0.4),inset 0 0 0 1px rgba(255,255,255,0.05);transition:color 0.3s ease,background 0.3s ease,box-shadow 0.3s ease,border-color 0.3s ease}.hero-bar[data-v-18c22603]{display:flex;gap:12px;align-items:center;padding:12px;margin-bottom:12px;background:var(--hero-bg);border:1px solid var(--hero-border);border-radius:8px;font-family:'Source Code Pro','Consolas',monospace;font-weight:500;letter-spacing:0.2px;transition:all 0.3s ease}.hero-bar[data-v-18c22603]:hover{box-shadow:0 2px 8px rgba(212,175,55,0.2);border-color:rgba(139,69,19,0.6)}.avatar[data-v-18c22603]{width:42px;height:42px;border-radius:8px;display:grid;place-items:center;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.18);font-size:20px}.hero-main[data-v-18c22603]{flex:1;display:flex;flex-direction:column;gap:6px}.hero-main .row[data-v-18c22603]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.name[data-v-18c22603]{font-weight:700;font-size:16px;color:#ffd700}.sep[data-v-18c22603]{opacity:0.5}.hp .label[data-v-18c22603],.ac .label[data-v-18c22603]{opacity:0.8;margin-right:4px}.hp .temp[data-v-18c22603]{margin-left:6px;color:#93c5fd}.chips[data-v-18c22603]{display:inline-flex;gap:6px;flex-wrap:wrap}.chip[data-v-18c22603]{padding:2px 8px;border-radius:999px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.18)}.message-card[data-v-18c22603]{margin-bottom:16px;padding:18px;border-radius:12px;border:2px solid rgba(139,69,19,0.4);word-break:break-word;position:relative;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,0,0,0.3),inset 0 1px 0 rgba(255,255,255,0.05)}.message-card[data-v-18c22603]::before{content:'';position:absolute;top:4px;left:4px;right:4px;bottom:4px;border:1px solid rgba(212,175,55,0.1);border-radius:8px;pointer-events:none}.message-card.player[data-v-18c22603]{background:linear-gradient(135deg,rgba(45,24,16,0.7) 0%,rgba(26,22,18,0.8) 100%);border-left:4px solid #d4af37}.message-card.narrator[data-v-18c22603]{background:linear-gradient(135deg,rgba(139,69,19,0.3) 0%,rgba(45,24,16,0.6) 100%);border-left:4px solid #8b4513}.dnd-layout.dark-mode .stage-container .message-card.player{background:linear-gradient(135deg,rgba(33,38,46,0.7) 0%,rgba(22,27,34,0.8) 100%) !important;border-left-color:#58a6ff !important;border-color:rgba(48,54,61,0.4) !important;box-shadow:none !important}.dnd-layout.dark-mode .stage-container .message-card.narrator{background:linear-gradient(135deg,rgba(48,54,61,0.3) 0%,rgba(33,38,46,0.6) 100%) !important;border-left-color:#f85149 !important;border-color:rgba(48,54,61,0.4) !important;box-shadow:none !important}.dnd-layout.dark-mode .stage-container .message-card::before{border-color:rgba(48,54,61,0.2) !important}.dnd-layout.dark-mode{background:linear-gradient(135deg,rgba(33,38,46,0.8) 0%,rgba(22,27,34,0.9) 100%);border-color:rgba(48,54,61,0.4);box-shadow:0 0 0 1px rgba(88,166,255,0.1),0 2px 8px rgba(0,0,0,0.3),inset 0 0 0 1px rgba(255,255,255,0.05)}.dnd-layout.dark-mode{border-color:rgba(88,166,255,0.1)}.dnd-layout.dark-mode{background:linear-gradient(135deg,rgba(22,27,34,0.9) 0%,rgba(33,38,46,0.8) 100%);border-color:rgba(48,54,61,0.3);color:#c9d1d9}.dnd-layout.dark-mode{border-color:rgba(88,166,255,0.6);box-shadow:inset 0 1px 3px rgba(0,0,0,0.2),0 0 0 3px rgba(88,166,255,0.2)}.dnd-layout.dark-mode{color:rgba(201,209,217,0.5)}.dnd-layout.dark-mode{background:linear-gradient(135deg,#21262d 0%,#161b22 100%);border-color:rgba(48,54,61,0.4)}.dnd-layout.dark-mode{box-shadow:0 2px 8px rgba(88,166,255,0.2);border-color:rgba(48,54,61,0.6)}.dnd-layout.dark-mode{background:linear-gradient(145deg,#30363d 0%,#21262d 100%);color:#c9d1d9;border-color:rgba(48,54,61,0.8)}.dnd-layout.dark-mode{background:linear-gradient(145deg,#238636 0%,#1a7f37 100%);color:#c9d1d9;border-color:rgba(48,54,61,0.8)}.dnd-layout.dark-mode{background:linear-gradient(145deg,#da3633 0%,#b91c1c 100%);color:#c9d1d9;border-color:rgba(48,54,61,0.8)}.dnd-layout.dark-mode{color:#c9d1d9}.dnd-layout.dark-mode,.dnd-layout.dark-mode,.dnd-layout.dark-mode,.dnd-layout.dark-mode,.dnd-layout.dark-mode,.dnd-layout.dark-mode{color:#58a6ff}.dnd-layout.dark-mode{color:#f0f6fc}.dnd-layout.dark-mode{color:#79c0ff}.dnd-layout.dark-mode{background:rgba(110,118,129,0.1);color:#79c0ff;border:1px solid rgba(48,54,61,0.3)}.dnd-layout.dark-mode{background:rgba(110,118,129,0.1);border:1px solid rgba(48,54,61,0.3)}.dnd-layout.dark-mode{border-left:4px solid #30363d;background:rgba(110,118,129,0.05);color:#8b949e}.dnd-layout.dark-mode{color:#58a6ff}.dnd-layout.dark-mode{color:#79c0ff}.dnd-layout.dark-mode{background:linear-gradient(135deg,#21262d 0%,#161b22 100%) !important;border-color:rgba(48,54,61,0.4) !important}.dnd-layout.dark-mode{box-shadow:0 2px 8px rgba(88,166,255,0.2) !important;border-color:rgba(48,54,61,0.6) !important}.dnd-layout.dark-mode{background:linear-gradient(135deg,#21262d 0%,#161b22 100%) !important;border-color:rgba(48,54,61,0.6) !important}.dnd-layout.dark-mode{background:linear-gradient(135deg,rgba(22,27,34,0.9) 0%,rgba(33,38,46,0.8) 100%);border-color:rgba(48,54,61,0.3);color:#c9d1d9}.dnd-layout.dark-mode{border-color:rgba(88,166,255,0.6);box-shadow:0 0 0 3px rgba(88,166,255,0.2)}.dnd-layout.dark-mode{background:linear-gradient(145deg,#238636 0%,#1a7f37 100%);color:#c9d1d9;border-color:rgba(48,54,61,0.3)}.dnd-layout.dark-mode{background:linear-gradient(145deg,#da3633 0%,#b91c1c 100%);color:#c9d1d9;border-color:rgba(48,54,61,0.3)}.dnd-layout.dark-mode{color:#58a6ff}.card-header[data-v-18c22603]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.speaker[data-v-18c22603]{font-weight:600;font-size:16px;color:#ffd700}.actions[data-v-18c22603]{display:flex;gap:8px}.edit-btn[data-v-18c22603],.delete-btn[data-v-18c22603]{width:32px;height:32px;border:1px solid #5a5a5a;background:#4a4a4c;color:#e8e2d4;border-radius:4px;cursor:pointer}.edit-btn[data-v-18c22603]:hover,.delete-btn[data-v-18c22603]:hover{background:#5a5a5c}.edit-textarea[data-v-18c22603]{width:100%;resize:vertical;min-height:140px;background:#0f1216;color:#e8e2d4;border:1px solid #3a3a3c;border-radius:6px;padding:8px}.nav-row[data-v-18c22603]{display:flex;justify-content:space-between;align-items:center;margin:12px 0 0;padding:0}.nav-btn[data-v-18c22603]{padding:8px 16px;background:#2a2a2f;border:1px solid #47474a;color:#e8e2d4;border-radius:6px;cursor:pointer}.nav-btn[data-v-18c22603]:hover{background:#333338}.chapter-info[data-v-18c22603]{color:#ffd700;font-weight:500}.input-area[data-v-18c22603]{margin-top:16px;padding:20px;background:var(--input-area-bg);border:2px solid var(--input-area-border);border-radius:12px;box-shadow:0 0 0 1px rgba(212,175,55,0.1),0 2px 8px rgba(0,0,0,0.3),inset 0 0 0 1px rgba(255,255,255,0.05);position:relative}.input-area[data-v-18c22603]::before{content:'';position:absolute;top:4px;left:4px;right:4px;bottom:4px;border:1px solid rgba(212,175,55,0.1);border-radius:8px;pointer-events:none}.text-input[data-v-18c22603]{width:100%;padding:14px;background:var(--text-input-bg,linear-gradient(135deg,rgba(15,18,22,0.9) 0%,rgba(26,22,18,0.8) 100%));border:2px solid var(--text-input-border,rgba(139,69,19,0.3));border-radius:8px;color:var(--text-input-color,#e8dcc0);font-family:'Libre Baskerville','Times New Roman',serif;font-size:14px;line-height:1.5;resize:vertical;margin-bottom:16px;position:relative;z-index:1;transition:all 0.3s ease;box-shadow:inset 0 1px 3px rgba(0,0,0,0.2),0 0 0 0 rgba(212,175,55,0)}.text-input[data-v-18c22603]:focus{outline:none;border-color:var(--text-input-border-focus,rgba(212,175,55,0.6));box-shadow:inset 0 1px 3px rgba(0,0,0,0.2),0 0 0 3px var(--text-input-outline,rgba(212,175,55,0.2))}.text-input[data-v-18c22603]::placeholder{color:var(--text-input-placeholder,rgba(232,220,192,0.5));font-style:italic}.button-row[data-v-18c22603]{display:flex;gap:12px;justify-content:flex-end}.action-btn[data-v-18c22603]{padding:12px 18px;border:2px solid rgba(139,69,19,0.6);border-radius:8px;cursor:pointer;font-family:'Cinzel','Times New Roman',serif;font-weight:600;font-size:13px;letter-spacing:0.5px;transition:all 0.25s ease;position:relative;text-shadow:0 1px 2px rgba(0,0,0,0.5);box-shadow:inset 0 1px 0 rgba(255,255,255,0.2),0 3px 6px rgba(0,0,0,0.3),0 1px 0 rgba(0,0,0,0.2)}.action-btn.reroll[data-v-18c22603]{background:linear-gradient(145deg,#8b4513 0%,#2d1810 100%);color:#e8dcc0;border-color:rgba(139,69,19,0.8)}.action-btn.send[data-v-18c22603]{background:linear-gradient(145deg,#2d4a22 0%,#1e3317 100%);color:#d4af37;border-color:rgba(139,69,19,0.8)}.action-btn.stop[data-v-18c22603]{background:linear-gradient(145deg,#7a2d2d 0%,#4a1a1a 100%);color:#e8dcc0;border-color:rgba(139,69,19,0.8)}.action-btn[data-v-18c22603]:hover:not(:disabled){transform:translateY(-2px);box-shadow:inset 0 1px 0 rgba(255,255,255,0.3),0 5px 12px rgba(0,0,0,0.4),0 0 15px rgba(212,175,55,0.2)}.action-btn[data-v-18c22603]:active:not(:disabled){transform:translateY(0);box-shadow:inset 0 2px 4px rgba(0,0,0,0.3),0 1px 2px rgba(0,0,0,0.2)}.action-btn[data-v-18c22603]:disabled{opacity:0.5;cursor:not-allowed;transform:none;box-shadow:inset 0 1px 2px rgba(0,0,0,0.2)}.stage-container[data-v-18c22603]::-webkit-scrollbar{width:8px;height:8px}.stage-container[data-v-18c22603]::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.22);border-radius:8px}.stage-container[data-v-18c22603]::-webkit-scrollbar-track{background:rgba(255,255,255,0.06)}.stage-container[data-v-18c22603]{scrollbar-width:thin;scrollbar-color:rgba(255,255,255,0.22) rgba(255,255,255,0.06)}@media (max-width:600px){.stage-container[data-v-18c22603]{padding:12px}.hero-bar[data-v-18c22603]{padding:10px}.edit-btn[data-v-18c22603],.delete-btn[data-v-18c22603]{width:36px;height:36px}.text-input[data-v-18c22603]{font-size:16px;min-height:120px}.button-row[data-v-18c22603]{gap:10px;flex-wrap:wrap;justify-content:space-between}.action-btn[data-v-18c22603]{padding:12px 16px;font-size:16px;flex:1 1 48%}}

.panel[data-v-2eba7f34]{padding:16px}

.panel[data-v-4348a964]{padding:16px}

</style></head><body><div id="app"></div></body></html>